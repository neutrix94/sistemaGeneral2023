/************************* INICIAMOS *************************/
SELECT
			ax1.id_productos AS ID,
			ax1.nombre,
			ax1.sumaEstacionalidades,
			ax1.inventarioMatriz,
			ax1.inventarioSucursales,
			IF( (ax1.inventarioSucursales+ax1.inventarioMatriz)<ax1.sumaEstacionalidades,1,0) AS raciona 
		FROM(
			SELECT
				ax.id_productos, 
				ax.nombre,
				ax.sumaEstacionalidades,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1 ,0,(tm.afecta*md.cantidad))) AS inventarioMatriz,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR alm.id_sucursal<=1 OR alm.es_almacen=0,0,(tm.afecta*md.cantidad))) AS inventarioSucursales,
				ax.orden_lista
			FROM(
				SELECT
					p.id_productos, 
					p.nombre,
					SUM(ep.maximo) AS sumaEstacionalidades,
					p.orden_lista
				FROM ec_productos p
				LEFT JOIN ec_estacionalidad_producto ep ON ep.id_producto=p.id_productos
				LEFT JOIN ec_estacionalidad e ON ep.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales s ON s.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales_producto sp ON sp.id_sucursal=s.id_sucursal
				AND sp.id_producto=p.id_productos
				WHERE sp.stock_bajo=0
				GROUP BY p.id_productos
				ORDER BY p.orden_lista
			)ax
			LEFT JOIN ec_movimiento_detalle md ON ax.id_productos=md.id_producto
			LEFT JOIN ec_movimiento_almacen ma ON ma.id_movimiento_almacen=md.id_movimiento
			LEFT JOIN ec_tipos_movimiento tm ON tm.id_tipo_movimiento=ma.id_tipo_movimiento
			LEFT JOIN ec_almacen alm ON alm.id_almacen=ma.id_almacen
			GROUP BY ax.id_productos
			ORDER BY ax.orden_lista
		)ax1
		GROUP BY ax1.id_productos
		ORDER BY ax1.orden_lista

Consultamos el año actualSELECT YEAR(CURRENT_DATE)
2019

El producto 2644 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2644
			)aux

Id de Producto: 2644

Inventario almacenes principales: 40

Ventas totales: 96
Proceso de racion producto: 2644

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 AND tm.id_tipo_movimiento=2,
								md.cantidad,
								0)
							) 
						)/96/*ventas totales*/)*40/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2644
					WHERE p.id_productos=2644
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.666666666666668)-(5/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((25.416666666666664)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((53.75)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.75)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((52.5)-(-1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((27.5)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.416666666666666)-(9/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2644


/************************SEGUNDA RACIÓN**********************************/ 2644

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((9.108433734939759)-(5/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2644

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((19.843373493975903)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2644

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((41.963855421686745)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2644

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6.831325301204819)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2644

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((40.98795180722892)-(-1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2644

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((21.46987951807229)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2644

/***************************TERCERA RACIÓN*******************************/2644

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2644
			)aux
			JOIN ec_productos p ON p.id_productos=2644
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2644
/************************* INICIAMOS *************************/
SELECT
			ax1.id_productos AS ID,
			ax1.nombre,
			ax1.sumaEstacionalidades,
			ax1.inventarioMatriz,
			ax1.inventarioSucursales,
			IF( (ax1.inventarioSucursales+ax1.inventarioMatriz)<ax1.sumaEstacionalidades,1,0) AS raciona 
		FROM(
			SELECT
				ax.id_productos, 
				ax.nombre,
				ax.sumaEstacionalidades,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1 ,0,(tm.afecta*md.cantidad))) AS inventarioMatriz,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR alm.id_sucursal<=1 OR alm.es_almacen=0,0,(tm.afecta*md.cantidad))) AS inventarioSucursales,
				ax.orden_lista
			FROM(
				SELECT
					p.id_productos, 
					p.nombre,
					SUM(ep.maximo) AS sumaEstacionalidades,
					p.orden_lista
				FROM ec_productos p
				LEFT JOIN ec_estacionalidad_producto ep ON ep.id_producto=p.id_productos
				LEFT JOIN ec_estacionalidad e ON ep.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales s ON s.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales_producto sp ON sp.id_sucursal=s.id_sucursal
				AND sp.id_producto=p.id_productos
				WHERE sp.stock_bajo=0
				GROUP BY p.id_productos
				ORDER BY p.orden_lista
			)ax
			LEFT JOIN ec_movimiento_detalle md ON ax.id_productos=md.id_producto
			LEFT JOIN ec_movimiento_almacen ma ON ma.id_movimiento_almacen=md.id_movimiento
			LEFT JOIN ec_tipos_movimiento tm ON tm.id_tipo_movimiento=ma.id_tipo_movimiento
			LEFT JOIN ec_almacen alm ON alm.id_almacen=ma.id_almacen
			GROUP BY ax.id_productos
			ORDER BY ax.orden_lista
		)ax1
		GROUP BY ax1.id_productos
		ORDER BY ax1.orden_lista

Consultamos el año actualSELECT YEAR(CURRENT_DATE)
2019

El producto 2644 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2644
			)aux

Id de Producto: 2644

Inventario almacenes principales: 40

Ventas totales: 96
Proceso de racion producto: 2644

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/96/*ventas totales*/)*40/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2644
					WHERE p.id_productos=2644
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.41666666666666663)-(5/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.916666666666667)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.583333333333334)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.333333333333332)-(-1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.333333333333334)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.416666666666666)-(9/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2644


/************************SEGUNDA RACIÓN**********************************/ 2644

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((5.213333333333333)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2644

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7.253333333333334)-(-1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2644

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4.533333333333333)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2644

/***************************TERCERA RACIÓN*******************************/2644

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2644
			)aux
			JOIN ec_productos p ON p.id_productos=2644
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2644
/************************* INICIAMOS *************************/
SELECT
			ax1.id_productos AS ID,
			ax1.nombre,
			ax1.sumaEstacionalidades,
			ax1.inventarioMatriz,
			ax1.inventarioSucursales,
			IF( (ax1.inventarioSucursales+ax1.inventarioMatriz)<ax1.sumaEstacionalidades,1,0) AS raciona 
		FROM(
			SELECT
				ax.id_productos, 
				ax.nombre,
				ax.sumaEstacionalidades,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1 ,0,(tm.afecta*md.cantidad))) AS inventarioMatriz,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR alm.id_sucursal<=1 OR alm.es_almacen=0,0,(tm.afecta*md.cantidad))) AS inventarioSucursales,
				ax.orden_lista
			FROM(
				SELECT
					p.id_productos, 
					p.nombre,
					SUM(ep.maximo) AS sumaEstacionalidades,
					p.orden_lista
				FROM ec_productos p
				LEFT JOIN ec_estacionalidad_producto ep ON ep.id_producto=p.id_productos
				LEFT JOIN ec_estacionalidad e ON ep.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales s ON s.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales_producto sp ON sp.id_sucursal=s.id_sucursal
				AND sp.id_producto=p.id_productos
				WHERE sp.stock_bajo=0
				GROUP BY p.id_productos
				ORDER BY p.orden_lista
			)ax
			LEFT JOIN ec_movimiento_detalle md ON ax.id_productos=md.id_producto
			LEFT JOIN ec_movimiento_almacen ma ON ma.id_movimiento_almacen=md.id_movimiento
			LEFT JOIN ec_tipos_movimiento tm ON tm.id_tipo_movimiento=ma.id_tipo_movimiento
			LEFT JOIN ec_almacen alm ON alm.id_almacen=ma.id_almacen
			GROUP BY ax.id_productos
			ORDER BY ax.orden_lista
		)ax1
		GROUP BY ax1.id_productos
		ORDER BY ax1.orden_lista

Consultamos el año actualSELECT YEAR(CURRENT_DATE)
2019

El producto 2987 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2987
			)aux

Id de Producto: 2987

Inventario almacenes principales: -63

Ventas totales: 0
Proceso de racion producto: 2987

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-63/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2987
					WHERE p.id_productos=2987
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(7/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(11/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2987


/************************SEGUNDA RACIÓN**********************************/ 2987

/***************************TERCERA RACIÓN*******************************/2987

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2987
			)aux
			JOIN ec_productos p ON p.id_productos=2987
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2987

El producto 2988 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2988
			)aux

Id de Producto: 2988

Inventario almacenes principales: -3

Ventas totales: 0
Proceso de racion producto: 2988

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2988
					WHERE p.id_productos=2988
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(6/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2988


/************************SEGUNDA RACIÓN**********************************/ 2988

/***************************TERCERA RACIÓN*******************************/2988

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2988
			)aux
			JOIN ec_productos p ON p.id_productos=2988
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2988

El producto 2989 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2989
			)aux

Id de Producto: 2989

Inventario almacenes principales: -15

Ventas totales: 0
Proceso de racion producto: 2989

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-15/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2989
					WHERE p.id_productos=2989
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(23/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2989


/************************SEGUNDA RACIÓN**********************************/ 2989

/***************************TERCERA RACIÓN*******************************/2989

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2989
			)aux
			JOIN ec_productos p ON p.id_productos=2989
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2989

El producto 2990 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2990
			)aux

Id de Producto: 2990

Inventario almacenes principales: -19

Ventas totales: 0
Proceso de racion producto: 2990

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-19/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2990
					WHERE p.id_productos=2990
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(8/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(14/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(20/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(25/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2990


/************************SEGUNDA RACIÓN**********************************/ 2990

/***************************TERCERA RACIÓN*******************************/2990

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2990
			)aux
			JOIN ec_productos p ON p.id_productos=2990
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2990

El producto 2994 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2994
			)aux

Id de Producto: 2994

Inventario almacenes principales: -32

Ventas totales: 0
Proceso de racion producto: 2994

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-32/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2994
					WHERE p.id_productos=2994
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(20/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(30/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(20/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(22/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(20/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2994


/************************SEGUNDA RACIÓN**********************************/ 2994

/***************************TERCERA RACIÓN*******************************/2994

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2994
			)aux
			JOIN ec_productos p ON p.id_productos=2994
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2994

El producto 3000 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3000
			)aux

Id de Producto: 3000

Inventario almacenes principales: 22

Ventas totales: 60
Proceso de racion producto: 3000

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/60/*ventas totales*/)*22/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3000
					WHERE p.id_productos=3000
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(8/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3000

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.4666666666666666)-(-4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3000

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.233333333333333)-(11/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3000

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.033333333333333)-(17/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3000

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.4666666666666666)-(22/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3000

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.8)-(27/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3000


/************************SEGUNDA RACIÓN**********************************/ 3000

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-63)-(-4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3000

/***************************TERCERA RACIÓN*******************************/3000

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3000
			)aux
			JOIN ec_productos p ON p.id_productos=3000
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3000

El producto 3292 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3292
			)aux

Id de Producto: 3292

Inventario almacenes principales: 21

Ventas totales: 25
Proceso de racion producto: 3292

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/25/*ventas totales*/)*21/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3292
					WHERE p.id_productos=3292
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.84)-(7/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3292

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3292

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.36)-(9/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3292

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((16.8)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3292

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(14/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3292

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(2/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3292


/************************SEGUNDA RACIÓN**********************************/ 3292

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-11)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3292

/***************************TERCERA RACIÓN*******************************/3292

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3292
			)aux
			JOIN ec_productos p ON p.id_productos=3292
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3292

El producto 3296 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3296
			)aux

Id de Producto: 3296

Inventario almacenes principales: -4

Ventas totales: 0
Proceso de racion producto: 3296

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3296
					WHERE p.id_productos=3296
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3296

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3296

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3296

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3296


/************************SEGUNDA RACIÓN**********************************/ 3296

/***************************TERCERA RACIÓN*******************************/3296

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3296
			)aux
			JOIN ec_productos p ON p.id_productos=3296
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3296

El producto 1810 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1810
			)aux

Id de Producto: 1810

Inventario almacenes principales: 19

Ventas totales: 0
Proceso de racion producto: 1810

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*19/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1810
					WHERE p.id_productos=1810
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=1810


/************************SEGUNDA RACIÓN**********************************/ 1810

/***************************TERCERA RACIÓN*******************************/1810

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1810
			)aux
			JOIN ec_productos p ON p.id_productos=1810
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1810

El producto 3156 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3156
			)aux

Id de Producto: 3156

Inventario almacenes principales: 3

Ventas totales: 10
Proceso de racion producto: 3156

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/10/*ventas totales*/)*3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3156
					WHERE p.id_productos=3156
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3)-(13/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3156

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3156

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3156


/************************SEGUNDA RACIÓN**********************************/ 3156

/***************************TERCERA RACIÓN*******************************/3156

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3156
			)aux
			JOIN ec_productos p ON p.id_productos=3156
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3156

El producto 1812 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1812
			)aux

Id de Producto: 1812

Inventario almacenes principales: 5

Ventas totales: 22
Proceso de racion producto: 1812

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/22/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1812
					WHERE p.id_productos=1812
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1812

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1812


/************************SEGUNDA RACIÓN**********************************/ 1812

/***************************TERCERA RACIÓN*******************************/1812

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1812
			)aux
			JOIN ec_productos p ON p.id_productos=1812
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1812

El producto 1816 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1816
			)aux

Id de Producto: 1816

Inventario almacenes principales: -1

Ventas totales: 0
Proceso de racion producto: 1816

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1816
					WHERE p.id_productos=1816
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1816


/************************SEGUNDA RACIÓN**********************************/ 1816

/***************************TERCERA RACIÓN*******************************/1816

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1816
			)aux
			JOIN ec_productos p ON p.id_productos=1816
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1816

El producto 2659 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2659
			)aux

Id de Producto: 2659

Inventario almacenes principales: 0

Ventas totales: 177
Proceso de racion producto: 2659

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/177/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2659
					WHERE p.id_productos=2659
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(16/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2659

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(28/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2659

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2659

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2659

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(-17/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2659

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(15/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2659

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(6/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2659


/************************SEGUNDA RACIÓN**********************************/ 2659

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-68)-(-17/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2659

/***************************TERCERA RACIÓN*******************************/2659

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2659
			)aux
			JOIN ec_productos p ON p.id_productos=2659
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2659

El producto 1826 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1826
			)aux

Id de Producto: 1826

Inventario almacenes principales: 4

Ventas totales: 9
Proceso de racion producto: 1826

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/9/*ventas totales*/)*4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1826
					WHERE p.id_productos=1826
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1826

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1826

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1826

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1826


/************************SEGUNDA RACIÓN**********************************/ 1826

/***************************TERCERA RACIÓN*******************************/1826

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1826
			)aux
			JOIN ec_productos p ON p.id_productos=1826
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1826

El producto 2665 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2665
			)aux

Id de Producto: 2665

Inventario almacenes principales: -17

Ventas totales: 3
Proceso de racion producto: 2665

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*-17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2665
					WHERE p.id_productos=2665
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-17)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2665

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2665


/************************SEGUNDA RACIÓN**********************************/ 2665

/***************************TERCERA RACIÓN*******************************/2665

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2665
			)aux
			JOIN ec_productos p ON p.id_productos=2665
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2665

El producto 3118 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3118
			)aux

Id de Producto: 3118

Inventario almacenes principales: 89

Ventas totales: 146
Proceso de racion producto: 3118

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/146/*ventas totales*/)*89/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3118
					WHERE p.id_productos=3118
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.972602739726026)-(7/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3118

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.753424657534246)-(25/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3118

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((34.13698630136986)-(21/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3118

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((24.383561643835616)-(13/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3118

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.753424657534246)-(24/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3118


/************************SEGUNDA RACIÓN**********************************/ 3118

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6.315789473684211)-(7/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3118

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((19.64912280701754)-(21/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3118

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((14.035087719298245)-(13/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3118

/***************************TERCERA RACIÓN*******************************/3118

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3118
			)aux
			JOIN ec_productos p ON p.id_productos=3118
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3118

El producto 3121 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3121
			)aux

Id de Producto: 3121

Inventario almacenes principales: 40

Ventas totales: 12
Proceso de racion producto: 3121

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/12/*ventas totales*/)*40/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3121
					WHERE p.id_productos=3121
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((33.333333333333336)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3121

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.666666666666666)-(12/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3121


/************************SEGUNDA RACIÓN**********************************/ 3121

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((28)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3121

/***************************TERCERA RACIÓN*******************************/3121

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3121
			)aux
			JOIN ec_productos p ON p.id_productos=3121
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3121

El producto 1842 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1842
			)aux

Id de Producto: 1842

Inventario almacenes principales: 96

Ventas totales: 110
Proceso de racion producto: 1842

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/110/*ventas totales*/)*96/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1842
					WHERE p.id_productos=1842
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.727272727272727)-(11/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1842

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((20.945454545454545)-(3/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1842

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1842

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((14.836363636363636)-(17/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1842

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.218181818181817)-(17/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1842

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((39.27272727272727)-(22/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=1842


/************************SEGUNDA RACIÓN**********************************/ 1842

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((17.73913043478261)-(3/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1842

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((33.26086956521739)-(22/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=1842

/***************************TERCERA RACIÓN*******************************/1842

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1842
			)aux
			JOIN ec_productos p ON p.id_productos=1842
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1842

El producto 2670 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2670
			)aux

Id de Producto: 2670

Inventario almacenes principales: 39

Ventas totales: 26
Proceso de racion producto: 2670

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/26/*ventas totales*/)*39/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2670
					WHERE p.id_productos=2670
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6)-(15/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2670

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2670

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((22.499999999999996)-(9/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2670

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.5)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2670


/************************SEGUNDA RACIÓN**********************************/ 2670

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((16.363636363636363)-(9/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2670

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7.636363636363637)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2670

/***************************TERCERA RACIÓN*******************************/2670

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2670
			)aux
			JOIN ec_productos p ON p.id_productos=2670
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2670

El producto 3168 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3168
			)aux

Id de Producto: 3168

Inventario almacenes principales: 13

Ventas totales: 29
Proceso de racion producto: 3168

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/29/*ventas totales*/)*13/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3168
					WHERE p.id_productos=3168
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.206896551724137)-(18/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3168

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.793103448275862)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3168


/************************SEGUNDA RACIÓN**********************************/ 3168

/***************************TERCERA RACIÓN*******************************/3168

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3168
			)aux
			JOIN ec_productos p ON p.id_productos=3168
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3168

El producto 2675 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2675
			)aux

Id de Producto: 2675

Inventario almacenes principales: 0

Ventas totales: 21
Proceso de racion producto: 2675

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/21/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2675
					WHERE p.id_productos=2675
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2675

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2675

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2675


/************************SEGUNDA RACIÓN**********************************/ 2675

/***************************TERCERA RACIÓN*******************************/2675

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2675
			)aux
			JOIN ec_productos p ON p.id_productos=2675
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2675

El producto 3054 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3054
			)aux

Id de Producto: 3054

Inventario almacenes principales: 66

Ventas totales: 148
Proceso de racion producto: 3054

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/148/*ventas totales*/)*66/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3054
					WHERE p.id_productos=3054
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.581081081081082)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3054

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.04054054054054)-(13/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3054

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=3054

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=3054

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.04054054054054)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3054

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.364864864864865)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3054

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((24.972972972972975)-(28/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3054


/************************SEGUNDA RACIÓN**********************************/ 3054

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((5.795454545454545)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3054

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((9.204545454545455)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3054

/***************************TERCERA RACIÓN*******************************/3054

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3054
			)aux
			JOIN ec_productos p ON p.id_productos=3054
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3054

El producto 3055 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3055
			)aux

Id de Producto: 3055

Inventario almacenes principales: 31

Ventas totales: 56
Proceso de racion producto: 3055

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/56/*ventas totales*/)*31/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3055
					WHERE p.id_productos=3055
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.107142857142857)-(9/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3055

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.196428571428572)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3055

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=3055

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3055

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.642857142857142)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3055

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.732142857142856)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3055

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.321428571428571)-(14/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3055


/************************SEGUNDA RACIÓN**********************************/ 3055

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-14)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3055

/***************************TERCERA RACIÓN*******************************/3055

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3055
			)aux
			JOIN ec_productos p ON p.id_productos=3055
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3055

El producto 1880 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1880
			)aux

Id de Producto: 1880

Inventario almacenes principales: 32

Ventas totales: 8
Proceso de racion producto: 1880

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/8/*ventas totales*/)*32/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1880
					WHERE p.id_productos=1880
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((16)-(11/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1880

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1880

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1880

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(14/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1880


/************************SEGUNDA RACIÓN**********************************/ 1880

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((9)-(11/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1880

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4.5)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1880

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4.5)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1880

/***************************TERCERA RACIÓN*******************************/1880

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1880
			)aux
			JOIN ec_productos p ON p.id_productos=1880
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1880

El producto 2679 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2679
			)aux

Id de Producto: 2679

Inventario almacenes principales: 70

Ventas totales: 114
Proceso de racion producto: 2679

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/114/*ventas totales*/)*70/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2679
					WHERE p.id_productos=2679
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.75438596491228)-(10/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.280701754385964)-(19/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((20.87719298245614)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((19.64912280701754)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.43859649122807)-(14/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2679


/************************SEGUNDA RACIÓN**********************************/ 2679

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((13.909090909090908)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2679

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((13.090909090909092)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2679

/***************************TERCERA RACIÓN*******************************/2679

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2679
			)aux
			JOIN ec_productos p ON p.id_productos=2679
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2679

El producto 2680 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2680
			)aux

Id de Producto: 2680

Inventario almacenes principales: -1

Ventas totales: 8
Proceso de racion producto: 2680

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/8/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2680
					WHERE p.id_productos=2680
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2680

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2680


/************************SEGUNDA RACIÓN**********************************/ 2680

/***************************TERCERA RACIÓN*******************************/2680

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2680
			)aux
			JOIN ec_productos p ON p.id_productos=2680
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2680

El producto 2681 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2681
			)aux

Id de Producto: 2681

Inventario almacenes principales: -9

Ventas totales: 9
Proceso de racion producto: 2681

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/9/*ventas totales*/)*-9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2681
					WHERE p.id_productos=2681
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2681

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-9)-(6/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2681


/************************SEGUNDA RACIÓN**********************************/ 2681

/***************************TERCERA RACIÓN*******************************/2681

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2681
			)aux
			JOIN ec_productos p ON p.id_productos=2681
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2681

El producto 3272 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3272
			)aux

Id de Producto: 3272

Inventario almacenes principales: 48

Ventas totales: 111
Proceso de racion producto: 3272

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/111/*ventas totales*/)*48/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3272
					WHERE p.id_productos=3272
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.4594594594594597)-(7/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3272

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.324324324324325)-(21/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3272

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.945945945945946)-(14/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3272

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=3272

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=3272

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.54054054054054)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3272

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.216216216216216)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3272

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.513513513513514)-(32/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3272


/************************SEGUNDA RACIÓN**********************************/ 3272

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-15.708333333333332)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3272

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-10.291666666666666)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3272

/***************************TERCERA RACIÓN*******************************/3272

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3272
			)aux
			JOIN ec_productos p ON p.id_productos=3272
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3272

El producto 3170 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3170
			)aux

Id de Producto: 3170

Inventario almacenes principales: 19

Ventas totales: 47
Proceso de racion producto: 3170

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/47/*ventas totales*/)*19/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3170
					WHERE p.id_productos=3170
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.8085106382978723)-(15/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3170

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.680851063829786)-(12/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3170

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.51063829787234)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3170


/************************SEGUNDA RACIÓN**********************************/ 3170

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-8)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3170

/***************************TERCERA RACIÓN*******************************/3170

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3170
			)aux
			JOIN ec_productos p ON p.id_productos=3170
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3170

El producto 1884 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1884
			)aux

Id de Producto: 1884

Inventario almacenes principales: 27

Ventas totales: 35
Proceso de racion producto: 1884

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/35/*ventas totales*/)*27/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1884
					WHERE p.id_productos=1884
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1884

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1884

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((24.685714285714283)-(24/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1884

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.3142857142857145)-(7/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1884


/************************SEGUNDA RACIÓN**********************************/ 1884

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((10)-(24/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1884

/***************************TERCERA RACIÓN*******************************/1884

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1884
			)aux
			JOIN ec_productos p ON p.id_productos=1884
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1884

El producto 3171 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3171
			)aux

Id de Producto: 3171

Inventario almacenes principales: -25

Ventas totales: 0
Proceso de racion producto: 3171

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-25/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3171
					WHERE p.id_productos=3171
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3171


/************************SEGUNDA RACIÓN**********************************/ 3171

/***************************TERCERA RACIÓN*******************************/3171

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3171
			)aux
			JOIN ec_productos p ON p.id_productos=3171
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3171

El producto 3173 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3173
			)aux

Id de Producto: 3173

Inventario almacenes principales: 135

Ventas totales: 59
Proceso de racion producto: 3173

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/59/*ventas totales*/)*135/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3173
					WHERE p.id_productos=3173
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((57.20338983050847)-(27/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3173

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(20/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3173

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.864406779661017)-(20/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3173

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((38.898305084745765)-(17/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3173

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((32.03389830508475)-(6/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=3173


/************************SEGUNDA RACIÓN**********************************/ 3173

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((42.410714285714285)-(27/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3173

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((28.83928571428571)-(17/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3173

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((23.75)-(6/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=3173

/***************************TERCERA RACIÓN*******************************/3173

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3173
			)aux
			JOIN ec_productos p ON p.id_productos=3173
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3173

El producto 1891 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1891
			)aux

Id de Producto: 1891

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 1891

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1891
					WHERE p.id_productos=1891
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1891


/************************SEGUNDA RACIÓN**********************************/ 1891

/***************************TERCERA RACIÓN*******************************/1891

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1891
			)aux
			JOIN ec_productos p ON p.id_productos=1891
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1891

El producto 1911 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1911
			)aux

Id de Producto: 1911

Inventario almacenes principales: 18

Ventas totales: 29
Proceso de racion producto: 1911

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/29/*ventas totales*/)*18/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1911
					WHERE p.id_productos=1911
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.827586206896552)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1911

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.172413793103448)-(9/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1911


/************************SEGUNDA RACIÓN**********************************/ 1911

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((10)-(9/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1911

/***************************TERCERA RACIÓN*******************************/1911

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1911
			)aux
			JOIN ec_productos p ON p.id_productos=1911
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1911

El producto 2708 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2708
			)aux

Id de Producto: 2708

Inventario almacenes principales: -7

Ventas totales: 26
Proceso de racion producto: 2708

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/26/*ventas totales*/)*-7/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2708
					WHERE p.id_productos=2708
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2.153846153846154)-(2/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2708

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4.846153846153846)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2708


/************************SEGUNDA RACIÓN**********************************/ 2708

/***************************TERCERA RACIÓN*******************************/2708

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2708
			)aux
			JOIN ec_productos p ON p.id_productos=2708
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2708

El producto 1904 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1904
			)aux

Id de Producto: 1904

Inventario almacenes principales: 1

Ventas totales: 8
Proceso de racion producto: 1904

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/8/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1904
					WHERE p.id_productos=1904
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.625)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1904

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.375)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1904


/************************SEGUNDA RACIÓN**********************************/ 1904

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1904

/***************************TERCERA RACIÓN*******************************/1904

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1904
			)aux
			JOIN ec_productos p ON p.id_productos=1904
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1904

El producto 1905 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1905
			)aux

Id de Producto: 1905

Inventario almacenes principales: 10

Ventas totales: 25
Proceso de racion producto: 1905

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/25/*ventas totales*/)*10/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1905
					WHERE p.id_productos=1905
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.2)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1905

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1905

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.5999999999999996)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1905

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.2)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1905


/************************SEGUNDA RACIÓN**********************************/ 1905

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-4)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1905

/***************************TERCERA RACIÓN*******************************/1905

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1905
			)aux
			JOIN ec_productos p ON p.id_productos=1905
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1905

El producto 1909 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1909
			)aux

Id de Producto: 1909

Inventario almacenes principales: -9

Ventas totales: 11
Proceso de racion producto: 1909

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/11/*ventas totales*/)*-9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1909
					WHERE p.id_productos=1909
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4.090909090909091)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1909

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1909

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4.909090909090908)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1909


/************************SEGUNDA RACIÓN**********************************/ 1909

/***************************TERCERA RACIÓN*******************************/1909

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1909
			)aux
			JOIN ec_productos p ON p.id_productos=1909
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1909

El producto 3220 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3220
			)aux

Id de Producto: 3220

Inventario almacenes principales: -2

Ventas totales: 7
Proceso de racion producto: 3220

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/7/*ventas totales*/)*-2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3220
					WHERE p.id_productos=3220
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3220

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3220


/************************SEGUNDA RACIÓN**********************************/ 3220

/***************************TERCERA RACIÓN*******************************/3220

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3220
			)aux
			JOIN ec_productos p ON p.id_productos=3220
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3220

El producto 2688 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2688
			)aux

Id de Producto: 2688

Inventario almacenes principales: 5

Ventas totales: 0
Proceso de racion producto: 2688

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2688
					WHERE p.id_productos=2688
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2688


/************************SEGUNDA RACIÓN**********************************/ 2688

/***************************TERCERA RACIÓN*******************************/2688

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2688
			)aux
			JOIN ec_productos p ON p.id_productos=2688
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2688

El producto 2693 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2693
			)aux

Id de Producto: 2693

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2693

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2693
					WHERE p.id_productos=2693
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2693

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2693


/************************SEGUNDA RACIÓN**********************************/ 2693

/***************************TERCERA RACIÓN*******************************/2693

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2693
			)aux
			JOIN ec_productos p ON p.id_productos=2693
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2693

El producto 2697 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2697
			)aux

Id de Producto: 2697

Inventario almacenes principales: 4

Ventas totales: 4
Proceso de racion producto: 2697

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/4/*ventas totales*/)*4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2697
					WHERE p.id_productos=2697
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1)-(3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2697

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3)-(3/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2697


/************************SEGUNDA RACIÓN**********************************/ 2697

/***************************TERCERA RACIÓN*******************************/2697

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2697
			)aux
			JOIN ec_productos p ON p.id_productos=2697
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2697

El producto 3010 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3010
			)aux

Id de Producto: 3010

Inventario almacenes principales: -9

Ventas totales: 17
Proceso de racion producto: 3010

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/17/*ventas totales*/)*-9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3010
					WHERE p.id_productos=3010
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-5.8235294117647065)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3010

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3010

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2.1176470588235294)-(-2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3010

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.0588235294117647)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3010


/************************SEGUNDA RACIÓN**********************************/ 3010

/***************************TERCERA RACIÓN*******************************/3010

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3010
			)aux
			JOIN ec_productos p ON p.id_productos=3010
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3010

El producto 3016 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3016
			)aux

Id de Producto: 3016

Inventario almacenes principales: 21

Ventas totales: 17
Proceso de racion producto: 3016

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/17/*ventas totales*/)*21/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3016
					WHERE p.id_productos=3016
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2352941176470589)-(3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3016

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.176470588235294)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3016

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3016

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.4705882352941178)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3016

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.7058823529411766)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3016

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.411764705882353)-(6/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3016


/************************SEGUNDA RACIÓN**********************************/ 3016

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((5)-(6/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3016

/***************************TERCERA RACIÓN*******************************/3016

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3016
			)aux
			JOIN ec_productos p ON p.id_productos=3016
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3016

El producto 3023 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3023
			)aux

Id de Producto: 3023

Inventario almacenes principales: -1

Ventas totales: 14
Proceso de racion producto: 3023

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/14/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3023
					WHERE p.id_productos=3023
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5714285714285714)-(19/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3023

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3023

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3023

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.42857142857142855)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=3023


/************************SEGUNDA RACIÓN**********************************/ 3023

/***************************TERCERA RACIÓN*******************************/3023

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3023
			)aux
			JOIN ec_productos p ON p.id_productos=3023
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3023

El producto 3040 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3040
			)aux

Id de Producto: 3040

Inventario almacenes principales: 7

Ventas totales: 8
Proceso de racion producto: 3040

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/8/*ventas totales*/)*7/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3040
					WHERE p.id_productos=3040
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.25)-(3/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3040

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.75)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3040


/************************SEGUNDA RACIÓN**********************************/ 3040

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((3)-(3/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3040

/***************************TERCERA RACIÓN*******************************/3040

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3040
			)aux
			JOIN ec_productos p ON p.id_productos=3040
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3040

El producto 3046 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3046
			)aux

Id de Producto: 3046

Inventario almacenes principales: 10

Ventas totales: 40
Proceso de racion producto: 3046

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/40/*ventas totales*/)*10/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3046
					WHERE p.id_productos=3046
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.5)-(9/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3046

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.25)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3046

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3046

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.25)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3046

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.5)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3046

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.5)-(1/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3046


/************************SEGUNDA RACIÓN**********************************/ 3046

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-5.473684210526316)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3046

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-2.526315789473684)-(1/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3046

/***************************TERCERA RACIÓN*******************************/3046

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3046
			)aux
			JOIN ec_productos p ON p.id_productos=3046
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3046

El producto 3047 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3047
			)aux

Id de Producto: 3047

Inventario almacenes principales: 17

Ventas totales: 20
Proceso de racion producto: 3047

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/20/*ventas totales*/)*17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3047
					WHERE p.id_productos=3047
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.25)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3047

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.4000000000000004)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3047

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.350000000000001)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3047


/************************SEGUNDA RACIÓN**********************************/ 3047

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3047

/***************************TERCERA RACIÓN*******************************/3047

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3047
			)aux
			JOIN ec_productos p ON p.id_productos=3047
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3047

El producto 3049 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3049
			)aux

Id de Producto: 3049

Inventario almacenes principales: -1

Ventas totales: 4
Proceso de racion producto: 3049

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/4/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3049
					WHERE p.id_productos=3049
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3049


/************************SEGUNDA RACIÓN**********************************/ 3049

/***************************TERCERA RACIÓN*******************************/3049

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3049
			)aux
			JOIN ec_productos p ON p.id_productos=3049
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3049

El producto 3081 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3081
			)aux

Id de Producto: 3081

Inventario almacenes principales: 3

Ventas totales: 16
Proceso de racion producto: 3081

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/16/*ventas totales*/)*3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3081
					WHERE p.id_productos=3081
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.75)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3081

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.75)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3081

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.5)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3081


/************************SEGUNDA RACIÓN**********************************/ 3081

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-4)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3081

/***************************TERCERA RACIÓN*******************************/3081

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3081
			)aux
			JOIN ec_productos p ON p.id_productos=3081
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3081

El producto 3112 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3112
			)aux

Id de Producto: 3112

Inventario almacenes principales: 36

Ventas totales: 53
Proceso de racion producto: 3112

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/53/*ventas totales*/)*36/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3112
					WHERE p.id_productos=3112
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.6792452830188679)-(7/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3112

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.7169811320754715)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3112

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.113207547169811)-(7/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3112

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.0377358490566038)-(7/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3112

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((24.452830188679243)-(11/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3112


/************************SEGUNDA RACIÓN**********************************/ 3112

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((10)-(11/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3112

/***************************TERCERA RACIÓN*******************************/3112

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3112
			)aux
			JOIN ec_productos p ON p.id_productos=3112
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3112

El producto 3124 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3124
			)aux

Id de Producto: 3124

Inventario almacenes principales: 10

Ventas totales: 17
Proceso de racion producto: 3124

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/17/*ventas totales*/)*10/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3124
					WHERE p.id_productos=3124
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.5882352941176471)-(3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3124

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7647058823529413)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3124

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7647058823529413)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3124

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.882352941176471)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3124


/************************SEGUNDA RACIÓN**********************************/ 3124

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-4)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3124

/***************************TERCERA RACIÓN*******************************/3124

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3124
			)aux
			JOIN ec_productos p ON p.id_productos=3124
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3124

El producto 3125 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3125
			)aux

Id de Producto: 3125

Inventario almacenes principales: 4

Ventas totales: 33
Proceso de racion producto: 3125

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/33/*ventas totales*/)*4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3125
					WHERE p.id_productos=3125
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.24242424242424243)-(1/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3125

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.0909090909090908)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3125

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.8181818181818181)-(1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3125

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3125

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.8484848484848485)-(3/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3125


/************************SEGUNDA RACIÓN**********************************/ 3125

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-7)-(1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3125

/***************************TERCERA RACIÓN*******************************/3125

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3125
			)aux
			JOIN ec_productos p ON p.id_productos=3125
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3125

El producto 3219 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3219
			)aux

Id de Producto: 3219

Inventario almacenes principales: 19

Ventas totales: 45
Proceso de racion producto: 3219

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/45/*ventas totales*/)*19/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3219
					WHERE p.id_productos=3219
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.111111111111111)-(2/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3219

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.333333333333333)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3219

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.8444444444444444)-(6/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3219

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2666666666666666)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3219

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.444444444444445)-(15/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3219


/************************SEGUNDA RACIÓN**********************************/ 3219

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-9)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3219

/***************************TERCERA RACIÓN*******************************/3219

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3219
			)aux
			JOIN ec_productos p ON p.id_productos=3219
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3219

El producto 3221 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3221
			)aux

Id de Producto: 3221

Inventario almacenes principales: -1

Ventas totales: 1
Proceso de racion producto: 3221

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3221
					WHERE p.id_productos=3221
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3221

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3221


/************************SEGUNDA RACIÓN**********************************/ 3221

/***************************TERCERA RACIÓN*******************************/3221

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3221
			)aux
			JOIN ec_productos p ON p.id_productos=3221
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3221

El producto 3222 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3222
			)aux

Id de Producto: 3222

Inventario almacenes principales: 11

Ventas totales: 105
Proceso de racion producto: 3222

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/105/*ventas totales*/)*11/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3222
					WHERE p.id_productos=3222
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.9904761904761905)-(1/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3222

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.8380952380952382)-(11/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3222

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.9904761904761905)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3222

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.780952380952381)-(12/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3222

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.361904761904762)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3222

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.0380952380952384)-(12/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3222


/************************SEGUNDA RACIÓN**********************************/ 3222

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-33)-(1/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3222

/***************************TERCERA RACIÓN*******************************/3222

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3222
			)aux
			JOIN ec_productos p ON p.id_productos=3222
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3222

El producto 3223 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3223
			)aux

Id de Producto: 3223

Inventario almacenes principales: 13

Ventas totales: 25
Proceso de racion producto: 3223

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/25/*ventas totales*/)*13/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3223
					WHERE p.id_productos=3223
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.08)-(6/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3223

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.56)-(7/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3223

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.2)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3223

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.16)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3223


/************************SEGUNDA RACIÓN**********************************/ 3223

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-4)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3223

/***************************TERCERA RACIÓN*******************************/3223

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3223
			)aux
			JOIN ec_productos p ON p.id_productos=3223
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3223

El producto 3250 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3250
			)aux

Id de Producto: 3250

Inventario almacenes principales: 35

Ventas totales: 23
Proceso de racion producto: 3250

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/23/*ventas totales*/)*35/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3250
					WHERE p.id_productos=3250
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(6/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3250

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.565217391304348)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3250

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.130434782608695)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3250

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3250

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((21.304347826086957)-(10/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3250


/************************SEGUNDA RACIÓN**********************************/ 3250

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((3.5999999999999996)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3250

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8.399999999999999)-(10/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3250

/***************************TERCERA RACIÓN*******************************/3250

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3250
			)aux
			JOIN ec_productos p ON p.id_productos=3250
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3250

El producto 3251 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3251
			)aux

Id de Producto: 3251

Inventario almacenes principales: 16

Ventas totales: 14
Proceso de racion producto: 3251

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/14/*ventas totales*/)*16/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3251
					WHERE p.id_productos=3251
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.1428571428571428)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3251

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.714285714285714)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3251

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.714285714285714)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3251

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.4285714285714284)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3251


/************************SEGUNDA RACIÓN**********************************/ 3251

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3251

/***************************TERCERA RACIÓN*******************************/3251

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3251
			)aux
			JOIN ec_productos p ON p.id_productos=3251
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3251

El producto 3252 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3252
			)aux

Id de Producto: 3252

Inventario almacenes principales: 0

Ventas totales: 3
Proceso de racion producto: 3252

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3252
					WHERE p.id_productos=3252
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3252


/************************SEGUNDA RACIÓN**********************************/ 3252

/***************************TERCERA RACIÓN*******************************/3252

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3252
			)aux
			JOIN ec_productos p ON p.id_productos=3252
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3252

El producto 1932 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1932
			)aux

Id de Producto: 1932

Inventario almacenes principales: 4

Ventas totales: 26
Proceso de racion producto: 1932

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/26/*ventas totales*/)*4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1932
					WHERE p.id_productos=1932
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.6153846153846154)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1932

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.3846153846153846)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1932


/************************SEGUNDA RACIÓN**********************************/ 1932

/***************************TERCERA RACIÓN*******************************/1932

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1932
			)aux
			JOIN ec_productos p ON p.id_productos=1932
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1932

El producto 1938 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1938
			)aux

Id de Producto: 1938

Inventario almacenes principales: -3

Ventas totales: 12
Proceso de racion producto: 1938

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/12/*ventas totales*/)*-3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1938
					WHERE p.id_productos=1938
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3)-(-2/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1938


/************************SEGUNDA RACIÓN**********************************/ 1938

/***************************TERCERA RACIÓN*******************************/1938

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1938
			)aux
			JOIN ec_productos p ON p.id_productos=1938
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1938

El producto 1939 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1939
			)aux

Id de Producto: 1939

Inventario almacenes principales: 0

Ventas totales: 23
Proceso de racion producto: 1939

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/23/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1939
					WHERE p.id_productos=1939
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(9/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1939

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1939


/************************SEGUNDA RACIÓN**********************************/ 1939

/***************************TERCERA RACIÓN*******************************/1939

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1939
			)aux
			JOIN ec_productos p ON p.id_productos=1939
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1939

El producto 1940 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1940
			)aux

Id de Producto: 1940

Inventario almacenes principales: 4

Ventas totales: 8
Proceso de racion producto: 1940

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/8/*ventas totales*/)*4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1940
					WHERE p.id_productos=1940
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1940

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1940


/************************SEGUNDA RACIÓN**********************************/ 1940

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1940

/***************************TERCERA RACIÓN*******************************/1940

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1940
			)aux
			JOIN ec_productos p ON p.id_productos=1940
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1940

El producto 3264 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3264
			)aux

Id de Producto: 3264

Inventario almacenes principales: 45

Ventas totales: 44
Proceso de racion producto: 3264

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/44/*ventas totales*/)*45/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3264
					WHERE p.id_productos=3264
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((15.34090909090909)-(17/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3264

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.181818181818182)-(12/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3264

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((21.477272727272727)-(13/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3264


/************************SEGUNDA RACIÓN**********************************/ 3264

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((16)-(13/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3264

/***************************TERCERA RACIÓN*******************************/3264

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3264
			)aux
			JOIN ec_productos p ON p.id_productos=3264
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3264

El producto 1950 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1950
			)aux

Id de Producto: 1950

Inventario almacenes principales: 23

Ventas totales: 20
Proceso de racion producto: 1950

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/20/*ventas totales*/)*23/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1950
					WHERE p.id_productos=1950
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.049999999999999)-(10/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1950

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.1500000000000001)-(9/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1950

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.799999999999999)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1950


/************************SEGUNDA RACIÓN**********************************/ 1950

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1950

/***************************TERCERA RACIÓN*******************************/1950

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1950
			)aux
			JOIN ec_productos p ON p.id_productos=1950
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1950

El producto 1960 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1960
			)aux

Id de Producto: 1960

Inventario almacenes principales: 12

Ventas totales: 0
Proceso de racion producto: 1960

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*12/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1960
					WHERE p.id_productos=1960
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1960

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=1960

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1960

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=1960


/************************SEGUNDA RACIÓN**********************************/ 1960

/***************************TERCERA RACIÓN*******************************/1960

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1960
			)aux
			JOIN ec_productos p ON p.id_productos=1960
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1960

El producto 1964 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1964
			)aux

Id de Producto: 1964

Inventario almacenes principales: -21

Ventas totales: 51
Proceso de racion producto: 1964

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/51/*ventas totales*/)*-21/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1964
					WHERE p.id_productos=1964
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-7.8235294117647065)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1964

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1964

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-13.176470588235293)-(1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1964


/************************SEGUNDA RACIÓN**********************************/ 1964

/***************************TERCERA RACIÓN*******************************/1964

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1964
			)aux
			JOIN ec_productos p ON p.id_productos=1964
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1964

El producto 1965 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1965
			)aux

Id de Producto: 1965

Inventario almacenes principales: 94

Ventas totales: 181
Proceso de racion producto: 1965

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/181/*ventas totales*/)*94/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1965
					WHERE p.id_productos=1965
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((18.696132596685082)-(19/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=1965

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((14.541436464088397)-(16/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1965

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((21.292817679558013)-(21/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1965

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=1965

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=1965

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1965

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.425414364640883)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1965

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.828729281767956)-(13/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1965

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((19.215469613259668)-(20/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=1965


/************************SEGUNDA RACIÓN**********************************/ 1965

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((5)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1965

/***************************TERCERA RACIÓN*******************************/1965

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1965
			)aux
			JOIN ec_productos p ON p.id_productos=1965
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1965

El producto 1970 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1970
			)aux

Id de Producto: 1970

Inventario almacenes principales: -15

Ventas totales: 15
Proceso de racion producto: 1970

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/15/*ventas totales*/)*-15/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1970
					WHERE p.id_productos=1970
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1970

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1970

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-15)-(-8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1970


/************************SEGUNDA RACIÓN**********************************/ 1970

/***************************TERCERA RACIÓN*******************************/1970

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1970
			)aux
			JOIN ec_productos p ON p.id_productos=1970
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1970

El producto 1973 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1973
			)aux

Id de Producto: 1973

Inventario almacenes principales: 22

Ventas totales: 66
Proceso de racion producto: 1973

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/66/*ventas totales*/)*22/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1973
					WHERE p.id_productos=1973
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(17/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1973

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.333333333333334)-(7/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1973

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1973

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.6666666666666665)-(11/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1973

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1973

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(13/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=1973


/************************SEGUNDA RACIÓN**********************************/ 1973

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-8.636363636363637)-(7/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1973

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-10.363636363636363)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1973

/***************************TERCERA RACIÓN*******************************/1973

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1973
			)aux
			JOIN ec_productos p ON p.id_productos=1973
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1973

El producto 1978 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1978
			)aux

Id de Producto: 1978

Inventario almacenes principales: 32

Ventas totales: 70
Proceso de racion producto: 1978

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/70/*ventas totales*/)*32/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1978
					WHERE p.id_productos=1978
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.742857142857143)-(6/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.942857142857143)-(9/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.8285714285714285)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.228571428571428)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.257142857142858)-(17/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=1978


/************************SEGUNDA RACIÓN**********************************/ 1978

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-8)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1978

/***************************TERCERA RACIÓN*******************************/1978

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1978
			)aux
			JOIN ec_productos p ON p.id_productos=1978
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1978

El producto 1981 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1981
			)aux

Id de Producto: 1981

Inventario almacenes principales: 36

Ventas totales: 69
Proceso de racion producto: 1981

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/69/*ventas totales*/)*36/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1981
					WHERE p.id_productos=1981
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.782608695652174)-(6/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1981

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.521739130434781)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1981

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1981

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((14.08695652173913)-(13/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1981

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.608695652173913)-(24/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1981


/************************SEGUNDA RACIÓN**********************************/ 1981

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((2.4375)-(6/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1981

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4.5)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1981

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((5.0625)-(13/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1981

/***************************TERCERA RACIÓN*******************************/1981

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1981
			)aux
			JOIN ec_productos p ON p.id_productos=1981
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1981

El producto 1982 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1982
			)aux

Id de Producto: 1982

Inventario almacenes principales: 15

Ventas totales: 18
Proceso de racion producto: 1982

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/18/*ventas totales*/)*15/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1982
					WHERE p.id_productos=1982
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.166666666666667)-(11/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1982

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1982

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.5)-(7/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1982

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.333333333333334)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1982


/************************SEGUNDA RACIÓN**********************************/ 1982

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-3)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1982

/***************************TERCERA RACIÓN*******************************/1982

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1982
			)aux
			JOIN ec_productos p ON p.id_productos=1982
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1982

El producto 1983 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1983
			)aux

Id de Producto: 1983

Inventario almacenes principales: 5

Ventas totales: 18
Proceso de racion producto: 1983

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/18/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1983
					WHERE p.id_productos=1983
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.5)-(16/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1983

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.5)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1983


/************************SEGUNDA RACIÓN**********************************/ 1983

/***************************TERCERA RACIÓN*******************************/1983

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1983
			)aux
			JOIN ec_productos p ON p.id_productos=1983
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1983

El producto 2721 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2721
			)aux

Id de Producto: 2721

Inventario almacenes principales: -31

Ventas totales: 3
Proceso de racion producto: 2721

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*-31/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2721
					WHERE p.id_productos=2721
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(10/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2721

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2721

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2721

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-31)-(11/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2721


/************************SEGUNDA RACIÓN**********************************/ 2721

/***************************TERCERA RACIÓN*******************************/2721

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2721
			)aux
			JOIN ec_productos p ON p.id_productos=2721
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2721

El producto 2725 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2725
			)aux

Id de Producto: 2725

Inventario almacenes principales: 55

Ventas totales: 36
Proceso de racion producto: 2725

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/36/*ventas totales*/)*55/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2725
					WHERE p.id_productos=2725
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.75)-(11/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2725

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.583333333333333)-(33/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2725

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.166666666666666)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2725

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((27.5)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2725


/************************SEGUNDA RACIÓN**********************************/ 2725

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6)-(11/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2725

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2725

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((12)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2725

/***************************TERCERA RACIÓN*******************************/2725

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2725
			)aux
			JOIN ec_productos p ON p.id_productos=2725
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2725

El producto 2730 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2730
			)aux

Id de Producto: 2730

Inventario almacenes principales: 5

Ventas totales: 10
Proceso de racion producto: 2730

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/10/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2730
					WHERE p.id_productos=2730
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2730

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2730

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1)-(-2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2730


/************************SEGUNDA RACIÓN**********************************/ 2730

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-3)-(-2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2730

/***************************TERCERA RACIÓN*******************************/2730

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2730
			)aux
			JOIN ec_productos p ON p.id_productos=2730
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2730

El producto 3019 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3019
			)aux

Id de Producto: 3019

Inventario almacenes principales: 88

Ventas totales: 93
Proceso de racion producto: 3019

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/93/*ventas totales*/)*88/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3019
					WHERE p.id_productos=3019
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.35483870967742)-(7/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3019

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.67741935483871)-(13/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3019

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.301075268817204)-(31/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3019

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3019

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.24731182795699)-(11/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3019

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((20.81720430107527)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3019

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((24.602150537634408)-(18/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3019


/************************SEGUNDA RACIÓN**********************************/ 3019

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7.135135135135135)-(7/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3019

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8.324324324324325)-(11/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3019

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((13.081081081081082)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3019

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((15.45945945945946)-(18/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3019

/***************************TERCERA RACIÓN*******************************/3019

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3019
			)aux
			JOIN ec_productos p ON p.id_productos=3019
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3019

El producto 3022 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3022
			)aux

Id de Producto: 3022

Inventario almacenes principales: 13

Ventas totales: 15
Proceso de racion producto: 3022

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/15/*ventas totales*/)*13/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3022
					WHERE p.id_productos=3022
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.266666666666667)-(2/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3022

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3022

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7333333333333334)-(14/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3022


/************************SEGUNDA RACIÓN**********************************/ 3022

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-1)-(2/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3022

/***************************TERCERA RACIÓN*******************************/3022

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3022
			)aux
			JOIN ec_productos p ON p.id_productos=3022
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3022

El producto 3082 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3082
			)aux

Id de Producto: 3082

Inventario almacenes principales: 47

Ventas totales: 93
Proceso de racion producto: 3082

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/93/*ventas totales*/)*47/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3082
					WHERE p.id_productos=3082
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.5161290322580645)-(8/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3082

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((17.182795698924732)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3082

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=3082

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=3082

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3082

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.60215053763441)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3082

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.053763440860215)-(17/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3082

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.60215053763441)-(5/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3082

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.043010752688172)-(6/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=3082


/************************SEGUNDA RACIÓN**********************************/ 3082

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((3.849056603773585)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3082

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((2.150943396226415)-(5/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3082

/***************************TERCERA RACIÓN*******************************/3082

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3082
			)aux
			JOIN ec_productos p ON p.id_productos=3082
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3082

El producto 3087 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3087
			)aux

Id de Producto: 3087

Inventario almacenes principales: 1

Ventas totales: 6
Proceso de racion producto: 3087

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/6/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3087
					WHERE p.id_productos=3087
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1)-(24/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3087


/************************SEGUNDA RACIÓN**********************************/ 3087

/***************************TERCERA RACIÓN*******************************/3087

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3087
			)aux
			JOIN ec_productos p ON p.id_productos=3087
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3087

El producto 3088 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3088
			)aux

Id de Producto: 3088

Inventario almacenes principales: 17

Ventas totales: 15
Proceso de racion producto: 3088

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/15/*ventas totales*/)*17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3088
					WHERE p.id_productos=3088
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.066666666666666)-(9/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3088

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.933333333333334)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3088


/************************SEGUNDA RACIÓN**********************************/ 3088

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3088

/***************************TERCERA RACIÓN*******************************/3088

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3088
			)aux
			JOIN ec_productos p ON p.id_productos=3088
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3088

El producto 3148 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3148
			)aux

Id de Producto: 3148

Inventario almacenes principales: -37

Ventas totales: 101
Proceso de racion producto: 3148

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/101/*ventas totales*/)*-37/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3148
					WHERE p.id_productos=3148
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-17.95049504950495)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3148

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-19.04950495049505)-(-3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3148


/************************SEGUNDA RACIÓN**********************************/ 3148

/***************************TERCERA RACIÓN*******************************/3148

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3148
			)aux
			JOIN ec_productos p ON p.id_productos=3148
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3148

El producto 3181 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3181
			)aux

Id de Producto: 3181

Inventario almacenes principales: 31

Ventas totales: 26
Proceso de racion producto: 3181

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/26/*ventas totales*/)*31/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3181
					WHERE p.id_productos=3181
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.769230769230769)-(10/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3181

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((17.884615384615383)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3181

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.346153846153845)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3181

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=3181


/************************SEGUNDA RACIÓN**********************************/ 3181

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3181

/***************************TERCERA RACIÓN*******************************/3181

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3181
			)aux
			JOIN ec_productos p ON p.id_productos=3181
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3181

El producto 3185 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3185
			)aux

Id de Producto: 3185

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 3185

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3185
					WHERE p.id_productos=3185
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 3185

/***************************TERCERA RACIÓN*******************************/3185

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3185
			)aux
			JOIN ec_productos p ON p.id_productos=3185
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3185

El producto 3187 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3187
			)aux

Id de Producto: 3187

Inventario almacenes principales: 30

Ventas totales: 46
Proceso de racion producto: 3187

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/46/*ventas totales*/)*30/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3187
					WHERE p.id_productos=3187
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.3043478260869565)-(10/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3187

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.73913043478261)-(9/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3187

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.478260869565217)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3187

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.478260869565217)-(16/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3187


/************************SEGUNDA RACIÓN**********************************/ 3187

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((2.3225806451612905)-(9/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3187

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1.6774193548387097)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3187

/***************************TERCERA RACIÓN*******************************/3187

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3187
			)aux
			JOIN ec_productos p ON p.id_productos=3187
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3187

El producto 3188 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3188
			)aux

Id de Producto: 3188

Inventario almacenes principales: 1

Ventas totales: 0
Proceso de racion producto: 3188

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3188
					WHERE p.id_productos=3188
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(16/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3188


/************************SEGUNDA RACIÓN**********************************/ 3188

/***************************TERCERA RACIÓN*******************************/3188

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3188
			)aux
			JOIN ec_productos p ON p.id_productos=3188
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3188

El producto 3189 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3189
			)aux

Id de Producto: 3189

Inventario almacenes principales: -4

Ventas totales: 2
Proceso de racion producto: 3189

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*-4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3189
					WHERE p.id_productos=3189
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3189


/************************SEGUNDA RACIÓN**********************************/ 3189

/***************************TERCERA RACIÓN*******************************/3189

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3189
			)aux
			JOIN ec_productos p ON p.id_productos=3189
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3189

El producto 3191 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3191
			)aux

Id de Producto: 3191

Inventario almacenes principales: 30

Ventas totales: 32
Proceso de racion producto: 3191

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/32/*ventas totales*/)*30/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3191
					WHERE p.id_productos=3191
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.5625)-(13/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3191

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.75)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3191

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((19.6875)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3191

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(8/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=3191


/************************SEGUNDA RACIÓN**********************************/ 3191

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-1)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3191

/***************************TERCERA RACIÓN*******************************/3191

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3191
			)aux
			JOIN ec_productos p ON p.id_productos=3191
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3191

El producto 3193 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3193
			)aux

Id de Producto: 3193

Inventario almacenes principales: 16

Ventas totales: 18
Proceso de racion producto: 3193

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/18/*ventas totales*/)*16/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3193
					WHERE p.id_productos=3193
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.6666666666666665)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3193

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.333333333333334)-(12/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3193


/************************SEGUNDA RACIÓN**********************************/ 3193

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((10)-(12/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3193

/***************************TERCERA RACIÓN*******************************/3193

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3193
			)aux
			JOIN ec_productos p ON p.id_productos=3193
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3193

El producto 3195 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3195
			)aux

Id de Producto: 3195

Inventario almacenes principales: 2

Ventas totales: 9
Proceso de racion producto: 3195

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/9/*ventas totales*/)*2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3195
					WHERE p.id_productos=3195
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3195

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3195

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3195


/************************SEGUNDA RACIÓN**********************************/ 3195

/***************************TERCERA RACIÓN*******************************/3195

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3195
			)aux
			JOIN ec_productos p ON p.id_productos=3195
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3195

El producto 3200 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3200
			)aux

Id de Producto: 3200

Inventario almacenes principales: 49

Ventas totales: 67
Proceso de racion producto: 3200

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/67/*ventas totales*/)*49/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3200
					WHERE p.id_productos=3200
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.582089552238806)-(10/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3200

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.970149253731345)-(10/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3200

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.7313432835820896)-(15/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3200

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((21.208955223880597)-(7/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3200

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.507462686567164)-(30/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3200

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=3200


/************************SEGUNDA RACIÓN**********************************/ 3200

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-6.136363636363636)-(10/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3200

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-11.863636363636363)-(7/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3200

/***************************TERCERA RACIÓN*******************************/3200

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3200
			)aux
			JOIN ec_productos p ON p.id_productos=3200
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3200

El producto 3203 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3203
			)aux

Id de Producto: 3203

Inventario almacenes principales: 33

Ventas totales: 23
Proceso de racion producto: 3203

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/23/*ventas totales*/)*33/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3203
					WHERE p.id_productos=3203
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.739130434782608)-(11/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3203

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((27.26086956521739)-(7/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3203


/************************SEGUNDA RACIÓN**********************************/ 3203

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((22)-(7/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3203

/***************************TERCERA RACIÓN*******************************/3203

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3203
			)aux
			JOIN ec_productos p ON p.id_productos=3203
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3203

El producto 3206 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3206
			)aux

Id de Producto: 3206

Inventario almacenes principales: 60

Ventas totales: 35
Proceso de racion producto: 3206

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/35/*ventas totales*/)*60/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3206
					WHERE p.id_productos=3206
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12)-(7/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3206

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((24)-(14/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3206

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12)-(19/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3206

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12)-(19/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3206


/************************SEGUNDA RACIÓN**********************************/ 3206

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7.333333333333333)-(7/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3206

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((14.666666666666666)-(14/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3206

/***************************TERCERA RACIÓN*******************************/3206

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3206
			)aux
			JOIN ec_productos p ON p.id_productos=3206
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3206

El producto 2741 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2741
			)aux

Id de Producto: 2741

Inventario almacenes principales: 45

Ventas totales: 8
Proceso de racion producto: 2741

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/8/*ventas totales*/)*45/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2741
					WHERE p.id_productos=2741
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2741

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((28.125)-(13/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2741

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2741

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.625)-(11/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2741

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.25)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2741


/************************SEGUNDA RACIÓN**********************************/ 2741

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((15.714285714285715)-(13/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2741

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6.285714285714286)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2741

/***************************TERCERA RACIÓN*******************************/2741

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2741
			)aux
			JOIN ec_productos p ON p.id_productos=2741
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2741

El producto 2742 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2742
			)aux

Id de Producto: 2742

Inventario almacenes principales: 21

Ventas totales: 13
Proceso de racion producto: 2742

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/13/*ventas totales*/)*21/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2742
					WHERE p.id_productos=2742
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.461538461538462)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2742

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.230769230769231)-(18/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2742

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2742

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.230769230769231)-(6/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2742

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.076923076923077)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2742


/************************SEGUNDA RACIÓN**********************************/ 2742

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-1.3333333333333333)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2742

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-1.6666666666666667)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2742

/***************************TERCERA RACIÓN*******************************/2742

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2742
			)aux
			JOIN ec_productos p ON p.id_productos=2742
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2742

El producto 2743 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2743
			)aux

Id de Producto: 2743

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2743

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2743
					WHERE p.id_productos=2743
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2743

/***************************TERCERA RACIÓN*******************************/2743

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2743
			)aux
			JOIN ec_productos p ON p.id_productos=2743
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2743

El producto 2745 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2745
			)aux

Id de Producto: 2745

Inventario almacenes principales: 122

Ventas totales: 78
Proceso de racion producto: 2745

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/78/*ventas totales*/)*122/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2745
					WHERE p.id_productos=2745
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.256410256410256)-(9/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((34.41025641025641)-(-2/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((21.897435897435898)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((18.76923076923077)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((14.076923076923078)-(11/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((17.205128205128204)-(1/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.384615384615385)-(6/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2745


/************************SEGUNDA RACIÓN**********************************/ 2745

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((33.5945945945946)-(-2/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2745

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((21.37837837837838)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2745

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((18.324324324324326)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2745

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((13.743243243243244)-(11/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2745

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((16.7972972972973)-(1/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2745

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((9.162162162162163)-(6/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2745

/***************************TERCERA RACIÓN*******************************/2745

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2745
			)aux
			JOIN ec_productos p ON p.id_productos=2745
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2745

El producto 3080 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3080
			)aux

Id de Producto: 3080

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 3080

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3080
					WHERE p.id_productos=3080
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3080


/************************SEGUNDA RACIÓN**********************************/ 3080

/***************************TERCERA RACIÓN*******************************/3080

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3080
			)aux
			JOIN ec_productos p ON p.id_productos=3080
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3080

El producto 2753 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2753
			)aux

Id de Producto: 2753

Inventario almacenes principales: 29

Ventas totales: 23
Proceso de racion producto: 2753

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/23/*ventas totales*/)*29/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2753
					WHERE p.id_productos=2753
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2608695652173914)-(9/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2753

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.304347826086956)-(18/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2753

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2753

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((21.434782608695652)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2753


/************************SEGUNDA RACIÓN**********************************/ 2753

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((2)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2753

/***************************TERCERA RACIÓN*******************************/2753

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2753
			)aux
			JOIN ec_productos p ON p.id_productos=2753
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2753

El producto 3060 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3060
			)aux

Id de Producto: 3060

Inventario almacenes principales: 34

Ventas totales: 31
Proceso de racion producto: 3060

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/31/*ventas totales*/)*34/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3060
					WHERE p.id_productos=3060
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(13/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3060

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(11/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3060

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.387096774193548)-(15/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3060

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((29.612903225806452)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3060


/************************SEGUNDA RACIÓN**********************************/ 3060

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-5)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3060

/***************************TERCERA RACIÓN*******************************/3060

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3060
			)aux
			JOIN ec_productos p ON p.id_productos=3060
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3060

El producto 2768 entra en racion

Presentacion: 50

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/50 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2768
			)aux

Id de Producto: 2768

Inventario almacenes principales: -9.7

Ventas totales: 286
Proceso de racion producto: 2768

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/286/*ventas totales*/)*-9.7/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2768
					WHERE p.id_productos=2768
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.10174825174825175)-(47/50)) * 50  
						WHERE id_sucursal=3 AND id_producto=2768

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-5.596153846153845)-(85/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2768

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.4244755244755243)-(8/50)) * 50  
						WHERE id_sucursal=8 AND id_producto=2768

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(50/50)) * 50  
						WHERE id_sucursal=9 AND id_producto=2768

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2.5776223776223772)-(-26/50)) * 50  
						WHERE id_sucursal=10 AND id_producto=2768

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/50)) * 50  
						WHERE id_sucursal=11 AND id_producto=2768


/************************SEGUNDA RACIÓN**********************************/ 2768

/***************************TERCERA RACIÓN*******************************/2768

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2768
			)aux
			JOIN ec_productos p ON p.id_productos=2768
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2768

El producto 2769 entra en racion

Presentacion: 50

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/50 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2769
			)aux

Id de Producto: 2769

Inventario almacenes principales: -2.96

Ventas totales: 670
Proceso de racion producto: 2769

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/670/*ventas totales*/)*-2.96/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2769
					WHERE p.id_productos=2769
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.3755223880597015)-(76/50)) * 50  
						WHERE id_sucursal=2 AND id_producto=2769

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.02208955223880597)-(145/50)) * 50  
						WHERE id_sucursal=3 AND id_producto=2769

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.2546865671641791)-(166/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2769

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/50)) * 50  
						WHERE id_sucursal=7 AND id_producto=2769

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.8261492537313433)-(124/50)) * 50  
						WHERE id_sucursal=8 AND id_producto=2769

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.4815522388059701)-(79/50)) * 50  
						WHERE id_sucursal=9 AND id_producto=2769


/************************SEGUNDA RACIÓN**********************************/ 2769

/***************************TERCERA RACIÓN*******************************/2769

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2769
			)aux
			JOIN ec_productos p ON p.id_productos=2769
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2769

El producto 2047 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2047
			)aux

Id de Producto: 2047

Inventario almacenes principales: 0

Ventas totales: 9
Proceso de racion producto: 2047

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/9/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2047
					WHERE p.id_productos=2047
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2047


/************************SEGUNDA RACIÓN**********************************/ 2047

/***************************TERCERA RACIÓN*******************************/2047

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2047
			)aux
			JOIN ec_productos p ON p.id_productos=2047
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2047

El producto 1808 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1808
			)aux

Id de Producto: 1808

Inventario almacenes principales: -276

Ventas totales: 280
Proceso de racion producto: 1808

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/280/*ventas totales*/)*-276/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1808
					WHERE p.id_productos=1808
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=1808

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-13.8)-(-14/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1808

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-160.67142857142858)-(-160/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1808

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1808

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-57.17142857142858)-(-58/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1808

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-44.35714285714286)-(-44/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1808


/************************SEGUNDA RACIÓN**********************************/ 1808

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-58)-(-58/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1808

/***************************TERCERA RACIÓN*******************************/1808

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1808
			)aux
			JOIN ec_productos p ON p.id_productos=1808
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1808

El producto 2013 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2013
			)aux

Id de Producto: 2013

Inventario almacenes principales: -20

Ventas totales: 30
Proceso de racion producto: 2013

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/30/*ventas totales*/)*-20/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2013
					WHERE p.id_productos=2013
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-20)-(-4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2013


/************************SEGUNDA RACIÓN**********************************/ 2013

/***************************TERCERA RACIÓN*******************************/2013

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2013
			)aux
			JOIN ec_productos p ON p.id_productos=2013
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2013

El producto 2017 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2017
			)aux

Id de Producto: 2017

Inventario almacenes principales: 14

Ventas totales: 1
Proceso de racion producto: 2017

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*14/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2017
					WHERE p.id_productos=2017
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((14)-(14/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2017


/************************SEGUNDA RACIÓN**********************************/ 2017

/***************************TERCERA RACIÓN*******************************/2017

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2017
			)aux
			JOIN ec_productos p ON p.id_productos=2017
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2017

El producto 2184 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2184
			)aux

Id de Producto: 2184

Inventario almacenes principales: -8

Ventas totales: 15
Proceso de racion producto: 2184

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/15/*ventas totales*/)*-8/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2184
					WHERE p.id_productos=2184
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5333333333333333)-(-1/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2184

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(-3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2184

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3.2)-(20/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2184

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2.1333333333333333)-(6/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2184

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.6)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2184

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5333333333333333)-(0/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2184


/************************SEGUNDA RACIÓN**********************************/ 2184

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0)-(-3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2184

/***************************TERCERA RACIÓN*******************************/2184

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2184
			)aux
			JOIN ec_productos p ON p.id_productos=2184
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2184

El producto 2192 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2192
			)aux

Id de Producto: 2192

Inventario almacenes principales: -42

Ventas totales: 0
Proceso de racion producto: 2192

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-42/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2192
					WHERE p.id_productos=2192
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(6/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2192

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2192

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2192


/************************SEGUNDA RACIÓN**********************************/ 2192

/***************************TERCERA RACIÓN*******************************/2192

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2192
			)aux
			JOIN ec_productos p ON p.id_productos=2192
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2192

El producto 2193 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2193
			)aux

Id de Producto: 2193

Inventario almacenes principales: -47

Ventas totales: 1
Proceso de racion producto: 2193

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*-47/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2193
					WHERE p.id_productos=2193
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(6/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2193

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(24/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2193

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-47)-(23/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2193


/************************SEGUNDA RACIÓN**********************************/ 2193

/***************************TERCERA RACIÓN*******************************/2193

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2193
			)aux
			JOIN ec_productos p ON p.id_productos=2193
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2193

El producto 2194 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2194
			)aux

Id de Producto: 2194

Inventario almacenes principales: -30

Ventas totales: 0
Proceso de racion producto: 2194

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-30/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2194
					WHERE p.id_productos=2194
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2194

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2194


/************************SEGUNDA RACIÓN**********************************/ 2194

/***************************TERCERA RACIÓN*******************************/2194

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2194
			)aux
			JOIN ec_productos p ON p.id_productos=2194
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2194

El producto 2195 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2195
			)aux

Id de Producto: 2195

Inventario almacenes principales: -30

Ventas totales: 0
Proceso de racion producto: 2195

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-30/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2195
					WHERE p.id_productos=2195
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2195

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2195


/************************SEGUNDA RACIÓN**********************************/ 2195

/***************************TERCERA RACIÓN*******************************/2195

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2195
			)aux
			JOIN ec_productos p ON p.id_productos=2195
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2195

El producto 2196 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2196
			)aux

Id de Producto: 2196

Inventario almacenes principales: -30

Ventas totales: 0
Proceso de racion producto: 2196

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-30/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2196
					WHERE p.id_productos=2196
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2196

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2196


/************************SEGUNDA RACIÓN**********************************/ 2196

/***************************TERCERA RACIÓN*******************************/2196

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2196
			)aux
			JOIN ec_productos p ON p.id_productos=2196
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2196

El producto 2204 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2204
			)aux

Id de Producto: 2204

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2204

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2204
					WHERE p.id_productos=2204
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2204


/************************SEGUNDA RACIÓN**********************************/ 2204

/***************************TERCERA RACIÓN*******************************/2204

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2204
			)aux
			JOIN ec_productos p ON p.id_productos=2204
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2204

El producto 2215 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2215
			)aux

Id de Producto: 2215

Inventario almacenes principales: 21

Ventas totales: 30
Proceso de racion producto: 2215

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/30/*ventas totales*/)*21/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2215
					WHERE p.id_productos=2215
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2215

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.1)-(7/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2215

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2215

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2215

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.9)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2215


/************************SEGUNDA RACIÓN**********************************/ 2215

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((9.1)-(7/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2215

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((11.9)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2215

/***************************TERCERA RACIÓN*******************************/2215

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2215
			)aux
			JOIN ec_productos p ON p.id_productos=2215
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2215

El producto 2216 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2216
			)aux

Id de Producto: 2216

Inventario almacenes principales: 11

Ventas totales: 15
Proceso de racion producto: 2216

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/15/*ventas totales*/)*11/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2216
					WHERE p.id_productos=2216
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.933333333333333)-(11/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2216

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.066666666666666)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2216


/************************SEGUNDA RACIÓN**********************************/ 2216

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2216

/***************************TERCERA RACIÓN*******************************/2216

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2216
			)aux
			JOIN ec_productos p ON p.id_productos=2216
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2216

El producto 2217 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2217
			)aux

Id de Producto: 2217

Inventario almacenes principales: 10

Ventas totales: 5
Proceso de racion producto: 2217

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/5/*ventas totales*/)*10/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2217
					WHERE p.id_productos=2217
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8)-(14/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2217

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2217


/************************SEGUNDA RACIÓN**********************************/ 2217

/***************************TERCERA RACIÓN*******************************/2217

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2217
			)aux
			JOIN ec_productos p ON p.id_productos=2217
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2217

El producto 2911 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2911
			)aux

Id de Producto: 2911

Inventario almacenes principales: 76

Ventas totales: 185
Proceso de racion producto: 2911

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/185/*ventas totales*/)*76/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2911
					WHERE p.id_productos=2911
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.340540540540541)-(10/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2911

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.44864864864865)-(11/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2911

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((18.486486486486488)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2911

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((18.8972972972973)-(23/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2911

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((15.610810810810811)-(15/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2911

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.751351351351351)-(14/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2911

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.464864864864865)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2911


/************************SEGUNDA RACIÓN**********************************/ 2911

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((9.101123595505618)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2911

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7.685393258426966)-(15/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2911

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1.2134831460674156)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2911

/***************************TERCERA RACIÓN*******************************/2911

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2911
			)aux
			JOIN ec_productos p ON p.id_productos=2911
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2911

El producto 2913 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2913
			)aux

Id de Producto: 2913

Inventario almacenes principales: 140

Ventas totales: 470
Proceso de racion producto: 2913

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/470/*ventas totales*/)*140/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2913
					WHERE p.id_productos=2913
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.914893617021276)-(18/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2913

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((16.382978723404257)-(15/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2913

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((35.744680851063826)-(-2/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2913

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2913

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((27.70212765957447)-(13/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2913

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((25.914893617021274)-(21/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2913

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((20.5531914893617)-(21/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2913

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7872340425531914)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2913


/************************SEGUNDA RACIÓN**********************************/ 2913

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((15.38781163434903)-(15/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2913

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((33.57340720221607)-(-2/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2913

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((26.01939058171745)-(13/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2913

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((24.34072022160665)-(21/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2913

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1.6786703601108035)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2913

/***************************TERCERA RACIÓN*******************************/2913

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2913
			)aux
			JOIN ec_productos p ON p.id_productos=2913
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2913

El producto 2915 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2915
			)aux

Id de Producto: 2915

Inventario almacenes principales: -185

Ventas totales: 536
Proceso de racion producto: 2915

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/536/*ventas totales*/)*-185/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2915
					WHERE p.id_productos=2915
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-14.84141791044776)-(-1/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2915

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-24.16044776119403)-(1/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2915

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-41.76305970149254)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2915

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2915

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-22.779850746268657)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2915

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-45.559701492537314)-(-6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2915

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-35.8955223880597)-(6/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2915


/************************SEGUNDA RACIÓN**********************************/ 2915

/***************************TERCERA RACIÓN*******************************/2915

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2915
			)aux
			JOIN ec_productos p ON p.id_productos=2915
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2915

El producto 2073 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2073
			)aux

Id de Producto: 2073

Inventario almacenes principales: -20

Ventas totales: 20
Proceso de racion producto: 2073

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/20/*ventas totales*/)*-20/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2073
					WHERE p.id_productos=2073
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-20)-(-20/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2073

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2073


/************************SEGUNDA RACIÓN**********************************/ 2073

/***************************TERCERA RACIÓN*******************************/2073

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2073
			)aux
			JOIN ec_productos p ON p.id_productos=2073
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2073

El producto 2080 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2080
			)aux

Id de Producto: 2080

Inventario almacenes principales: 30

Ventas totales: 18
Proceso de racion producto: 2080

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/18/*ventas totales*/)*30/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2080
					WHERE p.id_productos=2080
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((30)-(30/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2080

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2080


/************************SEGUNDA RACIÓN**********************************/ 2080

/***************************TERCERA RACIÓN*******************************/2080

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2080
			)aux
			JOIN ec_productos p ON p.id_productos=2080
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2080

El producto 2081 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2081
			)aux

Id de Producto: 2081

Inventario almacenes principales: 9

Ventas totales: 0
Proceso de racion producto: 2081

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2081
					WHERE p.id_productos=2081
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2081

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2081

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2081


/************************SEGUNDA RACIÓN**********************************/ 2081

/***************************TERCERA RACIÓN*******************************/2081

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2081
			)aux
			JOIN ec_productos p ON p.id_productos=2081
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2081

El producto 2934 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2934
			)aux

Id de Producto: 2934

Inventario almacenes principales: -78

Ventas totales: 36
Proceso de racion producto: 2934

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/36/*ventas totales*/)*-78/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2934
					WHERE p.id_productos=2934
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(12/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2934

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2934

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-78)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2934

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2934

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2934

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(40/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2934

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(40/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2934


/************************SEGUNDA RACIÓN**********************************/ 2934

/***************************TERCERA RACIÓN*******************************/2934

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2934
			)aux
			JOIN ec_productos p ON p.id_productos=2934
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2934

El producto 2780 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2780
			)aux

Id de Producto: 2780

Inventario almacenes principales: -84

Ventas totales: 6
Proceso de racion producto: 2780

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/6/*ventas totales*/)*-84/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2780
					WHERE p.id_productos=2780
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-84)-(6/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2780

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2780

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2780

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2780

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(40/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2780

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(40/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2780


/************************SEGUNDA RACIÓN**********************************/ 2780

/***************************TERCERA RACIÓN*******************************/2780

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2780
			)aux
			JOIN ec_productos p ON p.id_productos=2780
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2780

El producto 2935 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2935
			)aux

Id de Producto: 2935

Inventario almacenes principales: -72

Ventas totales: 0
Proceso de racion producto: 2935

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-72/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2935
					WHERE p.id_productos=2935
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2935

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2935

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2935

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2935

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2935

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(48/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2935

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(36/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2935


/************************SEGUNDA RACIÓN**********************************/ 2935

/***************************TERCERA RACIÓN*******************************/2935

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2935
			)aux
			JOIN ec_productos p ON p.id_productos=2935
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2935

El producto 3254 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3254
			)aux

Id de Producto: 3254

Inventario almacenes principales: -84

Ventas totales: 0
Proceso de racion producto: 3254

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-84/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3254
					WHERE p.id_productos=3254
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(20/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3254

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3254

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(48/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3254

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(48/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3254


/************************SEGUNDA RACIÓN**********************************/ 3254

/***************************TERCERA RACIÓN*******************************/3254

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3254
			)aux
			JOIN ec_productos p ON p.id_productos=3254
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3254

El producto 2936 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2936
			)aux

Id de Producto: 2936

Inventario almacenes principales: -78

Ventas totales: 2
Proceso de racion producto: 2936

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*-78/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2936
					WHERE p.id_productos=2936
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2936

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2936

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2936

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2936

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-78)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2936


/************************SEGUNDA RACIÓN**********************************/ 2936

/***************************TERCERA RACIÓN*******************************/2936

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2936
			)aux
			JOIN ec_productos p ON p.id_productos=2936
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2936

El producto 2937 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2937
			)aux

Id de Producto: 2937

Inventario almacenes principales: 41

Ventas totales: 26
Proceso de racion producto: 2937

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/26/*ventas totales*/)*41/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2937
					WHERE p.id_productos=2937
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2937

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((37.84615384615385)-(44/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2937

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2937

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2937

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.153846153846154)-(27/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2937

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(32/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2937


/************************SEGUNDA RACIÓN**********************************/ 2937

/***************************TERCERA RACIÓN*******************************/2937

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2937
			)aux
			JOIN ec_productos p ON p.id_productos=2937
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2937

El producto 2086 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2086
			)aux

Id de Producto: 2086

Inventario almacenes principales: -4

Ventas totales: 259
Proceso de racion producto: 2086

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/259/*ventas totales*/)*-4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2086
					WHERE p.id_productos=2086
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.498069498069498)-(43/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2086

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2086

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.525096525096525)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2086

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.6486486486486487)-(9/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2086

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5868725868725869)-(34/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2086

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.7413127413127413)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2086


/************************SEGUNDA RACIÓN**********************************/ 2086

/***************************TERCERA RACIÓN*******************************/2086

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2086
			)aux
			JOIN ec_productos p ON p.id_productos=2086
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2086

El producto 2088 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2088
			)aux

Id de Producto: 2088

Inventario almacenes principales: 187

Ventas totales: 110
Proceso de racion producto: 2088

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/110/*ventas totales*/)*187/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2088
					WHERE p.id_productos=2088
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((30.6)-(26/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2088

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((40.8)-(54/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2088

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((74.8)-(62/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2088

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.6)-(36/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2088

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.8)-(44/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2088

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((20.4)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2088


/************************SEGUNDA RACIÓN**********************************/ 2088

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((12.891891891891893)-(26/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2088

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((31.513513513513516)-(62/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2088

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8.594594594594595)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2088

/***************************TERCERA RACIÓN*******************************/2088

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2088
			)aux
			JOIN ec_productos p ON p.id_productos=2088
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2088

El producto 2089 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2089
			)aux

Id de Producto: 2089

Inventario almacenes principales: 69

Ventas totales: 21
Proceso de racion producto: 2089

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/21/*ventas totales*/)*69/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2089
					WHERE p.id_productos=2089
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((19.71428571428571)-(24/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2089

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((29.57142857142857)-(69/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2089

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((19.71428571428571)-(21/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2089


/************************SEGUNDA RACIÓN**********************************/ 2089

/***************************TERCERA RACIÓN*******************************/2089

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2089
			)aux
			JOIN ec_productos p ON p.id_productos=2089
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2089

El producto 2096 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2096
			)aux

Id de Producto: 2096

Inventario almacenes principales: 391

Ventas totales: 251
Proceso de racion producto: 2096

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/251/*ventas totales*/)*391/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2096
					WHERE p.id_productos=2096
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(18/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2096

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((34.27091633466136)-(44/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2096

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((140.19920318725102)-(47/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2096

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2096

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((74.77290836653387)-(122/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2096

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((66.98406374501991)-(80/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2096

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((37.386454183266935)-(84/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2096

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((37.386454183266935)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2096


/************************SEGUNDA RACIÓN**********************************/ 2096

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((33.94736842105263)-(47/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2096

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((9.052631578947368)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2096

/***************************TERCERA RACIÓN*******************************/2096

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2096
			)aux
			JOIN ec_productos p ON p.id_productos=2096
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2096

El producto 2100 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2100
			)aux

Id de Producto: 2100

Inventario almacenes principales: 144

Ventas totales: 109
Proceso de racion producto: 2100

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/109/*ventas totales*/)*144/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2100
					WHERE p.id_productos=2100
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.926605504587156)-(24/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2100

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((89.8348623853211)-(19/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2100

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.889908256880734)-(29/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2100

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((33.02752293577982)-(29/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2100

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.3211009174311927)-(43/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2100


/************************SEGUNDA RACIÓN**********************************/ 2100

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((35.096774193548384)-(19/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2100

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((12.903225806451612)-(29/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2100

/***************************TERCERA RACIÓN*******************************/2100

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2100
			)aux
			JOIN ec_productos p ON p.id_productos=2100
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2100

El producto 2103 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2103
			)aux

Id de Producto: 2103

Inventario almacenes principales: 47

Ventas totales: 0
Proceso de racion producto: 2103

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*47/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2103
					WHERE p.id_productos=2103
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2103

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(47/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2103


/************************SEGUNDA RACIÓN**********************************/ 2103

/***************************TERCERA RACIÓN*******************************/2103

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2103
			)aux
			JOIN ec_productos p ON p.id_productos=2103
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2103

El producto 2117 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2117
			)aux

Id de Producto: 2117

Inventario almacenes principales: 286

Ventas totales: 309
Proceso de racion producto: 2117

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/309/*ventas totales*/)*286/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2117
					WHERE p.id_productos=2117
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.5533980582524265)-(31/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2117

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((44.42718446601941)-(30/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2117

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((43.50161812297735)-(44/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2117

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2117

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((92.55663430420712)-(69/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2117

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((71.26860841423948)-(64/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2117

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((28.692556634304207)-(48/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2117


/************************SEGUNDA RACIÓN**********************************/ 2117

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((34.77333333333333)-(30/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2117

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((72.44444444444444)-(69/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2117

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((55.78222222222222)-(64/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2117

/***************************TERCERA RACIÓN*******************************/2117

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2117
			)aux
			JOIN ec_productos p ON p.id_productos=2117
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2117

El producto 2120 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2120
			)aux

Id de Producto: 2120

Inventario almacenes principales: 397

Ventas totales: 420
Proceso de racion producto: 2120

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/420/*ventas totales*/)*397/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2120
					WHERE p.id_productos=2120
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.233333333333333)-(30/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2120

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((43.48095238095238)-(53/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2120

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((91.68809523809524)-(36/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2120

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2120

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((91.68809523809524)-(93/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2120

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((71.83809523809524)-(58/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2120

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((62.385714285714286)-(68/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2120

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((22.685714285714283)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2120


/************************SEGUNDA RACIÓN**********************************/ 2120

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((75.33502538071066)-(36/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2120

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((59.025380710659896)-(58/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2120

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((18.639593908629443)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2120

/***************************TERCERA RACIÓN*******************************/2120

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2120
			)aux
			JOIN ec_productos p ON p.id_productos=2120
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2120

El producto 2128 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2128
			)aux

Id de Producto: 2128

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2128

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2128
					WHERE p.id_productos=2128
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2128

/***************************TERCERA RACIÓN*******************************/2128

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2128
			)aux
			JOIN ec_productos p ON p.id_productos=2128
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2128

El producto 2132 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2132
			)aux

Id de Producto: 2132

Inventario almacenes principales: 0

Ventas totales: 5
Proceso de racion producto: 2132

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/5/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2132
					WHERE p.id_productos=2132
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2132


/************************SEGUNDA RACIÓN**********************************/ 2132

/***************************TERCERA RACIÓN*******************************/2132

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2132
			)aux
			JOIN ec_productos p ON p.id_productos=2132
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2132

El producto 3238 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3238
			)aux

Id de Producto: 3238

Inventario almacenes principales: -37

Ventas totales: 294
Proceso de racion producto: 3238

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/294/*ventas totales*/)*-37/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3238
					WHERE p.id_productos=3238
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-11.955782312925171)-(10/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3238

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-14.976190476190476)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3238

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-10.068027210884354)-(55/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3238


/************************SEGUNDA RACIÓN**********************************/ 3238

/***************************TERCERA RACIÓN*******************************/3238

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3238
			)aux
			JOIN ec_productos p ON p.id_productos=3238
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3238

El producto 3239 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3239
			)aux

Id de Producto: 3239

Inventario almacenes principales: 55

Ventas totales: 32
Proceso de racion producto: 3239

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/32/*ventas totales*/)*55/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3239
					WHERE p.id_productos=3239
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((20.625)-(33/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3239

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((34.375)-(22/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3239


/************************SEGUNDA RACIÓN**********************************/ 3239

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((22)-(22/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3239

/***************************TERCERA RACIÓN*******************************/3239

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3239
			)aux
			JOIN ec_productos p ON p.id_productos=3239
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3239

El producto 3249 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3249
			)aux

Id de Producto: 3249

Inventario almacenes principales: 96

Ventas totales: 214
Proceso de racion producto: 3249

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/214/*ventas totales*/)*96/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3249
					WHERE p.id_productos=3249
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.383177570093458)-(36/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3249

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((27.36448598130841)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3249

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((34.54205607476635)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3249

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((17.49532710280374)-(25/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3249

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.214953271028037)-(23/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3249


/************************SEGUNDA RACIÓN**********************************/ 3249

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((5.304347826086957)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3249

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6.695652173913044)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3249

/***************************TERCERA RACIÓN*******************************/3249

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3249
			)aux
			JOIN ec_productos p ON p.id_productos=3249
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3249

El producto 2717 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2717
			)aux

Id de Producto: 2717

Inventario almacenes principales: -74

Ventas totales: 2
Proceso de racion producto: 2717

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*-74/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2717
					WHERE p.id_productos=2717
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-74)-(10/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2717

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2717

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2717

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2717

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2717

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(40/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2717

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(40/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2717


/************************SEGUNDA RACIÓN**********************************/ 2717

/***************************TERCERA RACIÓN*******************************/2717

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2717
			)aux
			JOIN ec_productos p ON p.id_productos=2717
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2717

El producto 2952 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2952
			)aux

Id de Producto: 2952

Inventario almacenes principales: -84

Ventas totales: 12
Proceso de racion producto: 2952

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/12/*ventas totales*/)*-84/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2952
					WHERE p.id_productos=2952
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-42)-(6/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2952

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2952

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2952

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2952

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-42)-(30/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2952

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(30/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2952


/************************SEGUNDA RACIÓN**********************************/ 2952

/***************************TERCERA RACIÓN*******************************/2952

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2952
			)aux
			JOIN ec_productos p ON p.id_productos=2952
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2952

El producto 3242 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3242
			)aux

Id de Producto: 3242

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 3242

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3242
					WHERE p.id_productos=3242
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 3242

/***************************TERCERA RACIÓN*******************************/3242

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3242
			)aux
			JOIN ec_productos p ON p.id_productos=3242
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3242

El producto 3279 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3279
			)aux

Id de Producto: 3279

Inventario almacenes principales: 152

Ventas totales: 359
Proceso de racion producto: 3279

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/359/*ventas totales*/)*152/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3279
					WHERE p.id_productos=3279
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((36.41225626740947)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3279

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.54874651810585)-(28/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3279

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((35.98885793871867)-(42/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3279

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((27.944289693593316)-(48/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3279

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((38.1058495821727)-(45/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3279


/************************SEGUNDA RACIÓN**********************************/ 3279

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-11)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3279

/***************************TERCERA RACIÓN*******************************/3279

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3279
			)aux
			JOIN ec_productos p ON p.id_productos=3279
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3279

El producto 2138 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2138
			)aux

Id de Producto: 2138

Inventario almacenes principales: 17

Ventas totales: 59
Proceso de racion producto: 2138

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/59/*ventas totales*/)*17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2138
					WHERE p.id_productos=2138
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.237288135593221)-(9/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2138

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2138

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.762711864406779)-(15/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2138


/************************SEGUNDA RACIÓN**********************************/ 2138

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((2)-(9/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2138

/***************************TERCERA RACIÓN*******************************/2138

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2138
			)aux
			JOIN ec_productos p ON p.id_productos=2138
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2138

El producto 2152 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2152
			)aux

Id de Producto: 2152

Inventario almacenes principales: 319

Ventas totales: 251
Proceso de racion producto: 2152

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/251/*ventas totales*/)*319/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2152
					WHERE p.id_productos=2152
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((15.250996015936254)-(23/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2152

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.896414342629482)-(41/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2152

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((110.56972111553786)-(42/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2152

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((64.81673306772909)-(52/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2152

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((69.9003984063745)-(39/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2152

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((49.56573705179283)-(54/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2152


/************************SEGUNDA RACIÓN**********************************/ 2152

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((90.60621761658031)-(42/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2152

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((53.1139896373057)-(52/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2152

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((57.27979274611399)-(39/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2152

/***************************TERCERA RACIÓN*******************************/2152

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2152
			)aux
			JOIN ec_productos p ON p.id_productos=2152
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2152

El producto 2153 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2153
			)aux

Id de Producto: 2153

Inventario almacenes principales: -34

Ventas totales: 528
Proceso de racion producto: 2153

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/528/*ventas totales*/)*-34/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2153
					WHERE p.id_productos=2153
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2.5113636363636367)-(19/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2153

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3.348484848484848)-(16/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2153

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-9.272727272727272)-(-2/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2153

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-7.276515151515151)-(24/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2153

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-7.791666666666666)-(23/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2153

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3.7992424242424243)-(48/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2153


/************************SEGUNDA RACIÓN**********************************/ 2153

/***************************TERCERA RACIÓN*******************************/2153

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2153
			)aux
			JOIN ec_productos p ON p.id_productos=2153
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2153

El producto 2939 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2939
			)aux

Id de Producto: 2939

Inventario almacenes principales: 39

Ventas totales: 54
Proceso de racion producto: 2939

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/54/*ventas totales*/)*39/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2939
					WHERE p.id_productos=2939
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((19.5)-(18/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2939

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((18.777777777777775)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2939

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.7222222222222222)-(15/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2939


/************************SEGUNDA RACIÓN**********************************/ 2939

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((12.226415094339622)-(18/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2939

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((11.773584905660378)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2939

/***************************TERCERA RACIÓN*******************************/2939

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2939
			)aux
			JOIN ec_productos p ON p.id_productos=2939
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2939

El producto 2167 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2167
			)aux

Id de Producto: 2167

Inventario almacenes principales: 68

Ventas totales: 62
Proceso de racion producto: 2167

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/62/*ventas totales*/)*68/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2167
					WHERE p.id_productos=2167
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((30.709677419354836)-(24/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2167

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.870967741935484)-(12/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2167

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.870967741935484)-(15/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2167

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((17.548387096774192)-(30/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2167


/************************SEGUNDA RACIÓN**********************************/ 2167

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((11)-(24/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2167

/***************************TERCERA RACIÓN*******************************/2167

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2167
			)aux
			JOIN ec_productos p ON p.id_productos=2167
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2167

El producto 2173 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2173
			)aux

Id de Producto: 2173

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2173

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2173
					WHERE p.id_productos=2173
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2173

/***************************TERCERA RACIÓN*******************************/2173

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2173
			)aux
			JOIN ec_productos p ON p.id_productos=2173
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2173

El producto 2174 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2174
			)aux

Id de Producto: 2174

Inventario almacenes principales: 0

Ventas totales: 24
Proceso de racion producto: 2174

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/24/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2174
					WHERE p.id_productos=2174
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2174

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2174


/************************SEGUNDA RACIÓN**********************************/ 2174

/***************************TERCERA RACIÓN*******************************/2174

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2174
			)aux
			JOIN ec_productos p ON p.id_productos=2174
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2174

El producto 2177 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2177
			)aux

Id de Producto: 2177

Inventario almacenes principales: 39

Ventas totales: 24
Proceso de racion producto: 2177

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/24/*ventas totales*/)*39/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2177
					WHERE p.id_productos=2177
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(21/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2177

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((39)-(30/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2177


/************************SEGUNDA RACIÓN**********************************/ 2177

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((18)-(30/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2177

/***************************TERCERA RACIÓN*******************************/2177

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2177
			)aux
			JOIN ec_productos p ON p.id_productos=2177
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2177

El producto 2228 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2228
			)aux

Id de Producto: 2228

Inventario almacenes principales: 30

Ventas totales: 198
Proceso de racion producto: 2228

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/198/*ventas totales*/)*30/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2228
					WHERE p.id_productos=2228
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.393939393939394)-(21/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2228

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.757575757575757)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2228

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2228

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.96969696969697)-(31/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2228

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.333333333333333)-(50/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2228

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((14.545454545454547)-(34/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2228


/************************SEGUNDA RACIÓN**********************************/ 2228

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-106)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2228

/***************************TERCERA RACIÓN*******************************/2228

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2228
			)aux
			JOIN ec_productos p ON p.id_productos=2228
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2228

El producto 2230 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2230
			)aux

Id de Producto: 2230

Inventario almacenes principales: 47

Ventas totales: 474
Proceso de racion producto: 2230

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/474/*ventas totales*/)*47/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2230
					WHERE p.id_productos=2230
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.41139240506329)-(12/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2230

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.890295358649787)-(24/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2230

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2230

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.048523206751056)-(46/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2230

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.419831223628691)-(14/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2230

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.229957805907173)-(24/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2230


/************************SEGUNDA RACIÓN**********************************/ 2230

/***************************TERCERA RACIÓN*******************************/2230

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2230
			)aux
			JOIN ec_productos p ON p.id_productos=2230
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2230

El producto 2246 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2246
			)aux

Id de Producto: 2246

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2246

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2246
					WHERE p.id_productos=2246
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2246

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2246

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2246

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2246


/************************SEGUNDA RACIÓN**********************************/ 2246

/***************************TERCERA RACIÓN*******************************/2246

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2246
			)aux
			JOIN ec_productos p ON p.id_productos=2246
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2246

El producto 2249 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2249
			)aux

Id de Producto: 2249

Inventario almacenes principales: -105

Ventas totales: 160
Proceso de racion producto: 2249

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/160/*ventas totales*/)*-105/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2249
					WHERE p.id_productos=2249
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-15.093749999999998)-(9/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2249

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-11.8125)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2249

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2249

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-39.375)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2249

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-38.71875)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2249


/************************SEGUNDA RACIÓN**********************************/ 2249

/***************************TERCERA RACIÓN*******************************/2249

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2249
			)aux
			JOIN ec_productos p ON p.id_productos=2249
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2249

El producto 2277 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2277
			)aux

Id de Producto: 2277

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2277

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2277
					WHERE p.id_productos=2277
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2277


/************************SEGUNDA RACIÓN**********************************/ 2277

/***************************TERCERA RACIÓN*******************************/2277

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2277
			)aux
			JOIN ec_productos p ON p.id_productos=2277
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2277

El producto 2281 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2281
			)aux

Id de Producto: 2281

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2281

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2281
					WHERE p.id_productos=2281
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2281

/***************************TERCERA RACIÓN*******************************/2281

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2281
			)aux
			JOIN ec_productos p ON p.id_productos=2281
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2281

El producto 2285 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2285
			)aux

Id de Producto: 2285

Inventario almacenes principales: 17

Ventas totales: 0
Proceso de racion producto: 2285

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2285
					WHERE p.id_productos=2285
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2285

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2285


/************************SEGUNDA RACIÓN**********************************/ 2285

/***************************TERCERA RACIÓN*******************************/2285

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2285
			)aux
			JOIN ec_productos p ON p.id_productos=2285
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2285

El producto 2940 entra en racion

Presentacion: 50

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/50 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2940
			)aux

Id de Producto: 2940

Inventario almacenes principales: 2.64

Ventas totales: 10
Proceso de racion producto: 2940

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/10/*ventas totales*/)*2.64/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2940
					WHERE p.id_productos=2940
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.64)-(70/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2940

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/50)) * 50  
						WHERE id_sucursal=9 AND id_producto=2940


/************************SEGUNDA RACIÓN**********************************/ 2940

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((2.64)-(70/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2940

/***************************TERCERA RACIÓN*******************************/2940

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2940
			)aux
			JOIN ec_productos p ON p.id_productos=2940
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2940

El producto 2303 entra en racion

Presentacion: 50

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/50 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2303
			)aux

Id de Producto: 2303

Inventario almacenes principales: 0.58

Ventas totales: 21
Proceso de racion producto: 2303

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/21/*ventas totales*/)*0.58/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2303
					WHERE p.id_productos=2303
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.58)-(29/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2303


/************************SEGUNDA RACIÓN**********************************/ 2303

/***************************TERCERA RACIÓN*******************************/2303

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2303
			)aux
			JOIN ec_productos p ON p.id_productos=2303
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2303

El producto 2313 entra en racion

Presentacion: 50

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/50 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2313
			)aux

Id de Producto: 2313

Inventario almacenes principales: 1

Ventas totales: 0
Proceso de racion producto: 2313

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2313
					WHERE p.id_productos=2313
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(50/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2313


/************************SEGUNDA RACIÓN**********************************/ 2313

/***************************TERCERA RACIÓN*******************************/2313

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2313
			)aux
			JOIN ec_productos p ON p.id_productos=2313
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2313

El producto 2317 entra en racion

Presentacion: 50

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/50 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2317
			)aux

Id de Producto: 2317

Inventario almacenes principales: 2.88

Ventas totales: 6
Proceso de racion producto: 2317

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/6/*ventas totales*/)*2.88/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2317
					WHERE p.id_productos=2317
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.88)-(94/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2317

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/50)) * 50  
						WHERE id_sucursal=9 AND id_producto=2317


/************************SEGUNDA RACIÓN**********************************/ 2317

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((2.88)-(94/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2317

/***************************TERCERA RACIÓN*******************************/2317

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2317
			)aux
			JOIN ec_productos p ON p.id_productos=2317
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2317

El producto 3028 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3028
			)aux

Id de Producto: 3028

Inventario almacenes principales: -4

Ventas totales: 8
Proceso de racion producto: 3028

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/8/*ventas totales*/)*-4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3028
					WHERE p.id_productos=3028
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3028

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3028

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3028


/************************SEGUNDA RACIÓN**********************************/ 3028

/***************************TERCERA RACIÓN*******************************/3028

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3028
			)aux
			JOIN ec_productos p ON p.id_productos=3028
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3028

El producto 2325 entra en racion

Presentacion: 20

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/20 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2325
			)aux

Id de Producto: 2325

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2325

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2325
					WHERE p.id_productos=2325
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2325

/***************************TERCERA RACIÓN*******************************/2325

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2325
			)aux
			JOIN ec_productos p ON p.id_productos=2325
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2325

El producto 2326 entra en racion

Presentacion: 20

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/20 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2326
			)aux

Id de Producto: 2326

Inventario almacenes principales: 8.75

Ventas totales: 1427
Proceso de racion producto: 2326

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1427/*ventas totales*/)*8.75/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2326
					WHERE p.id_productos=2326
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.3372459705676244)-(5/20)) * 20  
						WHERE id_sucursal=2 AND id_producto=2326

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.4532235459004905)-(83/20)) * 20  
						WHERE id_sucursal=3 AND id_producto=2326

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.94989488437281)-(82/20)) * 20  
						WHERE id_sucursal=4 AND id_producto=2326

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/20)) * 20  
						WHERE id_sucursal=7 AND id_producto=2326

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7475473020322354)-(55/20)) * 20  
						WHERE id_sucursal=8 AND id_producto=2326

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7966012613875262)-(49/20)) * 20  
						WHERE id_sucursal=9 AND id_producto=2326

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.4654870357393133)-(141/20)) * 20  
						WHERE id_sucursal=10 AND id_producto=2326


/************************SEGUNDA RACIÓN**********************************/ 2326

/***************************TERCERA RACIÓN*******************************/2326

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2326
			)aux
			JOIN ec_productos p ON p.id_productos=2326
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2326

El producto 2327 entra en racion

Presentacion: 20

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/20 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2327
			)aux

Id de Producto: 2327

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2327

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2327
					WHERE p.id_productos=2327
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2327

/***************************TERCERA RACIÓN*******************************/2327

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2327
			)aux
			JOIN ec_productos p ON p.id_productos=2327
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2327

El producto 2329 entra en racion

Presentacion: 20

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/20 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2329
			)aux

Id de Producto: 2329

Inventario almacenes principales: 10.15

Ventas totales: 600
Proceso de racion producto: 2329

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/600/*ventas totales*/)*10.15/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2329
					WHERE p.id_productos=2329
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.0319166666666668)-(199/20)) * 20  
						WHERE id_sucursal=3 AND id_producto=2329

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.50175)-(53/20)) * 20  
						WHERE id_sucursal=4 AND id_producto=2329

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/20)) * 20  
						WHERE id_sucursal=7 AND id_producto=2329

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7762499999999999)-(55/20)) * 20  
						WHERE id_sucursal=8 AND id_producto=2329

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.6070833333333334)-(8/20)) * 20  
						WHERE id_sucursal=9 AND id_producto=2329

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.233)-(68/20)) * 20  
						WHERE id_sucursal=10 AND id_producto=2329


/************************SEGUNDA RACIÓN**********************************/ 2329

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-4.078311258278146)-(53/20)) * 20  
						WHERE id_sucursal=4 AND id_producto=2329

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-1.8716887417218544)-(8/20)) * 20  
						WHERE id_sucursal=9 AND id_producto=2329

/***************************TERCERA RACIÓN*******************************/2329

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2329
			)aux
			JOIN ec_productos p ON p.id_productos=2329
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2329

El producto 2330 entra en racion

Presentacion: 20

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/20 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2330
			)aux

Id de Producto: 2330

Inventario almacenes principales: 5.55

Ventas totales: 543
Proceso de racion producto: 2330

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/543/*ventas totales*/)*5.55/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2330
					WHERE p.id_productos=2330
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.7359116022099447)-(28/20)) * 20  
						WHERE id_sucursal=2 AND id_producto=2330

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.22486187845303868)-(218/20)) * 20  
						WHERE id_sucursal=3 AND id_producto=2330

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.011878453038674)-(81/20)) * 20  
						WHERE id_sucursal=4 AND id_producto=2330

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/20)) * 20  
						WHERE id_sucursal=7 AND id_producto=2330

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.8381215469613259)-(118/20)) * 20  
						WHERE id_sucursal=8 AND id_producto=2330

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7988950276243094)-(19/20)) * 20  
						WHERE id_sucursal=9 AND id_producto=2330

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.9403314917127072)-(128/20)) * 20  
						WHERE id_sucursal=10 AND id_producto=2330


/************************SEGUNDA RACIÓN**********************************/ 2330

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-23.1)-(19/20)) * 20  
						WHERE id_sucursal=9 AND id_producto=2330

/***************************TERCERA RACIÓN*******************************/2330

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2330
			)aux
			JOIN ec_productos p ON p.id_productos=2330
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2330

El producto 2332 entra en racion

Presentacion: 20

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/20 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2332
			)aux

Id de Producto: 2332

Inventario almacenes principales: 34.2

Ventas totales: 3581
Proceso de racion producto: 2332

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3581/*ventas totales*/)*34.2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2332
					WHERE p.id_productos=2332
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.6617704551801173)-(6/20)) * 20  
						WHERE id_sucursal=2 AND id_producto=2332

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.6375314158056415)-(165/20)) * 20  
						WHERE id_sucursal=3 AND id_producto=2332

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.984138508796427)-(82/20)) * 20  
						WHERE id_sucursal=4 AND id_producto=2332

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/20)) * 20  
						WHERE id_sucursal=7 AND id_producto=2332

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.067299636972913)-(40/20)) * 20  
						WHERE id_sucursal=8 AND id_producto=2332

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.949902261938007)-(180/20)) * 20  
						WHERE id_sucursal=9 AND id_producto=2332

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.899357721306898)-(207/20)) * 20  
						WHERE id_sucursal=10 AND id_producto=2332


/************************SEGUNDA RACIÓN**********************************/ 2332

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0.6562285714285714)-(6/20)) * 20  
						WHERE id_sucursal=2 AND id_producto=2332

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((3.1529142857142856)-(82/20)) * 20  
						WHERE id_sucursal=4 AND id_producto=2332

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((2.790857142857143)-(40/20)) * 20  
						WHERE id_sucursal=8 AND id_producto=2332

/***************************TERCERA RACIÓN*******************************/2332

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2332
			)aux
			JOIN ec_productos p ON p.id_productos=2332
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2332

El producto 2334 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2334
			)aux

Id de Producto: 2334

Inventario almacenes principales: 331

Ventas totales: 534
Proceso de racion producto: 2334

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/534/*ventas totales*/)*331/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2334
					WHERE p.id_productos=2334
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((23.554307116104866)-(35/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((32.232209737827716)-(148/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((141.94569288389513)-(67/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((66.9438202247191)-(162/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((42.76966292134832)-(50/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((23.554307116104866)-(49/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(40/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2334


/************************SEGUNDA RACIÓN**********************************/ 2334

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-153)-(67/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2334

/***************************TERCERA RACIÓN*******************************/2334

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2334
			)aux
			JOIN ec_productos p ON p.id_productos=2334
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2334

El producto 2944 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2944
			)aux

Id de Producto: 2944

Inventario almacenes principales: -816

Ventas totales: 1305
Proceso de racion producto: 2944

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1305/*ventas totales*/)*-816/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2944
					WHERE p.id_productos=2944
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-108.17471264367816)-(17/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2944

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-189.46206896551726)-(87/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2944

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2944

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-193.2137931034483)-(97/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2944

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-178.20689655172416)-(22/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2944

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-146.94252873563218)-(103/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2944

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(60/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2944


/************************SEGUNDA RACIÓN**********************************/ 2944

/***************************TERCERA RACIÓN*******************************/2944

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2944
			)aux
			JOIN ec_productos p ON p.id_productos=2944
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2944

El producto 2349 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2349
			)aux

Id de Producto: 2349

Inventario almacenes principales: 10

Ventas totales: 31
Proceso de racion producto: 2349

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/31/*ventas totales*/)*10/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2349
					WHERE p.id_productos=2349
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.5806451612903225)-(0/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2349

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.6129032258064515)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2349

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.935483870967742)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2349

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2349

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.967741935483871)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2349

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.6129032258064515)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2349

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2903225806451613)-(2/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2349


/************************SEGUNDA RACIÓN**********************************/ 2349

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-8)-(0/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2349

/***************************TERCERA RACIÓN*******************************/2349

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2349
			)aux
			JOIN ec_productos p ON p.id_productos=2349
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2349

El producto 2355 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2355
			)aux

Id de Producto: 2355

Inventario almacenes principales: 0

Ventas totales: 1
Proceso de racion producto: 2355

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2355
					WHERE p.id_productos=2355
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2355

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2355

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2355


/************************SEGUNDA RACIÓN**********************************/ 2355

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-1)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2355

/***************************TERCERA RACIÓN*******************************/2355

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2355
			)aux
			JOIN ec_productos p ON p.id_productos=2355
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2355

El producto 2011 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2011
			)aux

Id de Producto: 2011

Inventario almacenes principales: -12

Ventas totales: 38
Proceso de racion producto: 2011

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/38/*ventas totales*/)*-12/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2011
					WHERE p.id_productos=2011
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.5789473684210527)-(2/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2011

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.263157894736842)-(1/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2011

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2.526315789473684)-(2/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2011

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3.473684210526316)-(1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2011

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3.1578947368421053)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2011


/************************SEGUNDA RACIÓN**********************************/ 2011

/***************************TERCERA RACIÓN*******************************/2011

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2011
			)aux
			JOIN ec_productos p ON p.id_productos=2011
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2011

El producto 3284 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3284
			)aux

Id de Producto: 3284

Inventario almacenes principales: 9

Ventas totales: 20
Proceso de racion producto: 3284

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/20/*ventas totales*/)*9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3284
					WHERE p.id_productos=3284
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.3499999999999999)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3284

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.3499999999999999)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3284

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.05)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3284

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.25)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3284


/************************SEGUNDA RACIÓN**********************************/ 3284

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-4)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3284

/***************************TERCERA RACIÓN*******************************/3284

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3284
			)aux
			JOIN ec_productos p ON p.id_productos=3284
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3284

El producto 2358 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2358
			)aux

Id de Producto: 2358

Inventario almacenes principales: 4

Ventas totales: 3
Proceso de racion producto: 2358

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2358
					WHERE p.id_productos=2358
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.3333333333333333)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2358

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2358

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.6666666666666665)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2358


/************************SEGUNDA RACIÓN**********************************/ 2358

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((3)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2358

/***************************TERCERA RACIÓN*******************************/2358

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2358
			)aux
			JOIN ec_productos p ON p.id_productos=2358
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2358

El producto 2360 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2360
			)aux

Id de Producto: 2360

Inventario almacenes principales: 0

Ventas totales: 1
Proceso de racion producto: 2360

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2360
					WHERE p.id_productos=2360
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2360

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2360


/************************SEGUNDA RACIÓN**********************************/ 2360

/***************************TERCERA RACIÓN*******************************/2360

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2360
			)aux
			JOIN ec_productos p ON p.id_productos=2360
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2360

El producto 2365 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2365
			)aux

Id de Producto: 2365

Inventario almacenes principales: 1

Ventas totales: 3
Proceso de racion producto: 2365

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2365
					WHERE p.id_productos=2365
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.6666666666666666)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2365

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2365

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.3333333333333333)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2365


/************************SEGUNDA RACIÓN**********************************/ 2365

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2365

/***************************TERCERA RACIÓN*******************************/2365

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2365
			)aux
			JOIN ec_productos p ON p.id_productos=2365
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2365

El producto 2367 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2367
			)aux

Id de Producto: 2367

Inventario almacenes principales: -1

Ventas totales: 1
Proceso de racion producto: 2367

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2367
					WHERE p.id_productos=2367
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2367

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2367

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2367


/************************SEGUNDA RACIÓN**********************************/ 2367

/***************************TERCERA RACIÓN*******************************/2367

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2367
			)aux
			JOIN ec_productos p ON p.id_productos=2367
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2367

El producto 2370 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2370
			)aux

Id de Producto: 2370

Inventario almacenes principales: 20

Ventas totales: 21
Proceso de racion producto: 2370

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/21/*ventas totales*/)*20/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2370
					WHERE p.id_productos=2370
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2370

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.9047619047619047)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2370

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.619047619047619)-(13/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2370

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2370

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.9047619047619047)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2370

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.571428571428571)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2370


/************************SEGUNDA RACIÓN**********************************/ 2370

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-2)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2370

/***************************TERCERA RACIÓN*******************************/2370

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2370
			)aux
			JOIN ec_productos p ON p.id_productos=2370
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2370

El producto 2373 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2373
			)aux

Id de Producto: 2373

Inventario almacenes principales: -1

Ventas totales: 2
Proceso de racion producto: 2373

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2373
					WHERE p.id_productos=2373
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2373

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(0/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2373


/************************SEGUNDA RACIÓN**********************************/ 2373

/***************************TERCERA RACIÓN*******************************/2373

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2373
			)aux
			JOIN ec_productos p ON p.id_productos=2373
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2373

El producto 2808 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2808
			)aux

Id de Producto: 2808

Inventario almacenes principales: 5

Ventas totales: 6
Proceso de racion producto: 2808

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/6/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2808
					WHERE p.id_productos=2808
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.5)-(3/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2808

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.5)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2808


/************************SEGUNDA RACIÓN**********************************/ 2808

/***************************TERCERA RACIÓN*******************************/2808

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2808
			)aux
			JOIN ec_productos p ON p.id_productos=2808
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2808

El producto 2376 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2376
			)aux

Id de Producto: 2376

Inventario almacenes principales: 64

Ventas totales: 122
Proceso de racion producto: 2376

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/122/*ventas totales*/)*64/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2376
					WHERE p.id_productos=2376
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.6721311475409837)-(6/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2376

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.19672131147541)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2376

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((45.114754098360656)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2376

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.721311475409836)-(22/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2376

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.19672131147541)-(14/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2376

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.098360655737705)-(10/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2376


/************************SEGUNDA RACIÓN**********************************/ 2376

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2376

/***************************TERCERA RACIÓN*******************************/2376

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2376
			)aux
			JOIN ec_productos p ON p.id_productos=2376
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2376

El producto 2379 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2379
			)aux

Id de Producto: 2379

Inventario almacenes principales: -18

Ventas totales: 121
Proceso de racion producto: 2379

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/121/*ventas totales*/)*-18/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2379
					WHERE p.id_productos=2379
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.1487603305785124)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2379

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-17.702479338842977)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2379

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2379

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.1487603305785124)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2379

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2379


/************************SEGUNDA RACIÓN**********************************/ 2379

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-27)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2379

/***************************TERCERA RACIÓN*******************************/2379

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2379
			)aux
			JOIN ec_productos p ON p.id_productos=2379
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2379

El producto 2389 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2389
			)aux

Id de Producto: 2389

Inventario almacenes principales: 9

Ventas totales: 12
Proceso de racion producto: 2389

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/12/*ventas totales*/)*9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2389
					WHERE p.id_productos=2389
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.25)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2389

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.75)-(9/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2389


/************************SEGUNDA RACIÓN**********************************/ 2389

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2389

/***************************TERCERA RACIÓN*******************************/2389

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2389
			)aux
			JOIN ec_productos p ON p.id_productos=2389
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2389

El producto 2453 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2453
			)aux

Id de Producto: 2453

Inventario almacenes principales: 40

Ventas totales: 0
Proceso de racion producto: 2453

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*40/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2453
					WHERE p.id_productos=2453
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2453

/***************************TERCERA RACIÓN*******************************/2453

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2453
			)aux
			JOIN ec_productos p ON p.id_productos=2453
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2453

El producto 3073 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3073
			)aux

Id de Producto: 3073

Inventario almacenes principales: -4

Ventas totales: 3
Proceso de racion producto: 3073

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*-4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3073
					WHERE p.id_productos=3073
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4)-(-2/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3073

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3073


/************************SEGUNDA RACIÓN**********************************/ 3073

/***************************TERCERA RACIÓN*******************************/3073

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3073
			)aux
			JOIN ec_productos p ON p.id_productos=3073
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3073

El producto 3074 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3074
			)aux

Id de Producto: 3074

Inventario almacenes principales: -3

Ventas totales: 22
Proceso de racion producto: 3074

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/22/*ventas totales*/)*-3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3074
					WHERE p.id_productos=3074
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2.1818181818181817)-(2/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3074

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3074

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.8181818181818181)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3074


/************************SEGUNDA RACIÓN**********************************/ 3074

/***************************TERCERA RACIÓN*******************************/3074

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3074
			)aux
			JOIN ec_productos p ON p.id_productos=3074
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3074

El producto 2457 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2457
			)aux

Id de Producto: 2457

Inventario almacenes principales: 40

Ventas totales: 0
Proceso de racion producto: 2457

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*40/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2457
					WHERE p.id_productos=2457
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2457

/***************************TERCERA RACIÓN*******************************/2457

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2457
			)aux
			JOIN ec_productos p ON p.id_productos=2457
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2457

El producto 2413 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2413
			)aux

Id de Producto: 2413

Inventario almacenes principales: -5

Ventas totales: 7
Proceso de racion producto: 2413

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/7/*ventas totales*/)*-5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2413
					WHERE p.id_productos=2413
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-5)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2413


/************************SEGUNDA RACIÓN**********************************/ 2413

/***************************TERCERA RACIÓN*******************************/2413

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2413
			)aux
			JOIN ec_productos p ON p.id_productos=2413
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2413

El producto 2468 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2468
			)aux

Id de Producto: 2468

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2468

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2468
					WHERE p.id_productos=2468
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2468

/***************************TERCERA RACIÓN*******************************/2468

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2468
			)aux
			JOIN ec_productos p ON p.id_productos=2468
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2468

El producto 2469 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2469
			)aux

Id de Producto: 2469

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2469

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2469
					WHERE p.id_productos=2469
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2469

/***************************TERCERA RACIÓN*******************************/2469

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2469
			)aux
			JOIN ec_productos p ON p.id_productos=2469
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2469

El producto 2476 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2476
			)aux

Id de Producto: 2476

Inventario almacenes principales: 1

Ventas totales: 0
Proceso de racion producto: 2476

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2476
					WHERE p.id_productos=2476
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2476

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2476

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2476


/************************SEGUNDA RACIÓN**********************************/ 2476

/***************************TERCERA RACIÓN*******************************/2476

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2476
			)aux
			JOIN ec_productos p ON p.id_productos=2476
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2476

El producto 2799 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2799
			)aux

Id de Producto: 2799

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2799

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2799
					WHERE p.id_productos=2799
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2799

/***************************TERCERA RACIÓN*******************************/2799

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2799
			)aux
			JOIN ec_productos p ON p.id_productos=2799
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2799

El producto 2802 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2802
			)aux

Id de Producto: 2802

Inventario almacenes principales: 7

Ventas totales: 7
Proceso de racion producto: 2802

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/7/*ventas totales*/)*7/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2802
					WHERE p.id_productos=2802
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6)-(9/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2802

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2802


/************************SEGUNDA RACIÓN**********************************/ 2802

/***************************TERCERA RACIÓN*******************************/2802

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2802
			)aux
			JOIN ec_productos p ON p.id_productos=2802
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2802

El producto 2479 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2479
			)aux

Id de Producto: 2479

Inventario almacenes principales: 42

Ventas totales: 53
Proceso de racion producto: 2479

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/53/*ventas totales*/)*42/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2479
					WHERE p.id_productos=2479
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.679245283018867)-(3/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2479

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.30188679245283)-(9/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2479

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2479

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2479

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.754716981132075)-(12/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2479

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.679245283018867)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2479

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.5849056603773584)-(7/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2479


/************************SEGUNDA RACIÓN**********************************/ 2479

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8.177777777777779)-(3/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2479

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6.644444444444444)-(9/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2479

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8.177777777777779)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2479

/***************************TERCERA RACIÓN*******************************/2479

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2479
			)aux
			JOIN ec_productos p ON p.id_productos=2479
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2479

El producto 2489 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2489
			)aux

Id de Producto: 2489

Inventario almacenes principales: 11

Ventas totales: 10
Proceso de racion producto: 2489

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/10/*ventas totales*/)*11/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2489
					WHERE p.id_productos=2489
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2489

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2489

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2489

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.5)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2489

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.5)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2489


/************************SEGUNDA RACIÓN**********************************/ 2489

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((5)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2489

/***************************TERCERA RACIÓN*******************************/2489

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2489
			)aux
			JOIN ec_productos p ON p.id_productos=2489
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2489

El producto 2497 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2497
			)aux

Id de Producto: 2497

Inventario almacenes principales: 63

Ventas totales: 101
Proceso de racion producto: 2497

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/101/*ventas totales*/)*63/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2497
					WHERE p.id_productos=2497
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.732673267326733)-(9/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2497

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.475247524752476)-(16/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2497

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2497

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2497

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((16.21782178217822)-(13/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2497

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.475247524752476)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2497

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.099009900990099)-(9/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2497


/************************SEGUNDA RACIÓN**********************************/ 2497

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((14.746268656716419)-(13/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2497

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((11.343283582089551)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2497

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((11.91044776119403)-(9/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2497

/***************************TERCERA RACIÓN*******************************/2497

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2497
			)aux
			JOIN ec_productos p ON p.id_productos=2497
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2497

El producto 3277 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3277
			)aux

Id de Producto: 3277

Inventario almacenes principales: -1

Ventas totales: 3
Proceso de racion producto: 3277

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3277
					WHERE p.id_productos=3277
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3277


/************************SEGUNDA RACIÓN**********************************/ 3277

/***************************TERCERA RACIÓN*******************************/3277

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3277
			)aux
			JOIN ec_productos p ON p.id_productos=3277
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3277

El producto 2518 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2518
			)aux

Id de Producto: 2518

Inventario almacenes principales: 17

Ventas totales: 23
Proceso de racion producto: 2518

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/23/*ventas totales*/)*17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2518
					WHERE p.id_productos=2518
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.7391304347826086)-(4/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2518

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.4782608695652173)-(3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2518

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2518

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.217391304347826)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2518

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.7391304347826086)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2518

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.826086956521738)-(5/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2518


/************************SEGUNDA RACIÓN**********************************/ 2518

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0)-(5/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2518

/***************************TERCERA RACIÓN*******************************/2518

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2518
			)aux
			JOIN ec_productos p ON p.id_productos=2518
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2518

El producto 2522 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2522
			)aux

Id de Producto: 2522

Inventario almacenes principales: 11

Ventas totales: 55
Proceso de racion producto: 2522

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/55/*ventas totales*/)*11/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2522
					WHERE p.id_productos=2522
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.8)-(3/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2522

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.19999999999999998)-(8/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2522

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2522

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2522

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.6)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2522

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.4)-(2/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2522


/************************SEGUNDA RACIÓN**********************************/ 2522

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-7)-(2/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2522

/***************************TERCERA RACIÓN*******************************/2522

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2522
			)aux
			JOIN ec_productos p ON p.id_productos=2522
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2522

El producto 2524 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2524
			)aux

Id de Producto: 2524

Inventario almacenes principales: 21

Ventas totales: 62
Proceso de racion producto: 2524

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/62/*ventas totales*/)*21/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2524
					WHERE p.id_productos=2524
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.0161290322580645)-(5/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2524

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.032258064516129)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2524

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.080645161290323)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2524

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.096774193548388)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2524

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.774193548387097)-(5/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2524


/************************SEGUNDA RACIÓN**********************************/ 2524

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0.9473684210526315)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2524

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1.0526315789473684)-(5/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2524

/***************************TERCERA RACIÓN*******************************/2524

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2524
			)aux
			JOIN ec_productos p ON p.id_productos=2524
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2524

El producto 2531 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2531
			)aux

Id de Producto: 2531

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2531

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2531
					WHERE p.id_productos=2531
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2531


/************************SEGUNDA RACIÓN**********************************/ 2531

/***************************TERCERA RACIÓN*******************************/2531

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2531
			)aux
			JOIN ec_productos p ON p.id_productos=2531
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2531

El producto 2533 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2533
			)aux

Id de Producto: 2533

Inventario almacenes principales: -2

Ventas totales: 4
Proceso de racion producto: 2533

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/4/*ventas totales*/)*-2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2533
					WHERE p.id_productos=2533
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2533

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5)-(-1/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2533

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.5)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2533


/************************SEGUNDA RACIÓN**********************************/ 2533

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-2)-(-1/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2533

/***************************TERCERA RACIÓN*******************************/2533

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2533
			)aux
			JOIN ec_productos p ON p.id_productos=2533
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2533

El producto 2819 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2819
			)aux

Id de Producto: 2819

Inventario almacenes principales: 5

Ventas totales: 11
Proceso de racion producto: 2819

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/11/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2819
					WHERE p.id_productos=2819
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2819

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.2727272727272725)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2819

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.727272727272727)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2819


/************************SEGUNDA RACIÓN**********************************/ 2819

/***************************TERCERA RACIÓN*******************************/2819

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2819
			)aux
			JOIN ec_productos p ON p.id_productos=2819
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2819

El producto 2820 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2820
			)aux

Id de Producto: 2820

Inventario almacenes principales: 15

Ventas totales: 14
Proceso de racion producto: 2820

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/14/*ventas totales*/)*15/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2820
					WHERE p.id_productos=2820
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2820

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.571428571428571)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2820

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.428571428571428)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2820


/************************SEGUNDA RACIÓN**********************************/ 2820

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8.571428571428571)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2820

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6.428571428571428)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2820

/***************************TERCERA RACIÓN*******************************/2820

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2820
			)aux
			JOIN ec_productos p ON p.id_productos=2820
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2820

El producto 2821 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2821
			)aux

Id de Producto: 2821

Inventario almacenes principales: 3

Ventas totales: 10
Proceso de racion producto: 2821

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/10/*ventas totales*/)*3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2821
					WHERE p.id_productos=2821
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2821

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7999999999999998)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2821

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2000000000000002)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2821


/************************SEGUNDA RACIÓN**********************************/ 2821

/***************************TERCERA RACIÓN*******************************/2821

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2821
			)aux
			JOIN ec_productos p ON p.id_productos=2821
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2821

El producto 2822 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2822
			)aux

Id de Producto: 2822

Inventario almacenes principales: 19

Ventas totales: 71
Proceso de racion producto: 2822

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/71/*ventas totales*/)*19/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2822
					WHERE p.id_productos=2822
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.0704225352112677)-(8/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2822

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2822

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2822

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.352112676056338)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2822

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.014084507042253)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2822

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.690140845070422)-(8/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2822

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.8732394366197183)-(1/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2822


/************************SEGUNDA RACIÓN**********************************/ 2822

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1.4285714285714284)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2822

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1.0714285714285714)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2822

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0.5)-(1/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2822

/***************************TERCERA RACIÓN*******************************/2822

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2822
			)aux
			JOIN ec_productos p ON p.id_productos=2822
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2822

El producto 2824 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2824
			)aux

Id de Producto: 2824

Inventario almacenes principales: -1

Ventas totales: 10
Proceso de racion producto: 2824

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/10/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2824
					WHERE p.id_productos=2824
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2824

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2824

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.8)-(-1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2824

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.2)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2824


/************************SEGUNDA RACIÓN**********************************/ 2824

/***************************TERCERA RACIÓN*******************************/2824

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2824
			)aux
			JOIN ec_productos p ON p.id_productos=2824
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2824

El producto 2825 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2825
			)aux

Id de Producto: 2825

Inventario almacenes principales: -3

Ventas totales: 3
Proceso de racion producto: 2825

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*-3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2825
					WHERE p.id_productos=2825
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2825

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2825

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2825

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2825


/************************SEGUNDA RACIÓN**********************************/ 2825

/***************************TERCERA RACIÓN*******************************/2825

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2825
			)aux
			JOIN ec_productos p ON p.id_productos=2825
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2825

El producto 2827 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2827
			)aux

Id de Producto: 2827

Inventario almacenes principales: -7

Ventas totales: 0
Proceso de racion producto: 2827

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-7/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2827
					WHERE p.id_productos=2827
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2827

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2827

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2827


/************************SEGUNDA RACIÓN**********************************/ 2827

/***************************TERCERA RACIÓN*******************************/2827

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2827
			)aux
			JOIN ec_productos p ON p.id_productos=2827
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2827

El producto 2828 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2828
			)aux

Id de Producto: 2828

Inventario almacenes principales: -9

Ventas totales: 1
Proceso de racion producto: 2828

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*-9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2828
					WHERE p.id_productos=2828
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2828

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2828

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-9)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2828


/************************SEGUNDA RACIÓN**********************************/ 2828

/***************************TERCERA RACIÓN*******************************/2828

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2828
			)aux
			JOIN ec_productos p ON p.id_productos=2828
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2828

El producto 2829 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2829
			)aux

Id de Producto: 2829

Inventario almacenes principales: 0

Ventas totales: 2
Proceso de racion producto: 2829

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2829
					WHERE p.id_productos=2829
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2829

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2829

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2829


/************************SEGUNDA RACIÓN**********************************/ 2829

/***************************TERCERA RACIÓN*******************************/2829

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2829
			)aux
			JOIN ec_productos p ON p.id_productos=2829
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2829

El producto 2951 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2951
			)aux

Id de Producto: 2951

Inventario almacenes principales: -34

Ventas totales: 13
Proceso de racion producto: 2951

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/13/*ventas totales*/)*-34/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2951
					WHERE p.id_productos=2951
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2951

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-20.923076923076923)-(1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2951

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-13.076923076923078)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2951


/************************SEGUNDA RACIÓN**********************************/ 2951

/***************************TERCERA RACIÓN*******************************/2951

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2951
			)aux
			JOIN ec_productos p ON p.id_productos=2951
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2951

El producto 3003 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3003
			)aux

Id de Producto: 3003

Inventario almacenes principales: -1

Ventas totales: 13
Proceso de racion producto: 3003

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/13/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3003
					WHERE p.id_productos=3003
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3003

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.46153846153846156)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3003

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5384615384615384)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3003


/************************SEGUNDA RACIÓN**********************************/ 3003

/***************************TERCERA RACIÓN*******************************/3003

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3003
			)aux
			JOIN ec_productos p ON p.id_productos=3003
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3003

El producto 3134 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3134
			)aux

Id de Producto: 3134

Inventario almacenes principales: 0

Ventas totales: 6
Proceso de racion producto: 3134

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/6/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3134
					WHERE p.id_productos=3134
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3134


/************************SEGUNDA RACIÓN**********************************/ 3134

/***************************TERCERA RACIÓN*******************************/3134

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3134
			)aux
			JOIN ec_productos p ON p.id_productos=3134
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3134

El producto 3136 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3136
			)aux

Id de Producto: 3136

Inventario almacenes principales: 2

Ventas totales: 0
Proceso de racion producto: 3136

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3136
					WHERE p.id_productos=3136
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3136


/************************SEGUNDA RACIÓN**********************************/ 3136

/***************************TERCERA RACIÓN*******************************/3136

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3136
			)aux
			JOIN ec_productos p ON p.id_productos=3136
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3136

El producto 3137 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3137
			)aux

Id de Producto: 3137

Inventario almacenes principales: -6

Ventas totales: 25
Proceso de racion producto: 3137

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/25/*ventas totales*/)*-6/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3137
					WHERE p.id_productos=3137
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3.84)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3137

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2.16)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3137


/************************SEGUNDA RACIÓN**********************************/ 3137

/***************************TERCERA RACIÓN*******************************/3137

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3137
			)aux
			JOIN ec_productos p ON p.id_productos=3137
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3137

El producto 3139 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3139
			)aux

Id de Producto: 3139

Inventario almacenes principales: 8

Ventas totales: 43
Proceso de racion producto: 3139

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/43/*ventas totales*/)*8/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3139
					WHERE p.id_productos=3139
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.6744186046511629)-(7/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3139

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.9767441860465116)-(34/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3139

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.7441860465116279)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3139

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.604651162790698)-(7/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3139


/************************SEGUNDA RACIÓN**********************************/ 3139

/***************************TERCERA RACIÓN*******************************/3139

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3139
			)aux
			JOIN ec_productos p ON p.id_productos=3139
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3139

El producto 3266 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3266
			)aux

Id de Producto: 3266

Inventario almacenes principales: 0

Ventas totales: 3
Proceso de racion producto: 3266

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3266
					WHERE p.id_productos=3266
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3266

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3266


/************************SEGUNDA RACIÓN**********************************/ 3266

/***************************TERCERA RACIÓN*******************************/3266

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3266
			)aux
			JOIN ec_productos p ON p.id_productos=3266
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3266

El producto 3303 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3303
			)aux

Id de Producto: 3303

Inventario almacenes principales: -6

Ventas totales: 32
Proceso de racion producto: 3303

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/32/*ventas totales*/)*-6/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3303
					WHERE p.id_productos=3303
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4.5)-(1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3303

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.5)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3303


/************************SEGUNDA RACIÓN**********************************/ 3303

/***************************TERCERA RACIÓN*******************************/3303

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3303
			)aux
			JOIN ec_productos p ON p.id_productos=3303
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3303

El producto 3305 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3305
			)aux

Id de Producto: 3305

Inventario almacenes principales: -1

Ventas totales: 2
Proceso de racion producto: 3305

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3305
					WHERE p.id_productos=3305
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(-1/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3305

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3305


/************************SEGUNDA RACIÓN**********************************/ 3305

/***************************TERCERA RACIÓN*******************************/3305

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3305
			)aux
			JOIN ec_productos p ON p.id_productos=3305
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3305

El producto 2552 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2552
			)aux

Id de Producto: 2552

Inventario almacenes principales: -2

Ventas totales: 4
Proceso de racion producto: 2552

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/4/*ventas totales*/)*-2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2552
					WHERE p.id_productos=2552
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2552

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.5)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2552


/************************SEGUNDA RACIÓN**********************************/ 2552

/***************************TERCERA RACIÓN*******************************/2552

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2552
			)aux
			JOIN ec_productos p ON p.id_productos=2552
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2552

El producto 2832 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2832
			)aux

Id de Producto: 2832

Inventario almacenes principales: 9

Ventas totales: 1
Proceso de racion producto: 2832

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2832
					WHERE p.id_productos=2832
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2832

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2832

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2832


/************************SEGUNDA RACIÓN**********************************/ 2832

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2832

/***************************TERCERA RACIÓN*******************************/2832

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2832
			)aux
			JOIN ec_productos p ON p.id_productos=2832
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2832

El producto 2834 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2834
			)aux

Id de Producto: 2834

Inventario almacenes principales: -5

Ventas totales: 5
Proceso de racion producto: 2834

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/5/*ventas totales*/)*-5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2834
					WHERE p.id_productos=2834
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2834

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2834

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2834


/************************SEGUNDA RACIÓN**********************************/ 2834

/***************************TERCERA RACIÓN*******************************/2834

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2834
			)aux
			JOIN ec_productos p ON p.id_productos=2834
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2834

El producto 2978 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2978
			)aux

Id de Producto: 2978

Inventario almacenes principales: -3

Ventas totales: 6
Proceso de racion producto: 2978

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/6/*ventas totales*/)*-3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2978
					WHERE p.id_productos=2978
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2978


/************************SEGUNDA RACIÓN**********************************/ 2978

/***************************TERCERA RACIÓN*******************************/2978

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2978
			)aux
			JOIN ec_productos p ON p.id_productos=2978
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2978

El producto 2568 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2568
			)aux

Id de Producto: 2568

Inventario almacenes principales: -17

Ventas totales: 17
Proceso de racion producto: 2568

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/17/*ventas totales*/)*-17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2568
					WHERE p.id_productos=2568
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3)-(12/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2568

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(14/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2568

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4)-(15/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2568

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-7)-(14/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2568

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2)-(13/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2568

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(14/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2568


/************************SEGUNDA RACIÓN**********************************/ 2568

/***************************TERCERA RACIÓN*******************************/2568

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2568
			)aux
			JOIN ec_productos p ON p.id_productos=2568
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2568

El producto 2570 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2570
			)aux

Id de Producto: 2570

Inventario almacenes principales: -87

Ventas totales: 368
Proceso de racion producto: 2570

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/368/*ventas totales*/)*-87/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2570
					WHERE p.id_productos=2570
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-8.747282608695652)-(1/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2570

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-5.201086956521739)-(16/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2570

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-21.98641304347826)-(7/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2570

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2570

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-16.3125)-(127/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2570

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-21.27717391304348)-(21/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2570

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-13.47554347826087)-(7/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2570


/************************SEGUNDA RACIÓN**********************************/ 2570

/***************************TERCERA RACIÓN*******************************/2570

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2570
			)aux
			JOIN ec_productos p ON p.id_productos=2570
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2570

El producto 2571 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2571
			)aux

Id de Producto: 2571

Inventario almacenes principales: -93

Ventas totales: 363
Proceso de racion producto: 2571

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/363/*ventas totales*/)*-93/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2571
					WHERE p.id_productos=2571
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-8.454545454545455)-(5/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2571

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-6.661157024793389)-(15/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2571

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-25.107438016528928)-(2/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2571

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2571

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-16.396694214876035)-(136/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2571

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-22.545454545454547)-(21/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2571

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-13.834710743801653)-(-1/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2571


/************************SEGUNDA RACIÓN**********************************/ 2571

/***************************TERCERA RACIÓN*******************************/2571

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2571
			)aux
			JOIN ec_productos p ON p.id_productos=2571
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2571

El producto 2572 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2572
			)aux

Id de Producto: 2572

Inventario almacenes principales: -105

Ventas totales: 409
Proceso de racion producto: 2572

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/409/*ventas totales*/)*-105/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2572
					WHERE p.id_productos=2572
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-6.67481662591687)-(2/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2572

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-11.809290953545233)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2572

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-28.239608801955992)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2572

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-22.078239608801955)-(22/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2572

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-21.3080684596577)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2572

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-14.889975550122248)-(-2/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2572

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(5/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2572


/************************SEGUNDA RACIÓN**********************************/ 2572

/***************************TERCERA RACIÓN*******************************/2572

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2572
			)aux
			JOIN ec_productos p ON p.id_productos=2572
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2572

El producto 2576 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2576
			)aux

Id de Producto: 2576

Inventario almacenes principales: 1

Ventas totales: 0
Proceso de racion producto: 2576

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2576
					WHERE p.id_productos=2576
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2576


/************************SEGUNDA RACIÓN**********************************/ 2576

/***************************TERCERA RACIÓN*******************************/2576

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2576
			)aux
			JOIN ec_productos p ON p.id_productos=2576
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2576

El producto 2577 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2577
			)aux

Id de Producto: 2577

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2577

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2577
					WHERE p.id_productos=2577
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2577

/***************************TERCERA RACIÓN*******************************/2577

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2577
			)aux
			JOIN ec_productos p ON p.id_productos=2577
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2577

El producto 2582 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2582
			)aux

Id de Producto: 2582

Inventario almacenes principales: -1

Ventas totales: 36
Proceso de racion producto: 2582

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/36/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2582
					WHERE p.id_productos=2582
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.08333333333333333)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2582

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.3888888888888889)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2582

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5277777777777778)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2582


/************************SEGUNDA RACIÓN**********************************/ 2582

/***************************TERCERA RACIÓN*******************************/2582

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2582
			)aux
			JOIN ec_productos p ON p.id_productos=2582
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2582

El producto 2585 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2585
			)aux

Id de Producto: 2585

Inventario almacenes principales: -4

Ventas totales: 0
Proceso de racion producto: 2585

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2585
					WHERE p.id_productos=2585
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2585

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2585

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2585


/************************SEGUNDA RACIÓN**********************************/ 2585

/***************************TERCERA RACIÓN*******************************/2585

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2585
			)aux
			JOIN ec_productos p ON p.id_productos=2585
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2585

El producto 3154 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3154
			)aux

Id de Producto: 3154

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 3154

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3154
					WHERE p.id_productos=3154
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 3154

/***************************TERCERA RACIÓN*******************************/3154

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3154
			)aux
			JOIN ec_productos p ON p.id_productos=3154
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3154

El producto 2593 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2593
			)aux

Id de Producto: 2593

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2593

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2593
					WHERE p.id_productos=2593
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2593

/***************************TERCERA RACIÓN*******************************/2593

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2593
			)aux
			JOIN ec_productos p ON p.id_productos=2593
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2593

El producto 2594 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2594
			)aux

Id de Producto: 2594

Inventario almacenes principales: -1

Ventas totales: 3
Proceso de racion producto: 2594

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2594
					WHERE p.id_productos=2594
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2594

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2594


/************************SEGUNDA RACIÓN**********************************/ 2594

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-2)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2594

/***************************TERCERA RACIÓN*******************************/2594

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2594
			)aux
			JOIN ec_productos p ON p.id_productos=2594
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2594

El producto 2595 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2595
			)aux

Id de Producto: 2595

Inventario almacenes principales: 18

Ventas totales: 30
Proceso de racion producto: 2595

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/30/*ventas totales*/)*18/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2595
					WHERE p.id_productos=2595
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2595

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.6)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2595

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2595

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.4)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2595

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.800000000000001)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2595

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.4)-(3/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2595

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.6)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2595


/************************SEGUNDA RACIÓN**********************************/ 2595

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1.8571428571428572)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2595

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0.14285714285714285)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2595

/***************************TERCERA RACIÓN*******************************/2595

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2595
			)aux
			JOIN ec_productos p ON p.id_productos=2595
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2595

El producto 2600 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2600
			)aux

Id de Producto: 2600

Inventario almacenes principales: 2

Ventas totales: 0
Proceso de racion producto: 2600

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2600
					WHERE p.id_productos=2600
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2600

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2600


/************************SEGUNDA RACIÓN**********************************/ 2600

/***************************TERCERA RACIÓN*******************************/2600

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2600
			)aux
			JOIN ec_productos p ON p.id_productos=2600
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2600

El producto 2605 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2605
			)aux

Id de Producto: 2605

Inventario almacenes principales: -12

Ventas totales: 2
Proceso de racion producto: 2605

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*-12/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2605
					WHERE p.id_productos=2605
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2605

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-12)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2605


/************************SEGUNDA RACIÓN**********************************/ 2605

/***************************TERCERA RACIÓN*******************************/2605

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2605
			)aux
			JOIN ec_productos p ON p.id_productos=2605
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2605

El producto 2619 entra en racion

Presentacion: 12

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/12 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2619
			)aux

Id de Producto: 2619

Inventario almacenes principales: 12.083333333333334

Ventas totales: 1974
Proceso de racion producto: 2619

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1974/*ventas totales*/)*12.083333333333334/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2619
					WHERE p.id_productos=2619
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.9365501519756839)-(3/12)) * 12  
						WHERE id_sucursal=2 AND id_producto=2619

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.099586288416076)-(77/12)) * 12  
						WHERE id_sucursal=3 AND id_producto=2619

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.3627997298210066)-(73/12)) * 12  
						WHERE id_sucursal=4 AND id_producto=2619

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/12)) * 12  
						WHERE id_sucursal=7 AND id_producto=2619

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.7545592705167175)-(42/12)) * 12  
						WHERE id_sucursal=8 AND id_producto=2619

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.5892857142857144)-(73/12)) * 12  
						WHERE id_sucursal=9 AND id_producto=2619

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.3405521783181358)-(9/12)) * 12  
						WHERE id_sucursal=10 AND id_producto=2619


/************************SEGUNDA RACIÓN**********************************/ 2619

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-4.112903225806452)-(3/12)) * 12  
						WHERE id_sucursal=2 AND id_producto=2619

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-5.887096774193549)-(9/12)) * 12  
						WHERE id_sucursal=10 AND id_producto=2619

/***************************TERCERA RACIÓN*******************************/2619

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2619
			)aux
			JOIN ec_productos p ON p.id_productos=2619
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2619

El producto 2621 entra en racion

Presentacion: 12

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/12 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2621
			)aux

Id de Producto: 2621

Inventario almacenes principales: -78.08333333333333

Ventas totales: 1255
Proceso de racion producto: 2621

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1255/*ventas totales*/)*-78.08333333333333/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2621
					WHERE p.id_productos=2621
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3.857503320053121)-(34/12)) * 12  
						WHERE id_sucursal=2 AND id_producto=2621

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-8.212749003984063)-(0/12)) * 12  
						WHERE id_sucursal=3 AND id_producto=2621

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-25.44707835325365)-(-24/12)) * 12  
						WHERE id_sucursal=4 AND id_producto=2621

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/12)) * 12  
						WHERE id_sucursal=7 AND id_producto=2621

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-16.861022576361222)-(17/12)) * 12  
						WHERE id_sucursal=8 AND id_producto=2621

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-23.70498007968127)-(-52/12)) * 12  
						WHERE id_sucursal=9 AND id_producto=2621

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(10/12)) * 12  
						WHERE id_sucursal=11 AND id_producto=2621


/************************SEGUNDA RACIÓN**********************************/ 2621

/***************************TERCERA RACIÓN*******************************/2621

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2621
			)aux
			JOIN ec_productos p ON p.id_productos=2621
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2621

El producto 2655 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2655
			)aux

Id de Producto: 2655

Inventario almacenes principales: 5

Ventas totales: 0
Proceso de racion producto: 2655

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2655
					WHERE p.id_productos=2655
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2655


/************************SEGUNDA RACIÓN**********************************/ 2655

/***************************TERCERA RACIÓN*******************************/2655

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2655
			)aux
			JOIN ec_productos p ON p.id_productos=2655
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2655

El producto 2604 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2604
			)aux

Id de Producto: 2604

Inventario almacenes principales: -17

Ventas totales: 65
Proceso de racion producto: 2604

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/65/*ventas totales*/)*-17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2604
					WHERE p.id_productos=2604
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3.4000000000000004)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2604

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2604

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-9.153846153846153)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2604

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4.446153846153846)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2604


/************************SEGUNDA RACIÓN**********************************/ 2604

/***************************TERCERA RACIÓN*******************************/2604

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2604
			)aux
			JOIN ec_productos p ON p.id_productos=2604
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2604

El producto 2853 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2853
			)aux

Id de Producto: 2853

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2853

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2853
					WHERE p.id_productos=2853
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2853

/***************************TERCERA RACIÓN*******************************/2853

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2853
			)aux
			JOIN ec_productos p ON p.id_productos=2853
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2853

El producto 2859 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2859
			)aux

Id de Producto: 2859

Inventario almacenes principales: 145

Ventas totales: 675
Proceso de racion producto: 2859

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/675/*ventas totales*/)*145/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2859
					WHERE p.id_productos=2859
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.244444444444445)-(25/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2859

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((23.414814814814815)-(31/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2859

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((42.74814814814815)-(26/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2859

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2859

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((33.94074074074074)-(17/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2859

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((32.65185185185185)-(21/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2859


/************************SEGUNDA RACIÓN**********************************/ 2859

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((34.79567779960707)-(26/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2859

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((27.62671905697446)-(17/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2859

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((26.577603143418468)-(21/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2859

/***************************TERCERA RACIÓN*******************************/2859

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2859
			)aux
			JOIN ec_productos p ON p.id_productos=2859
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2859

El producto 2865 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2865
			)aux

Id de Producto: 2865

Inventario almacenes principales: -1

Ventas totales: 5
Proceso de racion producto: 2865

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/5/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2865
					WHERE p.id_productos=2865
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2865


/************************SEGUNDA RACIÓN**********************************/ 2865

/***************************TERCERA RACIÓN*******************************/2865

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2865
			)aux
			JOIN ec_productos p ON p.id_productos=2865
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2865

El producto 2875 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2875
			)aux

Id de Producto: 2875

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2875

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2875
					WHERE p.id_productos=2875
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2875

/***************************TERCERA RACIÓN*******************************/2875

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2875
			)aux
			JOIN ec_productos p ON p.id_productos=2875
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2875

El producto 2878 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2878
			)aux

Id de Producto: 2878

Inventario almacenes principales: 2

Ventas totales: 5
Proceso de racion producto: 2878

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/5/*ventas totales*/)*2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2878
					WHERE p.id_productos=2878
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2878

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.8)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2878


/************************SEGUNDA RACIÓN**********************************/ 2878

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2878

/***************************TERCERA RACIÓN*******************************/2878

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2878
			)aux
			JOIN ec_productos p ON p.id_productos=2878
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2878

El producto 2879 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2879
			)aux

Id de Producto: 2879

Inventario almacenes principales: 0

Ventas totales: 17
Proceso de racion producto: 2879

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/17/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2879
					WHERE p.id_productos=2879
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2879


/************************SEGUNDA RACIÓN**********************************/ 2879

/***************************TERCERA RACIÓN*******************************/2879

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2879
			)aux
			JOIN ec_productos p ON p.id_productos=2879
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2879

El producto 2880 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2880
			)aux

Id de Producto: 2880

Inventario almacenes principales: -36

Ventas totales: 44
Proceso de racion producto: 2880

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/44/*ventas totales*/)*-36/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2880
					WHERE p.id_productos=2880
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-21.272727272727273)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2880

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-14.727272727272728)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2880


/************************SEGUNDA RACIÓN**********************************/ 2880

/***************************TERCERA RACIÓN*******************************/2880

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2880
			)aux
			JOIN ec_productos p ON p.id_productos=2880
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2880

El producto 2881 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2881
			)aux

Id de Producto: 2881

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2881

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2881
					WHERE p.id_productos=2881
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2881

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2881


/************************SEGUNDA RACIÓN**********************************/ 2881

/***************************TERCERA RACIÓN*******************************/2881

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2881
			)aux
			JOIN ec_productos p ON p.id_productos=2881
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2881

El producto 2888 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2888
			)aux

Id de Producto: 2888

Inventario almacenes principales: 4

Ventas totales: 0
Proceso de racion producto: 2888

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2888
					WHERE p.id_productos=2888
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2888

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2888


/************************SEGUNDA RACIÓN**********************************/ 2888

/***************************TERCERA RACIÓN*******************************/2888

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2888
			)aux
			JOIN ec_productos p ON p.id_productos=2888
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2888

El producto 2890 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2890
			)aux

Id de Producto: 2890

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2890

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2890
					WHERE p.id_productos=2890
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2890


/************************SEGUNDA RACIÓN**********************************/ 2890

/***************************TERCERA RACIÓN*******************************/2890

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2890
			)aux
			JOIN ec_productos p ON p.id_productos=2890
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2890

El producto 2893 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2893
			)aux

Id de Producto: 2893

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2893

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2893
					WHERE p.id_productos=2893
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2893


/************************SEGUNDA RACIÓN**********************************/ 2893

/***************************TERCERA RACIÓN*******************************/2893

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2893
			)aux
			JOIN ec_productos p ON p.id_productos=2893
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2893

El producto 2894 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2894
			)aux

Id de Producto: 2894

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2894

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2894
					WHERE p.id_productos=2894
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2894


/************************SEGUNDA RACIÓN**********************************/ 2894

/***************************TERCERA RACIÓN*******************************/2894

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2894
			)aux
			JOIN ec_productos p ON p.id_productos=2894
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2894

El producto 2895 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2895
			)aux

Id de Producto: 2895

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2895

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2895
					WHERE p.id_productos=2895
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2895


/************************SEGUNDA RACIÓN**********************************/ 2895

/***************************TERCERA RACIÓN*******************************/2895

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2895
			)aux
			JOIN ec_productos p ON p.id_productos=2895
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2895

El producto 2897 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2897
			)aux

Id de Producto: 2897

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2897

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2897
					WHERE p.id_productos=2897
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2897


/************************SEGUNDA RACIÓN**********************************/ 2897

/***************************TERCERA RACIÓN*******************************/2897

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2897
			)aux
			JOIN ec_productos p ON p.id_productos=2897
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2897

El producto 2908 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2908
			)aux

Id de Producto: 2908

Inventario almacenes principales: -38

Ventas totales: 5
Proceso de racion producto: 2908

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/5/*ventas totales*/)*-38/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2908
					WHERE p.id_productos=2908
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2908

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-38)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2908


/************************SEGUNDA RACIÓN**********************************/ 2908

/***************************TERCERA RACIÓN*******************************/2908

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2908
			)aux
			JOIN ec_productos p ON p.id_productos=2908
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2908

El producto 3258 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3258
			)aux

Id de Producto: 3258

Inventario almacenes principales: 18

Ventas totales: 18
Proceso de racion producto: 3258

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/18/*ventas totales*/)*18/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3258
					WHERE p.id_productos=3258
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3258

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3258

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3258

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3258


/************************SEGUNDA RACIÓN**********************************/ 3258

/***************************TERCERA RACIÓN*******************************/3258

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3258
			)aux
			JOIN ec_productos p ON p.id_productos=3258
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3258

El producto 3260 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3260
			)aux

Id de Producto: 3260

Inventario almacenes principales: 10

Ventas totales: 23
Proceso de racion producto: 3260

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/23/*ventas totales*/)*10/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3260
					WHERE p.id_productos=3260
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.0434782608695654)-(2/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3260

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.3043478260869565)-(3/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3260

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.4782608695652173)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3260

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.1739130434782608)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3260


/************************SEGUNDA RACIÓN**********************************/ 3260

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-3)-(2/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3260

/***************************TERCERA RACIÓN*******************************/3260

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3260
			)aux
			JOIN ec_productos p ON p.id_productos=3260
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3260

El producto 2634 entra en racion

Presentacion: 100

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/100 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2634
			)aux

Id de Producto: 2634

Inventario almacenes principales: 39.94

Ventas totales: 1308
Proceso de racion producto: 2634

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1308/*ventas totales*/)*39.94/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2634
					WHERE p.id_productos=2634
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.90860856269113)-(542/100)) * 100  
						WHERE id_sucursal=3 AND id_producto=2634

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.137675840978593)-(1068/100)) * 100  
						WHERE id_sucursal=4 AND id_producto=2634

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/100)) * 100  
						WHERE id_sucursal=7 AND id_producto=2634

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.10703363914373)-(1100/100)) * 100  
						WHERE id_sucursal=8 AND id_producto=2634

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.565061162079511)-(685/100)) * 100  
						WHERE id_sucursal=9 AND id_producto=2634

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.221620795107032)-(1499/100)) * 100  
						WHERE id_sucursal=10 AND id_producto=2634


/************************SEGUNDA RACIÓN**********************************/ 2634

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-3.58)-(542/100)) * 100  
						WHERE id_sucursal=3 AND id_producto=2634

/***************************TERCERA RACIÓN*******************************/2634

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2634
			)aux
			JOIN ec_productos p ON p.id_productos=2634
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2634

El producto 2644 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2644
			)aux

Id de Producto: 2644

Inventario almacenes principales: 40

Ventas totales: 96
Proceso de racion producto: 2644

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/96/*ventas totales*/)*40/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2644
					WHERE p.id_productos=2644
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.41666666666666663)-(5/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.916666666666667)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.583333333333334)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.333333333333332)-(-1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.333333333333334)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.416666666666666)-(9/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2644

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2644


/************************SEGUNDA RACIÓN**********************************/ 2644

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((5.213333333333333)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2644

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7.253333333333334)-(-1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2644

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4.533333333333333)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2644

/***************************TERCERA RACIÓN*******************************/2644

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2644
			)aux
			JOIN ec_productos p ON p.id_productos=2644
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2644
/************************* INICIAMOS *************************/
SELECT
			ax1.id_productos AS ID,
			ax1.nombre,
			ax1.sumaEstacionalidades,
			ax1.inventarioMatriz,
			ax1.inventarioSucursales,
			IF( (ax1.inventarioSucursales+ax1.inventarioMatriz)<ax1.sumaEstacionalidades,1,0) AS raciona 
		FROM(
			SELECT
				ax.id_productos, 
				ax.nombre,
				ax.sumaEstacionalidades,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1 ,0,(tm.afecta*md.cantidad))) AS inventarioMatriz,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR alm.id_sucursal<=1 OR alm.es_almacen=0,0,(tm.afecta*md.cantidad))) AS inventarioSucursales,
				ax.orden_lista
			FROM(
				SELECT
					p.id_productos, 
					p.nombre,
					SUM(ep.maximo) AS sumaEstacionalidades,
					p.orden_lista
				FROM ec_productos p
				LEFT JOIN ec_estacionalidad_producto ep ON ep.id_producto=p.id_productos
				LEFT JOIN ec_estacionalidad e ON ep.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales s ON s.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales_producto sp ON sp.id_sucursal=s.id_sucursal
				AND sp.id_producto=p.id_productos
				WHERE sp.stock_bajo=0
				GROUP BY p.id_productos
				ORDER BY p.orden_lista
			)ax
			LEFT JOIN ec_movimiento_detalle md ON ax.id_productos=md.id_producto
			LEFT JOIN ec_movimiento_almacen ma ON ma.id_movimiento_almacen=md.id_movimiento
			LEFT JOIN ec_tipos_movimiento tm ON tm.id_tipo_movimiento=ma.id_tipo_movimiento
			LEFT JOIN ec_almacen alm ON alm.id_almacen=ma.id_almacen
			GROUP BY ax.id_productos
			ORDER BY ax.orden_lista
		)ax1
		GROUP BY ax1.id_productos
		ORDER BY ax1.orden_lista

Consultamos el año actualSELECT YEAR(CURRENT_DATE)
2019

El producto 2987 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2987
			)aux

Id de Producto: 2987

Inventario almacenes principales: -63

Ventas totales: 0
Proceso de racion producto: 2987

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-63/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2987
					WHERE p.id_productos=2987
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(7/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2987

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(11/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2987


/************************SEGUNDA RACIÓN**********************************/ 2987

/***************************TERCERA RACIÓN*******************************/2987

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2987
			)aux
			JOIN ec_productos p ON p.id_productos=2987
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2987

El producto 2988 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2988
			)aux

Id de Producto: 2988

Inventario almacenes principales: -3

Ventas totales: 0
Proceso de racion producto: 2988

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2988
					WHERE p.id_productos=2988
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2988

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(6/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2988


/************************SEGUNDA RACIÓN**********************************/ 2988

/***************************TERCERA RACIÓN*******************************/2988

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2988
			)aux
			JOIN ec_productos p ON p.id_productos=2988
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2988

El producto 2989 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2989
			)aux

Id de Producto: 2989

Inventario almacenes principales: -15

Ventas totales: 0
Proceso de racion producto: 2989

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-15/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2989
					WHERE p.id_productos=2989
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(23/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2989

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2989


/************************SEGUNDA RACIÓN**********************************/ 2989

/***************************TERCERA RACIÓN*******************************/2989

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2989
			)aux
			JOIN ec_productos p ON p.id_productos=2989
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2989

El producto 2990 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2990
			)aux

Id de Producto: 2990

Inventario almacenes principales: -19

Ventas totales: 0
Proceso de racion producto: 2990

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-19/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2990
					WHERE p.id_productos=2990
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(8/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(14/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(20/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(25/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2990

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2990


/************************SEGUNDA RACIÓN**********************************/ 2990

/***************************TERCERA RACIÓN*******************************/2990

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2990
			)aux
			JOIN ec_productos p ON p.id_productos=2990
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2990

El producto 2994 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2994
			)aux

Id de Producto: 2994

Inventario almacenes principales: -32

Ventas totales: 0
Proceso de racion producto: 2994

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-32/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2994
					WHERE p.id_productos=2994
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(20/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(30/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(20/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(22/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2994

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(20/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2994


/************************SEGUNDA RACIÓN**********************************/ 2994

/***************************TERCERA RACIÓN*******************************/2994

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2994
			)aux
			JOIN ec_productos p ON p.id_productos=2994
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2994

El producto 3000 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3000
			)aux

Id de Producto: 3000

Inventario almacenes principales: 22

Ventas totales: 60
Proceso de racion producto: 3000

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/60/*ventas totales*/)*22/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3000
					WHERE p.id_productos=3000
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(8/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3000

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.4666666666666666)-(-4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3000

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.233333333333333)-(11/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3000

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.033333333333333)-(17/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3000

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.4666666666666666)-(22/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3000

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.8)-(27/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3000


/************************SEGUNDA RACIÓN**********************************/ 3000

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-63)-(-4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3000

/***************************TERCERA RACIÓN*******************************/3000

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3000
			)aux
			JOIN ec_productos p ON p.id_productos=3000
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3000

El producto 3296 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3296
			)aux

Id de Producto: 3296

Inventario almacenes principales: -4

Ventas totales: 0
Proceso de racion producto: 3296

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3296
					WHERE p.id_productos=3296
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3296

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3296

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3296

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3296


/************************SEGUNDA RACIÓN**********************************/ 3296

/***************************TERCERA RACIÓN*******************************/3296

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3296
			)aux
			JOIN ec_productos p ON p.id_productos=3296
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3296

El producto 1810 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1810
			)aux

Id de Producto: 1810

Inventario almacenes principales: 19

Ventas totales: 0
Proceso de racion producto: 1810

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*19/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1810
					WHERE p.id_productos=1810
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=1810


/************************SEGUNDA RACIÓN**********************************/ 1810

/***************************TERCERA RACIÓN*******************************/1810

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1810
			)aux
			JOIN ec_productos p ON p.id_productos=1810
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1810

El producto 3156 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3156
			)aux

Id de Producto: 3156

Inventario almacenes principales: 3

Ventas totales: 10
Proceso de racion producto: 3156

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/10/*ventas totales*/)*3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3156
					WHERE p.id_productos=3156
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3)-(13/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3156

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3156

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3156


/************************SEGUNDA RACIÓN**********************************/ 3156

/***************************TERCERA RACIÓN*******************************/3156

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3156
			)aux
			JOIN ec_productos p ON p.id_productos=3156
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3156

El producto 1812 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1812
			)aux

Id de Producto: 1812

Inventario almacenes principales: 5

Ventas totales: 22
Proceso de racion producto: 1812

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/22/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1812
					WHERE p.id_productos=1812
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1812

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1812


/************************SEGUNDA RACIÓN**********************************/ 1812

/***************************TERCERA RACIÓN*******************************/1812

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1812
			)aux
			JOIN ec_productos p ON p.id_productos=1812
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1812

El producto 1816 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1816
			)aux

Id de Producto: 1816

Inventario almacenes principales: -1

Ventas totales: 0
Proceso de racion producto: 1816

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1816
					WHERE p.id_productos=1816
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1816


/************************SEGUNDA RACIÓN**********************************/ 1816

/***************************TERCERA RACIÓN*******************************/1816

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1816
			)aux
			JOIN ec_productos p ON p.id_productos=1816
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1816

El producto 2659 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2659
			)aux

Id de Producto: 2659

Inventario almacenes principales: 0

Ventas totales: 177
Proceso de racion producto: 2659

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/177/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2659
					WHERE p.id_productos=2659
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(16/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2659

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(28/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2659

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2659

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2659

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(-17/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2659

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(15/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2659

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(6/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2659


/************************SEGUNDA RACIÓN**********************************/ 2659

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-68)-(-17/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2659

/***************************TERCERA RACIÓN*******************************/2659

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2659
			)aux
			JOIN ec_productos p ON p.id_productos=2659
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2659

El producto 2665 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2665
			)aux

Id de Producto: 2665

Inventario almacenes principales: -17

Ventas totales: 3
Proceso de racion producto: 2665

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*-17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2665
					WHERE p.id_productos=2665
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-17)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2665

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2665


/************************SEGUNDA RACIÓN**********************************/ 2665

/***************************TERCERA RACIÓN*******************************/2665

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2665
			)aux
			JOIN ec_productos p ON p.id_productos=2665
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2665

El producto 3118 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3118
			)aux

Id de Producto: 3118

Inventario almacenes principales: 89

Ventas totales: 146
Proceso de racion producto: 3118

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/146/*ventas totales*/)*89/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3118
					WHERE p.id_productos=3118
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.972602739726026)-(7/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3118

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.753424657534246)-(25/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3118

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((34.13698630136986)-(21/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3118

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((24.383561643835616)-(13/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3118

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.753424657534246)-(24/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3118


/************************SEGUNDA RACIÓN**********************************/ 3118

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6.315789473684211)-(7/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3118

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((19.64912280701754)-(21/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3118

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((14.035087719298245)-(13/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3118

/***************************TERCERA RACIÓN*******************************/3118

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3118
			)aux
			JOIN ec_productos p ON p.id_productos=3118
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3118

El producto 3121 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3121
			)aux

Id de Producto: 3121

Inventario almacenes principales: 40

Ventas totales: 12
Proceso de racion producto: 3121

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/12/*ventas totales*/)*40/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3121
					WHERE p.id_productos=3121
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((33.333333333333336)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3121

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.666666666666666)-(12/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3121


/************************SEGUNDA RACIÓN**********************************/ 3121

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((28)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3121

/***************************TERCERA RACIÓN*******************************/3121

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3121
			)aux
			JOIN ec_productos p ON p.id_productos=3121
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3121

El producto 2670 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2670
			)aux

Id de Producto: 2670

Inventario almacenes principales: 39

Ventas totales: 26
Proceso de racion producto: 2670

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/26/*ventas totales*/)*39/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2670
					WHERE p.id_productos=2670
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6)-(15/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2670

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2670

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((22.499999999999996)-(9/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2670

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.5)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2670


/************************SEGUNDA RACIÓN**********************************/ 2670

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((16.363636363636363)-(9/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2670

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7.636363636363637)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2670

/***************************TERCERA RACIÓN*******************************/2670

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2670
			)aux
			JOIN ec_productos p ON p.id_productos=2670
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2670

El producto 3168 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3168
			)aux

Id de Producto: 3168

Inventario almacenes principales: 13

Ventas totales: 29
Proceso de racion producto: 3168

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/29/*ventas totales*/)*13/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3168
					WHERE p.id_productos=3168
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.206896551724137)-(18/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3168

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.793103448275862)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3168


/************************SEGUNDA RACIÓN**********************************/ 3168

/***************************TERCERA RACIÓN*******************************/3168

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3168
			)aux
			JOIN ec_productos p ON p.id_productos=3168
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3168

El producto 3054 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3054
			)aux

Id de Producto: 3054

Inventario almacenes principales: 66

Ventas totales: 148
Proceso de racion producto: 3054

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/148/*ventas totales*/)*66/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3054
					WHERE p.id_productos=3054
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.581081081081082)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3054

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.04054054054054)-(13/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3054

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=3054

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=3054

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.04054054054054)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3054

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.364864864864865)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3054

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((24.972972972972975)-(28/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3054


/************************SEGUNDA RACIÓN**********************************/ 3054

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((5.795454545454545)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3054

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((9.204545454545455)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3054

/***************************TERCERA RACIÓN*******************************/3054

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3054
			)aux
			JOIN ec_productos p ON p.id_productos=3054
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3054

El producto 3055 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3055
			)aux

Id de Producto: 3055

Inventario almacenes principales: 31

Ventas totales: 56
Proceso de racion producto: 3055

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/56/*ventas totales*/)*31/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3055
					WHERE p.id_productos=3055
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.107142857142857)-(9/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3055

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.196428571428572)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3055

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=3055

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3055

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.642857142857142)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3055

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.732142857142856)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3055

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.321428571428571)-(14/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3055


/************************SEGUNDA RACIÓN**********************************/ 3055

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-14)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3055

/***************************TERCERA RACIÓN*******************************/3055

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3055
			)aux
			JOIN ec_productos p ON p.id_productos=3055
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3055

El producto 1880 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1880
			)aux

Id de Producto: 1880

Inventario almacenes principales: 32

Ventas totales: 8
Proceso de racion producto: 1880

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/8/*ventas totales*/)*32/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1880
					WHERE p.id_productos=1880
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((16)-(11/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1880

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1880

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1880

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(14/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1880


/************************SEGUNDA RACIÓN**********************************/ 1880

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((9)-(11/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1880

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4.5)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1880

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4.5)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1880

/***************************TERCERA RACIÓN*******************************/1880

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1880
			)aux
			JOIN ec_productos p ON p.id_productos=1880
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1880

El producto 2679 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2679
			)aux

Id de Producto: 2679

Inventario almacenes principales: 70

Ventas totales: 114
Proceso de racion producto: 2679

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/114/*ventas totales*/)*70/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2679
					WHERE p.id_productos=2679
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.75438596491228)-(10/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.280701754385964)-(19/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((20.87719298245614)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((19.64912280701754)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2679

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.43859649122807)-(14/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2679


/************************SEGUNDA RACIÓN**********************************/ 2679

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((13.909090909090908)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2679

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((13.090909090909092)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2679

/***************************TERCERA RACIÓN*******************************/2679

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2679
			)aux
			JOIN ec_productos p ON p.id_productos=2679
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2679

El producto 2680 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2680
			)aux

Id de Producto: 2680

Inventario almacenes principales: -1

Ventas totales: 8
Proceso de racion producto: 2680

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/8/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2680
					WHERE p.id_productos=2680
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2680

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2680


/************************SEGUNDA RACIÓN**********************************/ 2680

/***************************TERCERA RACIÓN*******************************/2680

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2680
			)aux
			JOIN ec_productos p ON p.id_productos=2680
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2680

El producto 2681 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2681
			)aux

Id de Producto: 2681

Inventario almacenes principales: -9

Ventas totales: 9
Proceso de racion producto: 2681

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/9/*ventas totales*/)*-9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2681
					WHERE p.id_productos=2681
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2681

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-9)-(6/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2681


/************************SEGUNDA RACIÓN**********************************/ 2681

/***************************TERCERA RACIÓN*******************************/2681

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2681
			)aux
			JOIN ec_productos p ON p.id_productos=2681
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2681

El producto 3170 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3170
			)aux

Id de Producto: 3170

Inventario almacenes principales: 19

Ventas totales: 47
Proceso de racion producto: 3170

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/47/*ventas totales*/)*19/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3170
					WHERE p.id_productos=3170
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.8085106382978723)-(15/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3170

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.680851063829786)-(12/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3170

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.51063829787234)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3170


/************************SEGUNDA RACIÓN**********************************/ 3170

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-8)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3170

/***************************TERCERA RACIÓN*******************************/3170

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3170
			)aux
			JOIN ec_productos p ON p.id_productos=3170
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3170

El producto 1884 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1884
			)aux

Id de Producto: 1884

Inventario almacenes principales: 27

Ventas totales: 35
Proceso de racion producto: 1884

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/35/*ventas totales*/)*27/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1884
					WHERE p.id_productos=1884
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(10/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1884

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1884

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((24.685714285714283)-(24/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1884

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.3142857142857145)-(7/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1884


/************************SEGUNDA RACIÓN**********************************/ 1884

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((10)-(24/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1884

/***************************TERCERA RACIÓN*******************************/1884

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1884
			)aux
			JOIN ec_productos p ON p.id_productos=1884
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1884

El producto 3171 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3171
			)aux

Id de Producto: 3171

Inventario almacenes principales: -25

Ventas totales: 0
Proceso de racion producto: 3171

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-25/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3171
					WHERE p.id_productos=3171
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3171


/************************SEGUNDA RACIÓN**********************************/ 3171

/***************************TERCERA RACIÓN*******************************/3171

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3171
			)aux
			JOIN ec_productos p ON p.id_productos=3171
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3171

El producto 3173 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3173
			)aux

Id de Producto: 3173

Inventario almacenes principales: 135

Ventas totales: 59
Proceso de racion producto: 3173

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/59/*ventas totales*/)*135/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3173
					WHERE p.id_productos=3173
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((57.20338983050847)-(27/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3173

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(20/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3173

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.864406779661017)-(20/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3173

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((38.898305084745765)-(17/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3173

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((32.03389830508475)-(6/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=3173


/************************SEGUNDA RACIÓN**********************************/ 3173

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((42.410714285714285)-(27/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3173

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((28.83928571428571)-(17/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3173

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((23.75)-(6/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=3173

/***************************TERCERA RACIÓN*******************************/3173

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3173
			)aux
			JOIN ec_productos p ON p.id_productos=3173
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3173

El producto 1891 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1891
			)aux

Id de Producto: 1891

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 1891

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1891
					WHERE p.id_productos=1891
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1891


/************************SEGUNDA RACIÓN**********************************/ 1891

/***************************TERCERA RACIÓN*******************************/1891

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1891
			)aux
			JOIN ec_productos p ON p.id_productos=1891
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1891

El producto 1911 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1911
			)aux

Id de Producto: 1911

Inventario almacenes principales: 18

Ventas totales: 29
Proceso de racion producto: 1911

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/29/*ventas totales*/)*18/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1911
					WHERE p.id_productos=1911
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.827586206896552)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1911

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.172413793103448)-(9/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1911


/************************SEGUNDA RACIÓN**********************************/ 1911

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((10)-(9/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1911

/***************************TERCERA RACIÓN*******************************/1911

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1911
			)aux
			JOIN ec_productos p ON p.id_productos=1911
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1911

El producto 1904 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1904
			)aux

Id de Producto: 1904

Inventario almacenes principales: 1

Ventas totales: 8
Proceso de racion producto: 1904

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/8/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1904
					WHERE p.id_productos=1904
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.625)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1904

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.375)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1904


/************************SEGUNDA RACIÓN**********************************/ 1904

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1904

/***************************TERCERA RACIÓN*******************************/1904

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1904
			)aux
			JOIN ec_productos p ON p.id_productos=1904
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1904

El producto 1905 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1905
			)aux

Id de Producto: 1905

Inventario almacenes principales: 10

Ventas totales: 25
Proceso de racion producto: 1905

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/25/*ventas totales*/)*10/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1905
					WHERE p.id_productos=1905
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.2)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1905

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1905

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.5999999999999996)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1905

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.2)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1905


/************************SEGUNDA RACIÓN**********************************/ 1905

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-4)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1905

/***************************TERCERA RACIÓN*******************************/1905

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1905
			)aux
			JOIN ec_productos p ON p.id_productos=1905
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1905

El producto 2688 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2688
			)aux

Id de Producto: 2688

Inventario almacenes principales: 5

Ventas totales: 0
Proceso de racion producto: 2688

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2688
					WHERE p.id_productos=2688
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2688


/************************SEGUNDA RACIÓN**********************************/ 2688

/***************************TERCERA RACIÓN*******************************/2688

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2688
			)aux
			JOIN ec_productos p ON p.id_productos=2688
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2688

El producto 2693 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2693
			)aux

Id de Producto: 2693

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2693

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2693
					WHERE p.id_productos=2693
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2693

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2693


/************************SEGUNDA RACIÓN**********************************/ 2693

/***************************TERCERA RACIÓN*******************************/2693

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2693
			)aux
			JOIN ec_productos p ON p.id_productos=2693
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2693

El producto 3016 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3016
			)aux

Id de Producto: 3016

Inventario almacenes principales: 21

Ventas totales: 17
Proceso de racion producto: 3016

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/17/*ventas totales*/)*21/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3016
					WHERE p.id_productos=3016
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2352941176470589)-(3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3016

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.176470588235294)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3016

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3016

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.4705882352941178)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3016

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.7058823529411766)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3016

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.411764705882353)-(6/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3016


/************************SEGUNDA RACIÓN**********************************/ 3016

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((5)-(6/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3016

/***************************TERCERA RACIÓN*******************************/3016

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3016
			)aux
			JOIN ec_productos p ON p.id_productos=3016
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3016

El producto 3023 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3023
			)aux

Id de Producto: 3023

Inventario almacenes principales: -1

Ventas totales: 14
Proceso de racion producto: 3023

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/14/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3023
					WHERE p.id_productos=3023
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5714285714285714)-(19/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3023

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3023

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3023

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.42857142857142855)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=3023


/************************SEGUNDA RACIÓN**********************************/ 3023

/***************************TERCERA RACIÓN*******************************/3023

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3023
			)aux
			JOIN ec_productos p ON p.id_productos=3023
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3023

El producto 3047 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3047
			)aux

Id de Producto: 3047

Inventario almacenes principales: 17

Ventas totales: 20
Proceso de racion producto: 3047

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/20/*ventas totales*/)*17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3047
					WHERE p.id_productos=3047
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.25)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3047

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.4000000000000004)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3047

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.350000000000001)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3047


/************************SEGUNDA RACIÓN**********************************/ 3047

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3047

/***************************TERCERA RACIÓN*******************************/3047

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3047
			)aux
			JOIN ec_productos p ON p.id_productos=3047
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3047

El producto 3049 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3049
			)aux

Id de Producto: 3049

Inventario almacenes principales: -1

Ventas totales: 4
Proceso de racion producto: 3049

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/4/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3049
					WHERE p.id_productos=3049
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3049


/************************SEGUNDA RACIÓN**********************************/ 3049

/***************************TERCERA RACIÓN*******************************/3049

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3049
			)aux
			JOIN ec_productos p ON p.id_productos=3049
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3049

El producto 3081 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3081
			)aux

Id de Producto: 3081

Inventario almacenes principales: 3

Ventas totales: 16
Proceso de racion producto: 3081

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/16/*ventas totales*/)*3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3081
					WHERE p.id_productos=3081
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.75)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3081

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.75)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3081

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.5)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3081


/************************SEGUNDA RACIÓN**********************************/ 3081

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-4)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3081

/***************************TERCERA RACIÓN*******************************/3081

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3081
			)aux
			JOIN ec_productos p ON p.id_productos=3081
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3081

El producto 3124 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3124
			)aux

Id de Producto: 3124

Inventario almacenes principales: 10

Ventas totales: 17
Proceso de racion producto: 3124

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/17/*ventas totales*/)*10/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3124
					WHERE p.id_productos=3124
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.5882352941176471)-(3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3124

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7647058823529413)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3124

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7647058823529413)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3124

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.882352941176471)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3124


/************************SEGUNDA RACIÓN**********************************/ 3124

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-4)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3124

/***************************TERCERA RACIÓN*******************************/3124

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3124
			)aux
			JOIN ec_productos p ON p.id_productos=3124
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3124

El producto 3125 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3125
			)aux

Id de Producto: 3125

Inventario almacenes principales: 4

Ventas totales: 33
Proceso de racion producto: 3125

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/33/*ventas totales*/)*4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3125
					WHERE p.id_productos=3125
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.24242424242424243)-(1/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3125

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.0909090909090908)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3125

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.8181818181818181)-(1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3125

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3125

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.8484848484848485)-(3/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3125


/************************SEGUNDA RACIÓN**********************************/ 3125

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-7)-(1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3125

/***************************TERCERA RACIÓN*******************************/3125

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3125
			)aux
			JOIN ec_productos p ON p.id_productos=3125
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3125

El producto 3221 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3221
			)aux

Id de Producto: 3221

Inventario almacenes principales: -1

Ventas totales: 1
Proceso de racion producto: 3221

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3221
					WHERE p.id_productos=3221
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3221

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3221


/************************SEGUNDA RACIÓN**********************************/ 3221

/***************************TERCERA RACIÓN*******************************/3221

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3221
			)aux
			JOIN ec_productos p ON p.id_productos=3221
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3221

El producto 3223 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3223
			)aux

Id de Producto: 3223

Inventario almacenes principales: 13

Ventas totales: 25
Proceso de racion producto: 3223

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/25/*ventas totales*/)*13/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3223
					WHERE p.id_productos=3223
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.08)-(6/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3223

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.56)-(7/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3223

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.2)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3223

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.16)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3223


/************************SEGUNDA RACIÓN**********************************/ 3223

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-4)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3223

/***************************TERCERA RACIÓN*******************************/3223

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3223
			)aux
			JOIN ec_productos p ON p.id_productos=3223
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3223

El producto 3251 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3251
			)aux

Id de Producto: 3251

Inventario almacenes principales: 16

Ventas totales: 14
Proceso de racion producto: 3251

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/14/*ventas totales*/)*16/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3251
					WHERE p.id_productos=3251
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.1428571428571428)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3251

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.714285714285714)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3251

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.714285714285714)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3251

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.4285714285714284)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3251


/************************SEGUNDA RACIÓN**********************************/ 3251

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3251

/***************************TERCERA RACIÓN*******************************/3251

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3251
			)aux
			JOIN ec_productos p ON p.id_productos=3251
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3251

El producto 3252 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3252
			)aux

Id de Producto: 3252

Inventario almacenes principales: 0

Ventas totales: 3
Proceso de racion producto: 3252

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3252
					WHERE p.id_productos=3252
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3252


/************************SEGUNDA RACIÓN**********************************/ 3252

/***************************TERCERA RACIÓN*******************************/3252

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3252
			)aux
			JOIN ec_productos p ON p.id_productos=3252
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3252

El producto 1938 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1938
			)aux

Id de Producto: 1938

Inventario almacenes principales: -3

Ventas totales: 12
Proceso de racion producto: 1938

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/12/*ventas totales*/)*-3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1938
					WHERE p.id_productos=1938
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3)-(-2/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1938


/************************SEGUNDA RACIÓN**********************************/ 1938

/***************************TERCERA RACIÓN*******************************/1938

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1938
			)aux
			JOIN ec_productos p ON p.id_productos=1938
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1938

El producto 1940 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1940
			)aux

Id de Producto: 1940

Inventario almacenes principales: 4

Ventas totales: 8
Proceso de racion producto: 1940

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/8/*ventas totales*/)*4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1940
					WHERE p.id_productos=1940
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1940

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1940


/************************SEGUNDA RACIÓN**********************************/ 1940

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1940

/***************************TERCERA RACIÓN*******************************/1940

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1940
			)aux
			JOIN ec_productos p ON p.id_productos=1940
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1940

El producto 3264 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3264
			)aux

Id de Producto: 3264

Inventario almacenes principales: 45

Ventas totales: 44
Proceso de racion producto: 3264

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/44/*ventas totales*/)*45/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3264
					WHERE p.id_productos=3264
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((15.34090909090909)-(17/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3264

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.181818181818182)-(12/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3264

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((21.477272727272727)-(13/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3264


/************************SEGUNDA RACIÓN**********************************/ 3264

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((16)-(13/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3264

/***************************TERCERA RACIÓN*******************************/3264

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3264
			)aux
			JOIN ec_productos p ON p.id_productos=3264
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3264

El producto 1950 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1950
			)aux

Id de Producto: 1950

Inventario almacenes principales: 23

Ventas totales: 20
Proceso de racion producto: 1950

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/20/*ventas totales*/)*23/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1950
					WHERE p.id_productos=1950
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.049999999999999)-(10/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1950

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.1500000000000001)-(9/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1950

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.799999999999999)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1950


/************************SEGUNDA RACIÓN**********************************/ 1950

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1950

/***************************TERCERA RACIÓN*******************************/1950

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1950
			)aux
			JOIN ec_productos p ON p.id_productos=1950
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1950

El producto 1960 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1960
			)aux

Id de Producto: 1960

Inventario almacenes principales: 12

Ventas totales: 0
Proceso de racion producto: 1960

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*12/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1960
					WHERE p.id_productos=1960
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1960

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=1960

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1960

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=1960


/************************SEGUNDA RACIÓN**********************************/ 1960

/***************************TERCERA RACIÓN*******************************/1960

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1960
			)aux
			JOIN ec_productos p ON p.id_productos=1960
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1960

El producto 1970 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1970
			)aux

Id de Producto: 1970

Inventario almacenes principales: -15

Ventas totales: 15
Proceso de racion producto: 1970

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/15/*ventas totales*/)*-15/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1970
					WHERE p.id_productos=1970
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1970

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1970

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-15)-(-8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1970


/************************SEGUNDA RACIÓN**********************************/ 1970

/***************************TERCERA RACIÓN*******************************/1970

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1970
			)aux
			JOIN ec_productos p ON p.id_productos=1970
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1970

El producto 1978 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1978
			)aux

Id de Producto: 1978

Inventario almacenes principales: 32

Ventas totales: 70
Proceso de racion producto: 1978

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/70/*ventas totales*/)*32/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1978
					WHERE p.id_productos=1978
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.742857142857143)-(6/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.942857142857143)-(9/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.8285714285714285)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.228571428571428)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.257142857142858)-(17/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=1978


/************************SEGUNDA RACIÓN**********************************/ 1978

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-8)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1978

/***************************TERCERA RACIÓN*******************************/1978

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1978
			)aux
			JOIN ec_productos p ON p.id_productos=1978
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1978

El producto 1982 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1982
			)aux

Id de Producto: 1982

Inventario almacenes principales: 15

Ventas totales: 18
Proceso de racion producto: 1982

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/18/*ventas totales*/)*15/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1982
					WHERE p.id_productos=1982
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.166666666666667)-(11/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1982

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1982

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.5)-(7/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1982

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.333333333333334)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1982


/************************SEGUNDA RACIÓN**********************************/ 1982

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-3)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1982

/***************************TERCERA RACIÓN*******************************/1982

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1982
			)aux
			JOIN ec_productos p ON p.id_productos=1982
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1982

El producto 1983 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1983
			)aux

Id de Producto: 1983

Inventario almacenes principales: 5

Ventas totales: 18
Proceso de racion producto: 1983

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/18/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1983
					WHERE p.id_productos=1983
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.5)-(16/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1983

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.5)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1983


/************************SEGUNDA RACIÓN**********************************/ 1983

/***************************TERCERA RACIÓN*******************************/1983

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1983
			)aux
			JOIN ec_productos p ON p.id_productos=1983
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1983

El producto 2721 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2721
			)aux

Id de Producto: 2721

Inventario almacenes principales: -31

Ventas totales: 3
Proceso de racion producto: 2721

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*-31/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2721
					WHERE p.id_productos=2721
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(10/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2721

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2721

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2721

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-31)-(11/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2721


/************************SEGUNDA RACIÓN**********************************/ 2721

/***************************TERCERA RACIÓN*******************************/2721

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2721
			)aux
			JOIN ec_productos p ON p.id_productos=2721
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2721

El producto 2725 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2725
			)aux

Id de Producto: 2725

Inventario almacenes principales: 55

Ventas totales: 36
Proceso de racion producto: 2725

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/36/*ventas totales*/)*55/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2725
					WHERE p.id_productos=2725
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.75)-(11/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2725

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.583333333333333)-(33/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2725

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.166666666666666)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2725

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((27.5)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2725


/************************SEGUNDA RACIÓN**********************************/ 2725

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6)-(11/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2725

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((4)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2725

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((12)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2725

/***************************TERCERA RACIÓN*******************************/2725

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2725
			)aux
			JOIN ec_productos p ON p.id_productos=2725
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2725

El producto 2730 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2730
			)aux

Id de Producto: 2730

Inventario almacenes principales: 5

Ventas totales: 10
Proceso de racion producto: 2730

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/10/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2730
					WHERE p.id_productos=2730
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2730

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2730

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1)-(-2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2730


/************************SEGUNDA RACIÓN**********************************/ 2730

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-3)-(-2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2730

/***************************TERCERA RACIÓN*******************************/2730

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2730
			)aux
			JOIN ec_productos p ON p.id_productos=2730
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2730

El producto 3019 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3019
			)aux

Id de Producto: 3019

Inventario almacenes principales: 88

Ventas totales: 93
Proceso de racion producto: 3019

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/93/*ventas totales*/)*88/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3019
					WHERE p.id_productos=3019
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.35483870967742)-(7/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3019

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.67741935483871)-(13/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3019

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.301075268817204)-(31/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3019

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3019

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.24731182795699)-(11/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3019

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((20.81720430107527)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3019

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((24.602150537634408)-(18/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3019


/************************SEGUNDA RACIÓN**********************************/ 3019

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7.135135135135135)-(7/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3019

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8.324324324324325)-(11/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3019

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((13.081081081081082)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3019

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((15.45945945945946)-(18/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3019

/***************************TERCERA RACIÓN*******************************/3019

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3019
			)aux
			JOIN ec_productos p ON p.id_productos=3019
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3019

El producto 3087 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3087
			)aux

Id de Producto: 3087

Inventario almacenes principales: 1

Ventas totales: 6
Proceso de racion producto: 3087

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/6/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3087
					WHERE p.id_productos=3087
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1)-(24/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3087


/************************SEGUNDA RACIÓN**********************************/ 3087

/***************************TERCERA RACIÓN*******************************/3087

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3087
			)aux
			JOIN ec_productos p ON p.id_productos=3087
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3087

El producto 3088 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3088
			)aux

Id de Producto: 3088

Inventario almacenes principales: 17

Ventas totales: 15
Proceso de racion producto: 3088

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/15/*ventas totales*/)*17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3088
					WHERE p.id_productos=3088
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.066666666666666)-(9/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3088

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.933333333333334)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3088


/************************SEGUNDA RACIÓN**********************************/ 3088

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3088

/***************************TERCERA RACIÓN*******************************/3088

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3088
			)aux
			JOIN ec_productos p ON p.id_productos=3088
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3088

El producto 3181 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3181
			)aux

Id de Producto: 3181

Inventario almacenes principales: 31

Ventas totales: 26
Proceso de racion producto: 3181

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/26/*ventas totales*/)*31/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3181
					WHERE p.id_productos=3181
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.769230769230769)-(10/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3181

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((17.884615384615383)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3181

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.346153846153845)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3181

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=3181


/************************SEGUNDA RACIÓN**********************************/ 3181

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3181

/***************************TERCERA RACIÓN*******************************/3181

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3181
			)aux
			JOIN ec_productos p ON p.id_productos=3181
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3181

El producto 3185 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3185
			)aux

Id de Producto: 3185

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 3185

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3185
					WHERE p.id_productos=3185
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 3185

/***************************TERCERA RACIÓN*******************************/3185

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3185
			)aux
			JOIN ec_productos p ON p.id_productos=3185
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3185

El producto 3188 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3188
			)aux

Id de Producto: 3188

Inventario almacenes principales: 1

Ventas totales: 0
Proceso de racion producto: 3188

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3188
					WHERE p.id_productos=3188
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(16/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3188


/************************SEGUNDA RACIÓN**********************************/ 3188

/***************************TERCERA RACIÓN*******************************/3188

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3188
			)aux
			JOIN ec_productos p ON p.id_productos=3188
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3188

El producto 3189 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3189
			)aux

Id de Producto: 3189

Inventario almacenes principales: -4

Ventas totales: 2
Proceso de racion producto: 3189

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*-4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3189
					WHERE p.id_productos=3189
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3189


/************************SEGUNDA RACIÓN**********************************/ 3189

/***************************TERCERA RACIÓN*******************************/3189

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3189
			)aux
			JOIN ec_productos p ON p.id_productos=3189
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3189

El producto 3191 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3191
			)aux

Id de Producto: 3191

Inventario almacenes principales: 30

Ventas totales: 32
Proceso de racion producto: 3191

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/32/*ventas totales*/)*30/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3191
					WHERE p.id_productos=3191
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.5625)-(13/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3191

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.75)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3191

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((19.6875)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3191

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(8/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=3191


/************************SEGUNDA RACIÓN**********************************/ 3191

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-1)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3191

/***************************TERCERA RACIÓN*******************************/3191

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3191
			)aux
			JOIN ec_productos p ON p.id_productos=3191
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3191

El producto 3195 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3195
			)aux

Id de Producto: 3195

Inventario almacenes principales: 2

Ventas totales: 9
Proceso de racion producto: 3195

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/9/*ventas totales*/)*2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3195
					WHERE p.id_productos=3195
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3195

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3195

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3195


/************************SEGUNDA RACIÓN**********************************/ 3195

/***************************TERCERA RACIÓN*******************************/3195

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3195
			)aux
			JOIN ec_productos p ON p.id_productos=3195
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3195

El producto 3203 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3203
			)aux

Id de Producto: 3203

Inventario almacenes principales: 33

Ventas totales: 23
Proceso de racion producto: 3203

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/23/*ventas totales*/)*33/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3203
					WHERE p.id_productos=3203
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.739130434782608)-(11/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3203

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((27.26086956521739)-(7/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3203


/************************SEGUNDA RACIÓN**********************************/ 3203

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((22)-(7/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3203

/***************************TERCERA RACIÓN*******************************/3203

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3203
			)aux
			JOIN ec_productos p ON p.id_productos=3203
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3203

El producto 3206 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3206
			)aux

Id de Producto: 3206

Inventario almacenes principales: 60

Ventas totales: 35
Proceso de racion producto: 3206

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/35/*ventas totales*/)*60/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3206
					WHERE p.id_productos=3206
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12)-(7/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3206

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((24)-(14/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3206

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12)-(19/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3206

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12)-(19/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3206


/************************SEGUNDA RACIÓN**********************************/ 3206

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7.333333333333333)-(7/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3206

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((14.666666666666666)-(14/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3206

/***************************TERCERA RACIÓN*******************************/3206

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3206
			)aux
			JOIN ec_productos p ON p.id_productos=3206
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3206

El producto 2741 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2741
			)aux

Id de Producto: 2741

Inventario almacenes principales: 45

Ventas totales: 8
Proceso de racion producto: 2741

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/8/*ventas totales*/)*45/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2741
					WHERE p.id_productos=2741
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2741

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((28.125)-(13/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2741

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2741

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.625)-(11/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2741

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.25)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2741


/************************SEGUNDA RACIÓN**********************************/ 2741

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((15.714285714285715)-(13/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2741

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6.285714285714286)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2741

/***************************TERCERA RACIÓN*******************************/2741

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2741
			)aux
			JOIN ec_productos p ON p.id_productos=2741
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2741

El producto 2742 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2742
			)aux

Id de Producto: 2742

Inventario almacenes principales: 21

Ventas totales: 13
Proceso de racion producto: 2742

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/13/*ventas totales*/)*21/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2742
					WHERE p.id_productos=2742
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.461538461538462)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2742

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.230769230769231)-(18/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2742

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2742

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.230769230769231)-(6/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2742

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.076923076923077)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2742


/************************SEGUNDA RACIÓN**********************************/ 2742

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-1.3333333333333333)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2742

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-1.6666666666666667)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2742

/***************************TERCERA RACIÓN*******************************/2742

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2742
			)aux
			JOIN ec_productos p ON p.id_productos=2742
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2742

El producto 2743 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2743
			)aux

Id de Producto: 2743

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2743

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2743
					WHERE p.id_productos=2743
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2743

/***************************TERCERA RACIÓN*******************************/2743

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2743
			)aux
			JOIN ec_productos p ON p.id_productos=2743
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2743

El producto 2745 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2745
			)aux

Id de Producto: 2745

Inventario almacenes principales: 122

Ventas totales: 78
Proceso de racion producto: 2745

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/78/*ventas totales*/)*122/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2745
					WHERE p.id_productos=2745
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.256410256410256)-(9/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((34.41025641025641)-(-2/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((21.897435897435898)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=5 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=6 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((18.76923076923077)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((14.076923076923078)-(11/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((17.205128205128204)-(1/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2745

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.384615384615385)-(6/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2745


/************************SEGUNDA RACIÓN**********************************/ 2745

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((33.5945945945946)-(-2/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2745

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((21.37837837837838)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2745

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((18.324324324324326)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2745

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((13.743243243243244)-(11/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2745

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((16.7972972972973)-(1/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2745

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((9.162162162162163)-(6/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2745

/***************************TERCERA RACIÓN*******************************/2745

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2745
			)aux
			JOIN ec_productos p ON p.id_productos=2745
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2745

El producto 3080 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3080
			)aux

Id de Producto: 3080

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 3080

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3080
					WHERE p.id_productos=3080
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3080


/************************SEGUNDA RACIÓN**********************************/ 3080

/***************************TERCERA RACIÓN*******************************/3080

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3080
			)aux
			JOIN ec_productos p ON p.id_productos=3080
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3080

El producto 2753 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2753
			)aux

Id de Producto: 2753

Inventario almacenes principales: 29

Ventas totales: 23
Proceso de racion producto: 2753

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/23/*ventas totales*/)*29/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2753
					WHERE p.id_productos=2753
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2608695652173914)-(9/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2753

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.304347826086956)-(18/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2753

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2753

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((21.434782608695652)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2753


/************************SEGUNDA RACIÓN**********************************/ 2753

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((2)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2753

/***************************TERCERA RACIÓN*******************************/2753

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2753
			)aux
			JOIN ec_productos p ON p.id_productos=2753
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2753

El producto 3060 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3060
			)aux

Id de Producto: 3060

Inventario almacenes principales: 34

Ventas totales: 31
Proceso de racion producto: 3060

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/31/*ventas totales*/)*34/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3060
					WHERE p.id_productos=3060
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(13/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3060

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(11/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3060

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.387096774193548)-(15/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3060

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((29.612903225806452)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3060


/************************SEGUNDA RACIÓN**********************************/ 3060

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-5)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3060

/***************************TERCERA RACIÓN*******************************/3060

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3060
			)aux
			JOIN ec_productos p ON p.id_productos=3060
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3060

El producto 2768 entra en racion

Presentacion: 50

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/50 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2768
			)aux

Id de Producto: 2768

Inventario almacenes principales: -9.7

Ventas totales: 286
Proceso de racion producto: 2768

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/286/*ventas totales*/)*-9.7/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2768
					WHERE p.id_productos=2768
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.10174825174825175)-(47/50)) * 50  
						WHERE id_sucursal=3 AND id_producto=2768

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-5.596153846153845)-(85/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2768

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.4244755244755243)-(8/50)) * 50  
						WHERE id_sucursal=8 AND id_producto=2768

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(50/50)) * 50  
						WHERE id_sucursal=9 AND id_producto=2768

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2.5776223776223772)-(-26/50)) * 50  
						WHERE id_sucursal=10 AND id_producto=2768

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/50)) * 50  
						WHERE id_sucursal=11 AND id_producto=2768


/************************SEGUNDA RACIÓN**********************************/ 2768

/***************************TERCERA RACIÓN*******************************/2768

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2768
			)aux
			JOIN ec_productos p ON p.id_productos=2768
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2768

El producto 2769 entra en racion

Presentacion: 50

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/50 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2769
			)aux

Id de Producto: 2769

Inventario almacenes principales: -2.96

Ventas totales: 670
Proceso de racion producto: 2769

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/670/*ventas totales*/)*-2.96/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2769
					WHERE p.id_productos=2769
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.3755223880597015)-(76/50)) * 50  
						WHERE id_sucursal=2 AND id_producto=2769

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.02208955223880597)-(145/50)) * 50  
						WHERE id_sucursal=3 AND id_producto=2769

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.2546865671641791)-(166/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2769

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/50)) * 50  
						WHERE id_sucursal=7 AND id_producto=2769

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.8261492537313433)-(124/50)) * 50  
						WHERE id_sucursal=8 AND id_producto=2769

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.4815522388059701)-(79/50)) * 50  
						WHERE id_sucursal=9 AND id_producto=2769


/************************SEGUNDA RACIÓN**********************************/ 2769

/***************************TERCERA RACIÓN*******************************/2769

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2769
			)aux
			JOIN ec_productos p ON p.id_productos=2769
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2769

El producto 2047 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2047
			)aux

Id de Producto: 2047

Inventario almacenes principales: 0

Ventas totales: 9
Proceso de racion producto: 2047

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/9/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2047
					WHERE p.id_productos=2047
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2047


/************************SEGUNDA RACIÓN**********************************/ 2047

/***************************TERCERA RACIÓN*******************************/2047

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2047
			)aux
			JOIN ec_productos p ON p.id_productos=2047
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2047

El producto 1808 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=1808
			)aux

Id de Producto: 1808

Inventario almacenes principales: -276

Ventas totales: 280
Proceso de racion producto: 1808

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/280/*ventas totales*/)*-276/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=1808
					WHERE p.id_productos=1808
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=1808

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-13.8)-(-14/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=1808

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-160.67142857142858)-(-160/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=1808

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=1808

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-57.17142857142858)-(-58/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1808

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-44.35714285714286)-(-44/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=1808


/************************SEGUNDA RACIÓN**********************************/ 1808

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-58)-(-58/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=1808

/***************************TERCERA RACIÓN*******************************/1808

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=1808
			)aux
			JOIN ec_productos p ON p.id_productos=1808
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=1808

El producto 2013 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2013
			)aux

Id de Producto: 2013

Inventario almacenes principales: -20

Ventas totales: 30
Proceso de racion producto: 2013

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/30/*ventas totales*/)*-20/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2013
					WHERE p.id_productos=2013
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-20)-(-4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2013


/************************SEGUNDA RACIÓN**********************************/ 2013

/***************************TERCERA RACIÓN*******************************/2013

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2013
			)aux
			JOIN ec_productos p ON p.id_productos=2013
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2013

El producto 2017 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2017
			)aux

Id de Producto: 2017

Inventario almacenes principales: 14

Ventas totales: 1
Proceso de racion producto: 2017

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*14/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2017
					WHERE p.id_productos=2017
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((14)-(14/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2017


/************************SEGUNDA RACIÓN**********************************/ 2017

/***************************TERCERA RACIÓN*******************************/2017

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2017
			)aux
			JOIN ec_productos p ON p.id_productos=2017
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2017

El producto 2184 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2184
			)aux

Id de Producto: 2184

Inventario almacenes principales: -8

Ventas totales: 15
Proceso de racion producto: 2184

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/15/*ventas totales*/)*-8/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2184
					WHERE p.id_productos=2184
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5333333333333333)-(-1/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2184

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(-3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2184

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3.2)-(20/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2184

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2.1333333333333333)-(6/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2184

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.6)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2184

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5333333333333333)-(0/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2184


/************************SEGUNDA RACIÓN**********************************/ 2184

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0)-(-3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2184

/***************************TERCERA RACIÓN*******************************/2184

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2184
			)aux
			JOIN ec_productos p ON p.id_productos=2184
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2184

El producto 2192 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2192
			)aux

Id de Producto: 2192

Inventario almacenes principales: -42

Ventas totales: 0
Proceso de racion producto: 2192

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-42/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2192
					WHERE p.id_productos=2192
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(6/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2192

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2192

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2192


/************************SEGUNDA RACIÓN**********************************/ 2192

/***************************TERCERA RACIÓN*******************************/2192

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2192
			)aux
			JOIN ec_productos p ON p.id_productos=2192
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2192

El producto 2193 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2193
			)aux

Id de Producto: 2193

Inventario almacenes principales: -47

Ventas totales: 1
Proceso de racion producto: 2193

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*-47/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2193
					WHERE p.id_productos=2193
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(6/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2193

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(24/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2193

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-47)-(23/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2193


/************************SEGUNDA RACIÓN**********************************/ 2193

/***************************TERCERA RACIÓN*******************************/2193

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2193
			)aux
			JOIN ec_productos p ON p.id_productos=2193
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2193

El producto 2194 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2194
			)aux

Id de Producto: 2194

Inventario almacenes principales: -30

Ventas totales: 0
Proceso de racion producto: 2194

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-30/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2194
					WHERE p.id_productos=2194
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2194

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2194


/************************SEGUNDA RACIÓN**********************************/ 2194

/***************************TERCERA RACIÓN*******************************/2194

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2194
			)aux
			JOIN ec_productos p ON p.id_productos=2194
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2194

El producto 2195 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2195
			)aux

Id de Producto: 2195

Inventario almacenes principales: -30

Ventas totales: 0
Proceso de racion producto: 2195

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-30/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2195
					WHERE p.id_productos=2195
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2195

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2195


/************************SEGUNDA RACIÓN**********************************/ 2195

/***************************TERCERA RACIÓN*******************************/2195

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2195
			)aux
			JOIN ec_productos p ON p.id_productos=2195
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2195

El producto 2196 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2196
			)aux

Id de Producto: 2196

Inventario almacenes principales: -30

Ventas totales: 0
Proceso de racion producto: 2196

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-30/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2196
					WHERE p.id_productos=2196
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2196

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(24/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2196


/************************SEGUNDA RACIÓN**********************************/ 2196

/***************************TERCERA RACIÓN*******************************/2196

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2196
			)aux
			JOIN ec_productos p ON p.id_productos=2196
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2196

El producto 2204 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2204
			)aux

Id de Producto: 2204

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2204

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2204
					WHERE p.id_productos=2204
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2204


/************************SEGUNDA RACIÓN**********************************/ 2204

/***************************TERCERA RACIÓN*******************************/2204

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2204
			)aux
			JOIN ec_productos p ON p.id_productos=2204
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2204

El producto 2215 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2215
			)aux

Id de Producto: 2215

Inventario almacenes principales: 21

Ventas totales: 30
Proceso de racion producto: 2215

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/30/*ventas totales*/)*21/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2215
					WHERE p.id_productos=2215
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2215

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.1)-(7/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2215

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2215

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2215

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.9)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2215


/************************SEGUNDA RACIÓN**********************************/ 2215

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((9.1)-(7/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2215

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((11.9)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2215

/***************************TERCERA RACIÓN*******************************/2215

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2215
			)aux
			JOIN ec_productos p ON p.id_productos=2215
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2215

El producto 2216 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2216
			)aux

Id de Producto: 2216

Inventario almacenes principales: 11

Ventas totales: 15
Proceso de racion producto: 2216

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/15/*ventas totales*/)*11/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2216
					WHERE p.id_productos=2216
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.933333333333333)-(11/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2216

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.066666666666666)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2216


/************************SEGUNDA RACIÓN**********************************/ 2216

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2216

/***************************TERCERA RACIÓN*******************************/2216

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2216
			)aux
			JOIN ec_productos p ON p.id_productos=2216
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2216

El producto 2217 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2217
			)aux

Id de Producto: 2217

Inventario almacenes principales: 10

Ventas totales: 5
Proceso de racion producto: 2217

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/5/*ventas totales*/)*10/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2217
					WHERE p.id_productos=2217
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8)-(14/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2217

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2217


/************************SEGUNDA RACIÓN**********************************/ 2217

/***************************TERCERA RACIÓN*******************************/2217

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2217
			)aux
			JOIN ec_productos p ON p.id_productos=2217
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2217

El producto 2073 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2073
			)aux

Id de Producto: 2073

Inventario almacenes principales: -20

Ventas totales: 20
Proceso de racion producto: 2073

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/20/*ventas totales*/)*-20/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2073
					WHERE p.id_productos=2073
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-20)-(-20/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2073

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2073


/************************SEGUNDA RACIÓN**********************************/ 2073

/***************************TERCERA RACIÓN*******************************/2073

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2073
			)aux
			JOIN ec_productos p ON p.id_productos=2073
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2073

El producto 2080 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2080
			)aux

Id de Producto: 2080

Inventario almacenes principales: 30

Ventas totales: 18
Proceso de racion producto: 2080

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/18/*ventas totales*/)*30/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2080
					WHERE p.id_productos=2080
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((30)-(30/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2080

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2080


/************************SEGUNDA RACIÓN**********************************/ 2080

/***************************TERCERA RACIÓN*******************************/2080

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2080
			)aux
			JOIN ec_productos p ON p.id_productos=2080
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2080

El producto 2081 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2081
			)aux

Id de Producto: 2081

Inventario almacenes principales: 9

Ventas totales: 0
Proceso de racion producto: 2081

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2081
					WHERE p.id_productos=2081
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2081

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2081

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2081


/************************SEGUNDA RACIÓN**********************************/ 2081

/***************************TERCERA RACIÓN*******************************/2081

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2081
			)aux
			JOIN ec_productos p ON p.id_productos=2081
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2081

El producto 2780 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2780
			)aux

Id de Producto: 2780

Inventario almacenes principales: -84

Ventas totales: 6
Proceso de racion producto: 2780

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/6/*ventas totales*/)*-84/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2780
					WHERE p.id_productos=2780
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-84)-(6/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2780

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2780

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2780

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2780

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(40/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2780

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(40/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2780


/************************SEGUNDA RACIÓN**********************************/ 2780

/***************************TERCERA RACIÓN*******************************/2780

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2780
			)aux
			JOIN ec_productos p ON p.id_productos=2780
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2780

El producto 2935 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2935
			)aux

Id de Producto: 2935

Inventario almacenes principales: -72

Ventas totales: 0
Proceso de racion producto: 2935

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-72/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2935
					WHERE p.id_productos=2935
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(12/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2935

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2935

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2935

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2935

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2935

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(48/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2935

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(36/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2935


/************************SEGUNDA RACIÓN**********************************/ 2935

/***************************TERCERA RACIÓN*******************************/2935

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2935
			)aux
			JOIN ec_productos p ON p.id_productos=2935
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2935

El producto 3254 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3254
			)aux

Id de Producto: 3254

Inventario almacenes principales: -84

Ventas totales: 0
Proceso de racion producto: 3254

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-84/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3254
					WHERE p.id_productos=3254
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(20/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=3254

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3254

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(48/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3254

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(48/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3254


/************************SEGUNDA RACIÓN**********************************/ 3254

/***************************TERCERA RACIÓN*******************************/3254

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3254
			)aux
			JOIN ec_productos p ON p.id_productos=3254
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3254

El producto 2936 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2936
			)aux

Id de Producto: 2936

Inventario almacenes principales: -78

Ventas totales: 2
Proceso de racion producto: 2936

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*-78/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2936
					WHERE p.id_productos=2936
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2936

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2936

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2936

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2936

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-78)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2936


/************************SEGUNDA RACIÓN**********************************/ 2936

/***************************TERCERA RACIÓN*******************************/2936

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2936
			)aux
			JOIN ec_productos p ON p.id_productos=2936
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2936

El producto 2937 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2937
			)aux

Id de Producto: 2937

Inventario almacenes principales: 41

Ventas totales: 26
Proceso de racion producto: 2937

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/26/*ventas totales*/)*41/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2937
					WHERE p.id_productos=2937
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2937

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((37.84615384615385)-(44/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2937

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2937

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2937

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.153846153846154)-(27/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2937

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(32/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2937


/************************SEGUNDA RACIÓN**********************************/ 2937

/***************************TERCERA RACIÓN*******************************/2937

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2937
			)aux
			JOIN ec_productos p ON p.id_productos=2937
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2937

El producto 2086 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2086
			)aux

Id de Producto: 2086

Inventario almacenes principales: -4

Ventas totales: 259
Proceso de racion producto: 2086

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/259/*ventas totales*/)*-4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2086
					WHERE p.id_productos=2086
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.498069498069498)-(43/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2086

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2086

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.525096525096525)-(8/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2086

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.6486486486486487)-(9/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2086

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5868725868725869)-(34/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2086

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.7413127413127413)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2086


/************************SEGUNDA RACIÓN**********************************/ 2086

/***************************TERCERA RACIÓN*******************************/2086

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2086
			)aux
			JOIN ec_productos p ON p.id_productos=2086
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2086

El producto 2088 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2088
			)aux

Id de Producto: 2088

Inventario almacenes principales: 187

Ventas totales: 110
Proceso de racion producto: 2088

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/110/*ventas totales*/)*187/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2088
					WHERE p.id_productos=2088
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((30.6)-(26/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2088

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((40.8)-(54/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2088

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((74.8)-(62/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2088

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.6)-(36/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2088

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.8)-(44/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2088

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((20.4)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2088


/************************SEGUNDA RACIÓN**********************************/ 2088

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((12.891891891891893)-(26/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2088

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((31.513513513513516)-(62/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2088

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8.594594594594595)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2088

/***************************TERCERA RACIÓN*******************************/2088

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2088
			)aux
			JOIN ec_productos p ON p.id_productos=2088
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2088

El producto 2089 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2089
			)aux

Id de Producto: 2089

Inventario almacenes principales: 69

Ventas totales: 21
Proceso de racion producto: 2089

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/21/*ventas totales*/)*69/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2089
					WHERE p.id_productos=2089
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((19.71428571428571)-(24/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2089

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((29.57142857142857)-(69/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2089

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((19.71428571428571)-(21/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2089


/************************SEGUNDA RACIÓN**********************************/ 2089

/***************************TERCERA RACIÓN*******************************/2089

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2089
			)aux
			JOIN ec_productos p ON p.id_productos=2089
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2089

El producto 2103 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2103
			)aux

Id de Producto: 2103

Inventario almacenes principales: 47

Ventas totales: 0
Proceso de racion producto: 2103

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*47/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2103
					WHERE p.id_productos=2103
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2103

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(47/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2103


/************************SEGUNDA RACIÓN**********************************/ 2103

/***************************TERCERA RACIÓN*******************************/2103

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2103
			)aux
			JOIN ec_productos p ON p.id_productos=2103
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2103

El producto 2117 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2117
			)aux

Id de Producto: 2117

Inventario almacenes principales: 286

Ventas totales: 309
Proceso de racion producto: 2117

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/309/*ventas totales*/)*286/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2117
					WHERE p.id_productos=2117
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.5533980582524265)-(31/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2117

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((44.42718446601941)-(30/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2117

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((43.50161812297735)-(44/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2117

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2117

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((92.55663430420712)-(69/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2117

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((71.26860841423948)-(64/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2117

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((28.692556634304207)-(48/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2117


/************************SEGUNDA RACIÓN**********************************/ 2117

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((34.77333333333333)-(30/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2117

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((72.44444444444444)-(69/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2117

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((55.78222222222222)-(64/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2117

/***************************TERCERA RACIÓN*******************************/2117

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2117
			)aux
			JOIN ec_productos p ON p.id_productos=2117
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2117

El producto 2128 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2128
			)aux

Id de Producto: 2128

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2128

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2128
					WHERE p.id_productos=2128
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2128

/***************************TERCERA RACIÓN*******************************/2128

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2128
			)aux
			JOIN ec_productos p ON p.id_productos=2128
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2128

El producto 2132 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2132
			)aux

Id de Producto: 2132

Inventario almacenes principales: 0

Ventas totales: 5
Proceso de racion producto: 2132

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/5/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2132
					WHERE p.id_productos=2132
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2132


/************************SEGUNDA RACIÓN**********************************/ 2132

/***************************TERCERA RACIÓN*******************************/2132

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2132
			)aux
			JOIN ec_productos p ON p.id_productos=2132
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2132

El producto 3239 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3239
			)aux

Id de Producto: 3239

Inventario almacenes principales: 55

Ventas totales: 32
Proceso de racion producto: 3239

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/32/*ventas totales*/)*55/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3239
					WHERE p.id_productos=3239
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((20.625)-(33/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3239

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((34.375)-(22/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3239


/************************SEGUNDA RACIÓN**********************************/ 3239

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((22)-(22/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3239

/***************************TERCERA RACIÓN*******************************/3239

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3239
			)aux
			JOIN ec_productos p ON p.id_productos=3239
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3239

El producto 3249 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3249
			)aux

Id de Producto: 3249

Inventario almacenes principales: 96

Ventas totales: 214
Proceso de racion producto: 3249

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/214/*ventas totales*/)*96/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3249
					WHERE p.id_productos=3249
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.383177570093458)-(36/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3249

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((27.36448598130841)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3249

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((34.54205607476635)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3249

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((17.49532710280374)-(25/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3249

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.214953271028037)-(23/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3249


/************************SEGUNDA RACIÓN**********************************/ 3249

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((5.304347826086957)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3249

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6.695652173913044)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3249

/***************************TERCERA RACIÓN*******************************/3249

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3249
			)aux
			JOIN ec_productos p ON p.id_productos=3249
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3249

El producto 2717 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2717
			)aux

Id de Producto: 2717

Inventario almacenes principales: -74

Ventas totales: 2
Proceso de racion producto: 2717

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*-74/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2717
					WHERE p.id_productos=2717
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-74)-(10/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2717

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2717

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2717

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2717

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2717

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(40/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2717

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(40/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2717


/************************SEGUNDA RACIÓN**********************************/ 2717

/***************************TERCERA RACIÓN*******************************/2717

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2717
			)aux
			JOIN ec_productos p ON p.id_productos=2717
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2717

El producto 2952 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2952
			)aux

Id de Producto: 2952

Inventario almacenes principales: -84

Ventas totales: 12
Proceso de racion producto: 2952

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/12/*ventas totales*/)*-84/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2952
					WHERE p.id_productos=2952
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-42)-(6/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2952

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2952

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2952

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2952

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-42)-(30/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2952

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(30/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2952


/************************SEGUNDA RACIÓN**********************************/ 2952

/***************************TERCERA RACIÓN*******************************/2952

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2952
			)aux
			JOIN ec_productos p ON p.id_productos=2952
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2952

El producto 3242 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3242
			)aux

Id de Producto: 3242

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 3242

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3242
					WHERE p.id_productos=3242
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 3242

/***************************TERCERA RACIÓN*******************************/3242

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3242
			)aux
			JOIN ec_productos p ON p.id_productos=3242
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3242

El producto 2939 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2939
			)aux

Id de Producto: 2939

Inventario almacenes principales: 39

Ventas totales: 54
Proceso de racion producto: 2939

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/54/*ventas totales*/)*39/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2939
					WHERE p.id_productos=2939
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((19.5)-(18/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2939

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((18.777777777777775)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2939

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.7222222222222222)-(15/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2939


/************************SEGUNDA RACIÓN**********************************/ 2939

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((12.226415094339622)-(18/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2939

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((11.773584905660378)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2939

/***************************TERCERA RACIÓN*******************************/2939

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2939
			)aux
			JOIN ec_productos p ON p.id_productos=2939
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2939

El producto 2167 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2167
			)aux

Id de Producto: 2167

Inventario almacenes principales: 68

Ventas totales: 62
Proceso de racion producto: 2167

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/62/*ventas totales*/)*68/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2167
					WHERE p.id_productos=2167
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((30.709677419354836)-(24/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2167

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.870967741935484)-(12/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2167

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9.870967741935484)-(15/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2167

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((17.548387096774192)-(30/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2167


/************************SEGUNDA RACIÓN**********************************/ 2167

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((11)-(24/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2167

/***************************TERCERA RACIÓN*******************************/2167

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2167
			)aux
			JOIN ec_productos p ON p.id_productos=2167
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2167

El producto 2173 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2173
			)aux

Id de Producto: 2173

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2173

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2173
					WHERE p.id_productos=2173
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2173

/***************************TERCERA RACIÓN*******************************/2173

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2173
			)aux
			JOIN ec_productos p ON p.id_productos=2173
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2173

El producto 2177 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2177
			)aux

Id de Producto: 2177

Inventario almacenes principales: 39

Ventas totales: 24
Proceso de racion producto: 2177

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/24/*ventas totales*/)*39/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2177
					WHERE p.id_productos=2177
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(21/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2177

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((39)-(30/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2177


/************************SEGUNDA RACIÓN**********************************/ 2177

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((18)-(30/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2177

/***************************TERCERA RACIÓN*******************************/2177

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2177
			)aux
			JOIN ec_productos p ON p.id_productos=2177
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2177

El producto 2246 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2246
			)aux

Id de Producto: 2246

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2246

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2246
					WHERE p.id_productos=2246
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2246

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2246

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2246

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2246


/************************SEGUNDA RACIÓN**********************************/ 2246

/***************************TERCERA RACIÓN*******************************/2246

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2246
			)aux
			JOIN ec_productos p ON p.id_productos=2246
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2246

El producto 2277 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2277
			)aux

Id de Producto: 2277

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2277

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2277
					WHERE p.id_productos=2277
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2277


/************************SEGUNDA RACIÓN**********************************/ 2277

/***************************TERCERA RACIÓN*******************************/2277

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2277
			)aux
			JOIN ec_productos p ON p.id_productos=2277
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2277

El producto 2281 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2281
			)aux

Id de Producto: 2281

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2281

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2281
					WHERE p.id_productos=2281
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2281

/***************************TERCERA RACIÓN*******************************/2281

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2281
			)aux
			JOIN ec_productos p ON p.id_productos=2281
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2281

El producto 2285 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2285
			)aux

Id de Producto: 2285

Inventario almacenes principales: 17

Ventas totales: 0
Proceso de racion producto: 2285

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2285
					WHERE p.id_productos=2285
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2285

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2285


/************************SEGUNDA RACIÓN**********************************/ 2285

/***************************TERCERA RACIÓN*******************************/2285

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2285
			)aux
			JOIN ec_productos p ON p.id_productos=2285
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2285

El producto 2940 entra en racion

Presentacion: 50

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/50 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2940
			)aux

Id de Producto: 2940

Inventario almacenes principales: 2.64

Ventas totales: 10
Proceso de racion producto: 2940

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/10/*ventas totales*/)*2.64/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2940
					WHERE p.id_productos=2940
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.64)-(70/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2940

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/50)) * 50  
						WHERE id_sucursal=9 AND id_producto=2940


/************************SEGUNDA RACIÓN**********************************/ 2940

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((2.64)-(70/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2940

/***************************TERCERA RACIÓN*******************************/2940

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2940
			)aux
			JOIN ec_productos p ON p.id_productos=2940
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2940

El producto 2303 entra en racion

Presentacion: 50

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/50 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2303
			)aux

Id de Producto: 2303

Inventario almacenes principales: 0.58

Ventas totales: 21
Proceso de racion producto: 2303

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/21/*ventas totales*/)*0.58/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2303
					WHERE p.id_productos=2303
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.58)-(29/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2303


/************************SEGUNDA RACIÓN**********************************/ 2303

/***************************TERCERA RACIÓN*******************************/2303

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2303
			)aux
			JOIN ec_productos p ON p.id_productos=2303
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2303

El producto 2313 entra en racion

Presentacion: 50

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/50 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2313
			)aux

Id de Producto: 2313

Inventario almacenes principales: 1

Ventas totales: 0
Proceso de racion producto: 2313

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2313
					WHERE p.id_productos=2313
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(50/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2313


/************************SEGUNDA RACIÓN**********************************/ 2313

/***************************TERCERA RACIÓN*******************************/2313

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2313
			)aux
			JOIN ec_productos p ON p.id_productos=2313
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2313

El producto 2317 entra en racion

Presentacion: 50

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/50 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2317
			)aux

Id de Producto: 2317

Inventario almacenes principales: 2.88

Ventas totales: 6
Proceso de racion producto: 2317

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/6/*ventas totales*/)*2.88/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2317
					WHERE p.id_productos=2317
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.88)-(94/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2317

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/50)) * 50  
						WHERE id_sucursal=9 AND id_producto=2317


/************************SEGUNDA RACIÓN**********************************/ 2317

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((2.88)-(94/50)) * 50  
						WHERE id_sucursal=4 AND id_producto=2317

/***************************TERCERA RACIÓN*******************************/2317

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2317
			)aux
			JOIN ec_productos p ON p.id_productos=2317
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2317

El producto 2325 entra en racion

Presentacion: 20

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/20 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2325
			)aux

Id de Producto: 2325

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2325

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2325
					WHERE p.id_productos=2325
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2325

/***************************TERCERA RACIÓN*******************************/2325

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2325
			)aux
			JOIN ec_productos p ON p.id_productos=2325
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2325

El producto 2327 entra en racion

Presentacion: 20

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/20 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2327
			)aux

Id de Producto: 2327

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2327

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2327
					WHERE p.id_productos=2327
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2327

/***************************TERCERA RACIÓN*******************************/2327

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2327
			)aux
			JOIN ec_productos p ON p.id_productos=2327
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2327

El producto 2330 entra en racion

Presentacion: 20

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/20 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2330
			)aux

Id de Producto: 2330

Inventario almacenes principales: 5.55

Ventas totales: 543
Proceso de racion producto: 2330

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/543/*ventas totales*/)*5.55/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2330
					WHERE p.id_productos=2330
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.7359116022099447)-(28/20)) * 20  
						WHERE id_sucursal=2 AND id_producto=2330

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.22486187845303868)-(218/20)) * 20  
						WHERE id_sucursal=3 AND id_producto=2330

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.011878453038674)-(81/20)) * 20  
						WHERE id_sucursal=4 AND id_producto=2330

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/20)) * 20  
						WHERE id_sucursal=7 AND id_producto=2330

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.8381215469613259)-(118/20)) * 20  
						WHERE id_sucursal=8 AND id_producto=2330

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7988950276243094)-(19/20)) * 20  
						WHERE id_sucursal=9 AND id_producto=2330

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.9403314917127072)-(128/20)) * 20  
						WHERE id_sucursal=10 AND id_producto=2330


/************************SEGUNDA RACIÓN**********************************/ 2330

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-23.1)-(19/20)) * 20  
						WHERE id_sucursal=9 AND id_producto=2330

/***************************TERCERA RACIÓN*******************************/2330

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2330
			)aux
			JOIN ec_productos p ON p.id_productos=2330
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2330

El producto 2334 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2334
			)aux

Id de Producto: 2334

Inventario almacenes principales: 331

Ventas totales: 534
Proceso de racion producto: 2334

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/534/*ventas totales*/)*331/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2334
					WHERE p.id_productos=2334
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((23.554307116104866)-(35/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((32.232209737827716)-(148/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((141.94569288389513)-(67/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((66.9438202247191)-(162/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((42.76966292134832)-(50/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((23.554307116104866)-(49/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2334

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(40/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2334


/************************SEGUNDA RACIÓN**********************************/ 2334

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-153)-(67/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2334

/***************************TERCERA RACIÓN*******************************/2334

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2334
			)aux
			JOIN ec_productos p ON p.id_productos=2334
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2334

El producto 2944 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2944
			)aux

Id de Producto: 2944

Inventario almacenes principales: -816

Ventas totales: 1305
Proceso de racion producto: 2944

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1305/*ventas totales*/)*-816/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2944
					WHERE p.id_productos=2944
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-108.17471264367816)-(17/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2944

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-189.46206896551726)-(87/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2944

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2944

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-193.2137931034483)-(97/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2944

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-178.20689655172416)-(22/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2944

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-146.94252873563218)-(103/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2944

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(60/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2944


/************************SEGUNDA RACIÓN**********************************/ 2944

/***************************TERCERA RACIÓN*******************************/2944

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2944
			)aux
			JOIN ec_productos p ON p.id_productos=2944
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2944

El producto 2349 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2349
			)aux

Id de Producto: 2349

Inventario almacenes principales: 10

Ventas totales: 31
Proceso de racion producto: 2349

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/31/*ventas totales*/)*10/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2349
					WHERE p.id_productos=2349
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.5806451612903225)-(0/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2349

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.6129032258064515)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2349

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.935483870967742)-(6/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2349

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2349

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.967741935483871)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2349

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.6129032258064515)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2349

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2903225806451613)-(2/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2349


/************************SEGUNDA RACIÓN**********************************/ 2349

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-8)-(0/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2349

/***************************TERCERA RACIÓN*******************************/2349

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2349
			)aux
			JOIN ec_productos p ON p.id_productos=2349
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2349

El producto 2355 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2355
			)aux

Id de Producto: 2355

Inventario almacenes principales: 0

Ventas totales: 1
Proceso de racion producto: 2355

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2355
					WHERE p.id_productos=2355
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2355

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2355

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2355


/************************SEGUNDA RACIÓN**********************************/ 2355

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-1)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2355

/***************************TERCERA RACIÓN*******************************/2355

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2355
			)aux
			JOIN ec_productos p ON p.id_productos=2355
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2355

El producto 3284 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3284
			)aux

Id de Producto: 3284

Inventario almacenes principales: 9

Ventas totales: 20
Proceso de racion producto: 3284

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/20/*ventas totales*/)*9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3284
					WHERE p.id_productos=3284
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.3499999999999999)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3284

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.3499999999999999)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3284

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.05)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3284

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.25)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3284


/************************SEGUNDA RACIÓN**********************************/ 3284

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-4)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3284

/***************************TERCERA RACIÓN*******************************/3284

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3284
			)aux
			JOIN ec_productos p ON p.id_productos=3284
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3284

El producto 2358 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2358
			)aux

Id de Producto: 2358

Inventario almacenes principales: 4

Ventas totales: 3
Proceso de racion producto: 2358

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2358
					WHERE p.id_productos=2358
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.3333333333333333)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2358

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2358

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.6666666666666665)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2358


/************************SEGUNDA RACIÓN**********************************/ 2358

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((3)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2358

/***************************TERCERA RACIÓN*******************************/2358

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2358
			)aux
			JOIN ec_productos p ON p.id_productos=2358
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2358

El producto 2360 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2360
			)aux

Id de Producto: 2360

Inventario almacenes principales: 0

Ventas totales: 1
Proceso de racion producto: 2360

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2360
					WHERE p.id_productos=2360
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2360

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2360


/************************SEGUNDA RACIÓN**********************************/ 2360

/***************************TERCERA RACIÓN*******************************/2360

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2360
			)aux
			JOIN ec_productos p ON p.id_productos=2360
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2360

El producto 2367 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2367
			)aux

Id de Producto: 2367

Inventario almacenes principales: -1

Ventas totales: 1
Proceso de racion producto: 2367

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2367
					WHERE p.id_productos=2367
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2367

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2367

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2367


/************************SEGUNDA RACIÓN**********************************/ 2367

/***************************TERCERA RACIÓN*******************************/2367

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2367
			)aux
			JOIN ec_productos p ON p.id_productos=2367
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2367

El producto 2370 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2370
			)aux

Id de Producto: 2370

Inventario almacenes principales: 20

Ventas totales: 21
Proceso de racion producto: 2370

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/21/*ventas totales*/)*20/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2370
					WHERE p.id_productos=2370
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2370

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.9047619047619047)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2370

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.619047619047619)-(13/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2370

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2370

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.9047619047619047)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2370

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.571428571428571)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2370


/************************SEGUNDA RACIÓN**********************************/ 2370

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-2)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2370

/***************************TERCERA RACIÓN*******************************/2370

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2370
			)aux
			JOIN ec_productos p ON p.id_productos=2370
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2370

El producto 2373 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2373
			)aux

Id de Producto: 2373

Inventario almacenes principales: -1

Ventas totales: 2
Proceso de racion producto: 2373

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2373
					WHERE p.id_productos=2373
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2373

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(0/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2373


/************************SEGUNDA RACIÓN**********************************/ 2373

/***************************TERCERA RACIÓN*******************************/2373

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2373
			)aux
			JOIN ec_productos p ON p.id_productos=2373
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2373

El producto 2376 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2376
			)aux

Id de Producto: 2376

Inventario almacenes principales: 64

Ventas totales: 122
Proceso de racion producto: 2376

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/122/*ventas totales*/)*64/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2376
					WHERE p.id_productos=2376
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.6721311475409837)-(6/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2376

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.19672131147541)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2376

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((45.114754098360656)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2376

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.721311475409836)-(22/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2376

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.19672131147541)-(14/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2376

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.098360655737705)-(10/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2376


/************************SEGUNDA RACIÓN**********************************/ 2376

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((7)-(12/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2376

/***************************TERCERA RACIÓN*******************************/2376

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2376
			)aux
			JOIN ec_productos p ON p.id_productos=2376
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2376

El producto 2453 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2453
			)aux

Id de Producto: 2453

Inventario almacenes principales: 40

Ventas totales: 0
Proceso de racion producto: 2453

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*40/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2453
					WHERE p.id_productos=2453
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2453

/***************************TERCERA RACIÓN*******************************/2453

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2453
			)aux
			JOIN ec_productos p ON p.id_productos=2453
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2453

El producto 2457 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2457
			)aux

Id de Producto: 2457

Inventario almacenes principales: 40

Ventas totales: 0
Proceso de racion producto: 2457

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*40/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2457
					WHERE p.id_productos=2457
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2457

/***************************TERCERA RACIÓN*******************************/2457

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2457
			)aux
			JOIN ec_productos p ON p.id_productos=2457
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2457

El producto 2413 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2413
			)aux

Id de Producto: 2413

Inventario almacenes principales: -5

Ventas totales: 7
Proceso de racion producto: 2413

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/7/*ventas totales*/)*-5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2413
					WHERE p.id_productos=2413
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-5)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2413


/************************SEGUNDA RACIÓN**********************************/ 2413

/***************************TERCERA RACIÓN*******************************/2413

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2413
			)aux
			JOIN ec_productos p ON p.id_productos=2413
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2413

El producto 2468 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2468
			)aux

Id de Producto: 2468

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2468

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2468
					WHERE p.id_productos=2468
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2468

/***************************TERCERA RACIÓN*******************************/2468

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2468
			)aux
			JOIN ec_productos p ON p.id_productos=2468
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2468

El producto 2469 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2469
			)aux

Id de Producto: 2469

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2469

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2469
					WHERE p.id_productos=2469
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2469

/***************************TERCERA RACIÓN*******************************/2469

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2469
			)aux
			JOIN ec_productos p ON p.id_productos=2469
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2469

El producto 2476 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2476
			)aux

Id de Producto: 2476

Inventario almacenes principales: 1

Ventas totales: 0
Proceso de racion producto: 2476

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2476
					WHERE p.id_productos=2476
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2476

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2476

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2476


/************************SEGUNDA RACIÓN**********************************/ 2476

/***************************TERCERA RACIÓN*******************************/2476

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2476
			)aux
			JOIN ec_productos p ON p.id_productos=2476
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2476

El producto 2799 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2799
			)aux

Id de Producto: 2799

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2799

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2799
					WHERE p.id_productos=2799
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2799

/***************************TERCERA RACIÓN*******************************/2799

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2799
			)aux
			JOIN ec_productos p ON p.id_productos=2799
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2799

El producto 2802 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2802
			)aux

Id de Producto: 2802

Inventario almacenes principales: 7

Ventas totales: 7
Proceso de racion producto: 2802

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/7/*ventas totales*/)*7/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2802
					WHERE p.id_productos=2802
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6)-(9/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2802

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2802


/************************SEGUNDA RACIÓN**********************************/ 2802

/***************************TERCERA RACIÓN*******************************/2802

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2802
			)aux
			JOIN ec_productos p ON p.id_productos=2802
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2802

El producto 2479 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2479
			)aux

Id de Producto: 2479

Inventario almacenes principales: 42

Ventas totales: 53
Proceso de racion producto: 2479

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/53/*ventas totales*/)*42/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2479
					WHERE p.id_productos=2479
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.679245283018867)-(3/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2479

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((10.30188679245283)-(9/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2479

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2479

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2479

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.754716981132075)-(12/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2479

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.679245283018867)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2479

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.5849056603773584)-(7/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2479


/************************SEGUNDA RACIÓN**********************************/ 2479

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8.177777777777779)-(3/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2479

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6.644444444444444)-(9/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2479

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8.177777777777779)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2479

/***************************TERCERA RACIÓN*******************************/2479

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2479
			)aux
			JOIN ec_productos p ON p.id_productos=2479
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2479

El producto 2489 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2489
			)aux

Id de Producto: 2489

Inventario almacenes principales: 11

Ventas totales: 10
Proceso de racion producto: 2489

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/10/*ventas totales*/)*11/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2489
					WHERE p.id_productos=2489
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2489

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2489

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2489

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.5)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2489

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.5)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2489


/************************SEGUNDA RACIÓN**********************************/ 2489

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((5)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2489

/***************************TERCERA RACIÓN*******************************/2489

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2489
			)aux
			JOIN ec_productos p ON p.id_productos=2489
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2489

El producto 2497 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2497
			)aux

Id de Producto: 2497

Inventario almacenes principales: 63

Ventas totales: 101
Proceso de racion producto: 2497

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/101/*ventas totales*/)*63/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2497
					WHERE p.id_productos=2497
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.732673267326733)-(9/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2497

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.475247524752476)-(16/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2497

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2497

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2497

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((16.21782178217822)-(13/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2497

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((12.475247524752476)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2497

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((13.099009900990099)-(9/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2497


/************************SEGUNDA RACIÓN**********************************/ 2497

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((14.746268656716419)-(13/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2497

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((11.343283582089551)-(10/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2497

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((11.91044776119403)-(9/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2497

/***************************TERCERA RACIÓN*******************************/2497

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2497
			)aux
			JOIN ec_productos p ON p.id_productos=2497
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2497

El producto 3277 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3277
			)aux

Id de Producto: 3277

Inventario almacenes principales: -1

Ventas totales: 3
Proceso de racion producto: 3277

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3277
					WHERE p.id_productos=3277
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3277


/************************SEGUNDA RACIÓN**********************************/ 3277

/***************************TERCERA RACIÓN*******************************/3277

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3277
			)aux
			JOIN ec_productos p ON p.id_productos=3277
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3277

El producto 2518 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2518
			)aux

Id de Producto: 2518

Inventario almacenes principales: 17

Ventas totales: 23
Proceso de racion producto: 2518

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/23/*ventas totales*/)*17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2518
					WHERE p.id_productos=2518
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.7391304347826086)-(4/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2518

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.4782608695652173)-(3/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2518

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2518

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.217391304347826)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2518

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.7391304347826086)-(8/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2518

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((11.826086956521738)-(5/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2518


/************************SEGUNDA RACIÓN**********************************/ 2518

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0)-(5/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2518

/***************************TERCERA RACIÓN*******************************/2518

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2518
			)aux
			JOIN ec_productos p ON p.id_productos=2518
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2518

El producto 2522 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2522
			)aux

Id de Producto: 2522

Inventario almacenes principales: 11

Ventas totales: 55
Proceso de racion producto: 2522

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/55/*ventas totales*/)*11/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2522
					WHERE p.id_productos=2522
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.8)-(3/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2522

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.19999999999999998)-(8/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2522

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2522

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2522

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.6)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2522

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.4)-(2/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2522


/************************SEGUNDA RACIÓN**********************************/ 2522

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-7)-(2/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2522

/***************************TERCERA RACIÓN*******************************/2522

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2522
			)aux
			JOIN ec_productos p ON p.id_productos=2522
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2522

El producto 2524 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2524
			)aux

Id de Producto: 2524

Inventario almacenes principales: 21

Ventas totales: 62
Proceso de racion producto: 2524

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/62/*ventas totales*/)*21/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2524
					WHERE p.id_productos=2524
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.0161290322580645)-(5/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2524

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.032258064516129)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2524

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.080645161290323)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2524

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.096774193548388)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2524

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.774193548387097)-(5/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2524


/************************SEGUNDA RACIÓN**********************************/ 2524

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0.9473684210526315)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2524

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1.0526315789473684)-(5/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2524

/***************************TERCERA RACIÓN*******************************/2524

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2524
			)aux
			JOIN ec_productos p ON p.id_productos=2524
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2524

El producto 2531 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2531
			)aux

Id de Producto: 2531

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2531

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2531
					WHERE p.id_productos=2531
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2531


/************************SEGUNDA RACIÓN**********************************/ 2531

/***************************TERCERA RACIÓN*******************************/2531

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2531
			)aux
			JOIN ec_productos p ON p.id_productos=2531
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2531

El producto 2533 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2533
			)aux

Id de Producto: 2533

Inventario almacenes principales: -2

Ventas totales: 4
Proceso de racion producto: 2533

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/4/*ventas totales*/)*-2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2533
					WHERE p.id_productos=2533
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2533

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5)-(-1/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2533

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.5)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2533


/************************SEGUNDA RACIÓN**********************************/ 2533

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-2)-(-1/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2533

/***************************TERCERA RACIÓN*******************************/2533

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2533
			)aux
			JOIN ec_productos p ON p.id_productos=2533
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2533

El producto 2819 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2819
			)aux

Id de Producto: 2819

Inventario almacenes principales: 5

Ventas totales: 11
Proceso de racion producto: 2819

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/11/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2819
					WHERE p.id_productos=2819
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2819

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.2727272727272725)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2819

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.727272727272727)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2819


/************************SEGUNDA RACIÓN**********************************/ 2819

/***************************TERCERA RACIÓN*******************************/2819

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2819
			)aux
			JOIN ec_productos p ON p.id_productos=2819
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2819

El producto 2820 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2820
			)aux

Id de Producto: 2820

Inventario almacenes principales: 15

Ventas totales: 14
Proceso de racion producto: 2820

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/14/*ventas totales*/)*15/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2820
					WHERE p.id_productos=2820
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2820

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((8.571428571428571)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2820

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.428571428571428)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2820


/************************SEGUNDA RACIÓN**********************************/ 2820

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8.571428571428571)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2820

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((6.428571428571428)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2820

/***************************TERCERA RACIÓN*******************************/2820

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2820
			)aux
			JOIN ec_productos p ON p.id_productos=2820
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2820

El producto 2821 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2821
			)aux

Id de Producto: 2821

Inventario almacenes principales: 3

Ventas totales: 10
Proceso de racion producto: 2821

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/10/*ventas totales*/)*3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2821
					WHERE p.id_productos=2821
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2821

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.7999999999999998)-(5/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2821

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2000000000000002)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2821


/************************SEGUNDA RACIÓN**********************************/ 2821

/***************************TERCERA RACIÓN*******************************/2821

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2821
			)aux
			JOIN ec_productos p ON p.id_productos=2821
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2821

El producto 2822 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2822
			)aux

Id de Producto: 2822

Inventario almacenes principales: 19

Ventas totales: 71
Proceso de racion producto: 2822

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/71/*ventas totales*/)*19/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2822
					WHERE p.id_productos=2822
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.0704225352112677)-(8/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2822

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2822

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2822

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((5.352112676056338)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2822

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4.014084507042253)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2822

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((6.690140845070422)-(8/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2822

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.8732394366197183)-(1/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2822


/************************SEGUNDA RACIÓN**********************************/ 2822

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1.4285714285714284)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2822

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1.0714285714285714)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2822

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0.5)-(1/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2822

/***************************TERCERA RACIÓN*******************************/2822

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2822
			)aux
			JOIN ec_productos p ON p.id_productos=2822
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2822

El producto 2824 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2824
			)aux

Id de Producto: 2824

Inventario almacenes principales: -1

Ventas totales: 10
Proceso de racion producto: 2824

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/10/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2824
					WHERE p.id_productos=2824
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2824

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2824

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.8)-(-1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2824

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.2)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2824


/************************SEGUNDA RACIÓN**********************************/ 2824

/***************************TERCERA RACIÓN*******************************/2824

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2824
			)aux
			JOIN ec_productos p ON p.id_productos=2824
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2824

El producto 2825 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2825
			)aux

Id de Producto: 2825

Inventario almacenes principales: -3

Ventas totales: 3
Proceso de racion producto: 2825

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*-3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2825
					WHERE p.id_productos=2825
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2825

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2825

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2825

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2825


/************************SEGUNDA RACIÓN**********************************/ 2825

/***************************TERCERA RACIÓN*******************************/2825

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2825
			)aux
			JOIN ec_productos p ON p.id_productos=2825
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2825

El producto 2827 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2827
			)aux

Id de Producto: 2827

Inventario almacenes principales: -7

Ventas totales: 0
Proceso de racion producto: 2827

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-7/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2827
					WHERE p.id_productos=2827
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2827

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2827

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2827


/************************SEGUNDA RACIÓN**********************************/ 2827

/***************************TERCERA RACIÓN*******************************/2827

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2827
			)aux
			JOIN ec_productos p ON p.id_productos=2827
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2827

El producto 2828 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2828
			)aux

Id de Producto: 2828

Inventario almacenes principales: -9

Ventas totales: 1
Proceso de racion producto: 2828

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*-9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2828
					WHERE p.id_productos=2828
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2828

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2828

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-9)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2828


/************************SEGUNDA RACIÓN**********************************/ 2828

/***************************TERCERA RACIÓN*******************************/2828

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2828
			)aux
			JOIN ec_productos p ON p.id_productos=2828
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2828

El producto 2829 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2829
			)aux

Id de Producto: 2829

Inventario almacenes principales: 0

Ventas totales: 2
Proceso de racion producto: 2829

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2829
					WHERE p.id_productos=2829
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2829

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2829

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2829


/************************SEGUNDA RACIÓN**********************************/ 2829

/***************************TERCERA RACIÓN*******************************/2829

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2829
			)aux
			JOIN ec_productos p ON p.id_productos=2829
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2829

El producto 2951 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2951
			)aux

Id de Producto: 2951

Inventario almacenes principales: -34

Ventas totales: 13
Proceso de racion producto: 2951

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/13/*ventas totales*/)*-34/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2951
					WHERE p.id_productos=2951
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2951

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-20.923076923076923)-(1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2951

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-13.076923076923078)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2951


/************************SEGUNDA RACIÓN**********************************/ 2951

/***************************TERCERA RACIÓN*******************************/2951

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2951
			)aux
			JOIN ec_productos p ON p.id_productos=2951
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2951

El producto 3003 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3003
			)aux

Id de Producto: 3003

Inventario almacenes principales: -1

Ventas totales: 13
Proceso de racion producto: 3003

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/13/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3003
					WHERE p.id_productos=3003
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3003

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.46153846153846156)-(3/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3003

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5384615384615384)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3003


/************************SEGUNDA RACIÓN**********************************/ 3003

/***************************TERCERA RACIÓN*******************************/3003

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3003
			)aux
			JOIN ec_productos p ON p.id_productos=3003
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3003

El producto 3134 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3134
			)aux

Id de Producto: 3134

Inventario almacenes principales: 0

Ventas totales: 6
Proceso de racion producto: 3134

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/6/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3134
					WHERE p.id_productos=3134
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3134


/************************SEGUNDA RACIÓN**********************************/ 3134

/***************************TERCERA RACIÓN*******************************/3134

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3134
			)aux
			JOIN ec_productos p ON p.id_productos=3134
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3134

El producto 3136 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3136
			)aux

Id de Producto: 3136

Inventario almacenes principales: 2

Ventas totales: 0
Proceso de racion producto: 3136

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3136
					WHERE p.id_productos=3136
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3136


/************************SEGUNDA RACIÓN**********************************/ 3136

/***************************TERCERA RACIÓN*******************************/3136

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3136
			)aux
			JOIN ec_productos p ON p.id_productos=3136
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3136

El producto 3137 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3137
			)aux

Id de Producto: 3137

Inventario almacenes principales: -6

Ventas totales: 25
Proceso de racion producto: 3137

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/25/*ventas totales*/)*-6/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3137
					WHERE p.id_productos=3137
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3.84)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3137

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2.16)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3137


/************************SEGUNDA RACIÓN**********************************/ 3137

/***************************TERCERA RACIÓN*******************************/3137

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3137
			)aux
			JOIN ec_productos p ON p.id_productos=3137
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3137

El producto 3139 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3139
			)aux

Id de Producto: 3139

Inventario almacenes principales: 8

Ventas totales: 43
Proceso de racion producto: 3139

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/43/*ventas totales*/)*8/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3139
					WHERE p.id_productos=3139
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.6744186046511629)-(7/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3139

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.9767441860465116)-(34/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3139

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.7441860465116279)-(5/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3139

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.604651162790698)-(7/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=3139


/************************SEGUNDA RACIÓN**********************************/ 3139

/***************************TERCERA RACIÓN*******************************/3139

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3139
			)aux
			JOIN ec_productos p ON p.id_productos=3139
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3139

El producto 3266 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3266
			)aux

Id de Producto: 3266

Inventario almacenes principales: 0

Ventas totales: 3
Proceso de racion producto: 3266

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3266
					WHERE p.id_productos=3266
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3266

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3266


/************************SEGUNDA RACIÓN**********************************/ 3266

/***************************TERCERA RACIÓN*******************************/3266

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3266
			)aux
			JOIN ec_productos p ON p.id_productos=3266
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3266

El producto 3303 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3303
			)aux

Id de Producto: 3303

Inventario almacenes principales: -6

Ventas totales: 32
Proceso de racion producto: 3303

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/32/*ventas totales*/)*-6/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3303
					WHERE p.id_productos=3303
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4.5)-(1/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3303

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.5)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3303


/************************SEGUNDA RACIÓN**********************************/ 3303

/***************************TERCERA RACIÓN*******************************/3303

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3303
			)aux
			JOIN ec_productos p ON p.id_productos=3303
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3303

El producto 3305 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3305
			)aux

Id de Producto: 3305

Inventario almacenes principales: -1

Ventas totales: 2
Proceso de racion producto: 3305

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3305
					WHERE p.id_productos=3305
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(-1/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=3305

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3305


/************************SEGUNDA RACIÓN**********************************/ 3305

/***************************TERCERA RACIÓN*******************************/3305

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3305
			)aux
			JOIN ec_productos p ON p.id_productos=3305
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3305

El producto 2552 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2552
			)aux

Id de Producto: 2552

Inventario almacenes principales: -2

Ventas totales: 4
Proceso de racion producto: 2552

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/4/*ventas totales*/)*-2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2552
					WHERE p.id_productos=2552
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2552

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1.5)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2552


/************************SEGUNDA RACIÓN**********************************/ 2552

/***************************TERCERA RACIÓN*******************************/2552

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2552
			)aux
			JOIN ec_productos p ON p.id_productos=2552
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2552

El producto 2832 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2832
			)aux

Id de Producto: 2832

Inventario almacenes principales: 9

Ventas totales: 1
Proceso de racion producto: 2832

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/1/*ventas totales*/)*9/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2832
					WHERE p.id_productos=2832
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2832

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2832

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2832


/************************SEGUNDA RACIÓN**********************************/ 2832

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((8)-(1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2832

/***************************TERCERA RACIÓN*******************************/2832

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2832
			)aux
			JOIN ec_productos p ON p.id_productos=2832
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2832

El producto 2834 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2834
			)aux

Id de Producto: 2834

Inventario almacenes principales: -5

Ventas totales: 5
Proceso de racion producto: 2834

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/5/*ventas totales*/)*-5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2834
					WHERE p.id_productos=2834
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2834

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2834

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2834


/************************SEGUNDA RACIÓN**********************************/ 2834

/***************************TERCERA RACIÓN*******************************/2834

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2834
			)aux
			JOIN ec_productos p ON p.id_productos=2834
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2834

El producto 2978 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2978
			)aux

Id de Producto: 2978

Inventario almacenes principales: -3

Ventas totales: 6
Proceso de racion producto: 2978

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/6/*ventas totales*/)*-3/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2978
					WHERE p.id_productos=2978
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2978

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2978


/************************SEGUNDA RACIÓN**********************************/ 2978

/***************************TERCERA RACIÓN*******************************/2978

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2978
			)aux
			JOIN ec_productos p ON p.id_productos=2978
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2978

El producto 2568 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2568
			)aux

Id de Producto: 2568

Inventario almacenes principales: -17

Ventas totales: 17
Proceso de racion producto: 2568

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/17/*ventas totales*/)*-17/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2568
					WHERE p.id_productos=2568
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-3)-(12/1)) * 1  
						WHERE id_sucursal=2 AND id_producto=2568

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(14/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2568

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-4)-(15/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2568

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-7)-(14/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2568

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-2)-(13/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2568

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(14/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2568


/************************SEGUNDA RACIÓN**********************************/ 2568

/***************************TERCERA RACIÓN*******************************/2568

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2568
			)aux
			JOIN ec_productos p ON p.id_productos=2568
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2568

El producto 2576 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2576
			)aux

Id de Producto: 2576

Inventario almacenes principales: 1

Ventas totales: 0
Proceso de racion producto: 2576

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2576
					WHERE p.id_productos=2576
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2576


/************************SEGUNDA RACIÓN**********************************/ 2576

/***************************TERCERA RACIÓN*******************************/2576

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2576
			)aux
			JOIN ec_productos p ON p.id_productos=2576
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2576

El producto 2577 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2577
			)aux

Id de Producto: 2577

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2577

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2577
					WHERE p.id_productos=2577
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2577

/***************************TERCERA RACIÓN*******************************/2577

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2577
			)aux
			JOIN ec_productos p ON p.id_productos=2577
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2577

El producto 2582 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2582
			)aux

Id de Producto: 2582

Inventario almacenes principales: -1

Ventas totales: 36
Proceso de racion producto: 2582

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/36/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2582
					WHERE p.id_productos=2582
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.08333333333333333)-(8/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2582

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.3888888888888889)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2582

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0.5277777777777778)-(3/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2582


/************************SEGUNDA RACIÓN**********************************/ 2582

/***************************TERCERA RACIÓN*******************************/2582

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2582
			)aux
			JOIN ec_productos p ON p.id_productos=2582
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2582

El producto 2585 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2585
			)aux

Id de Producto: 2585

Inventario almacenes principales: -4

Ventas totales: 0
Proceso de racion producto: 2585

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*-4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2585
					WHERE p.id_productos=2585
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2585

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2585

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2585


/************************SEGUNDA RACIÓN**********************************/ 2585

/***************************TERCERA RACIÓN*******************************/2585

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2585
			)aux
			JOIN ec_productos p ON p.id_productos=2585
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2585

El producto 3154 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3154
			)aux

Id de Producto: 3154

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 3154

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3154
					WHERE p.id_productos=3154
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 3154

/***************************TERCERA RACIÓN*******************************/3154

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3154
			)aux
			JOIN ec_productos p ON p.id_productos=3154
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3154

El producto 2593 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2593
			)aux

Id de Producto: 2593

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2593

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2593
					WHERE p.id_productos=2593
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2593

/***************************TERCERA RACIÓN*******************************/2593

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2593
			)aux
			JOIN ec_productos p ON p.id_productos=2593
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2593

El producto 2594 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2594
			)aux

Id de Producto: 2594

Inventario almacenes principales: -1

Ventas totales: 3
Proceso de racion producto: 2594

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/3/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2594
					WHERE p.id_productos=2594
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2594

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2594


/************************SEGUNDA RACIÓN**********************************/ 2594

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((-2)-(-2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2594

/***************************TERCERA RACIÓN*******************************/2594

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2594
			)aux
			JOIN ec_productos p ON p.id_productos=2594
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2594

El producto 2595 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2595
			)aux

Id de Producto: 2595

Inventario almacenes principales: 18

Ventas totales: 30
Proceso de racion producto: 2595

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/30/*ventas totales*/)*18/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2595
					WHERE p.id_productos=2595
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2)-(5/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=2595

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3.6)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2595

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2595

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.4)-(4/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2595

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((7.800000000000001)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2595

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2.4)-(3/1)) * 1  
						WHERE id_sucursal=10 AND id_producto=2595

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.6)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2595


/************************SEGUNDA RACIÓN**********************************/ 2595

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1.8571428571428572)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2595

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((0.14285714285714285)-(0/1)) * 1  
						WHERE id_sucursal=11 AND id_producto=2595

/***************************TERCERA RACIÓN*******************************/2595

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2595
			)aux
			JOIN ec_productos p ON p.id_productos=2595
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2595

El producto 2600 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2600
			)aux

Id de Producto: 2600

Inventario almacenes principales: 2

Ventas totales: 0
Proceso de racion producto: 2600

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2600
					WHERE p.id_productos=2600
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2600

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(2/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2600


/************************SEGUNDA RACIÓN**********************************/ 2600

/***************************TERCERA RACIÓN*******************************/2600

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2600
			)aux
			JOIN ec_productos p ON p.id_productos=2600
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2600

El producto 2605 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2605
			)aux

Id de Producto: 2605

Inventario almacenes principales: -12

Ventas totales: 2
Proceso de racion producto: 2605

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/2/*ventas totales*/)*-12/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2605
					WHERE p.id_productos=2605
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2605

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-12)-(-1/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2605


/************************SEGUNDA RACIÓN**********************************/ 2605

/***************************TERCERA RACIÓN*******************************/2605

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2605
			)aux
			JOIN ec_productos p ON p.id_productos=2605
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2605

El producto 2655 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2655
			)aux

Id de Producto: 2655

Inventario almacenes principales: 5

Ventas totales: 0
Proceso de racion producto: 2655

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*5/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2655
					WHERE p.id_productos=2655
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2655


/************************SEGUNDA RACIÓN**********************************/ 2655

/***************************TERCERA RACIÓN*******************************/2655

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2655
			)aux
			JOIN ec_productos p ON p.id_productos=2655
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2655

El producto 2853 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2853
			)aux

Id de Producto: 2853

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2853

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2853
					WHERE p.id_productos=2853
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2853

/***************************TERCERA RACIÓN*******************************/2853

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2853
			)aux
			JOIN ec_productos p ON p.id_productos=2853
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2853

El producto 2865 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2865
			)aux

Id de Producto: 2865

Inventario almacenes principales: -1

Ventas totales: 5
Proceso de racion producto: 2865

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/5/*ventas totales*/)*-1/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2865
					WHERE p.id_productos=2865
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-1)-(-1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2865


/************************SEGUNDA RACIÓN**********************************/ 2865

/***************************TERCERA RACIÓN*******************************/2865

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2865
			)aux
			JOIN ec_productos p ON p.id_productos=2865
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2865

El producto 2875 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2875
			)aux

Id de Producto: 2875

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2875

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2875
					WHERE p.id_productos=2875
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal


/************************SEGUNDA RACIÓN**********************************/ 2875

/***************************TERCERA RACIÓN*******************************/2875

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2875
			)aux
			JOIN ec_productos p ON p.id_productos=2875
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2875

El producto 2878 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2878
			)aux

Id de Producto: 2878

Inventario almacenes principales: 2

Ventas totales: 5
Proceso de racion producto: 2878

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/5/*ventas totales*/)*2/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2878
					WHERE p.id_productos=2878
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((1.2)-(1/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2878

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0.8)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2878


/************************SEGUNDA RACIÓN**********************************/ 2878

racion 2: UPDATE sys_sucursales_producto SET racion_2=ROUND((1)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2878

/***************************TERCERA RACIÓN*******************************/2878

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2878
			)aux
			JOIN ec_productos p ON p.id_productos=2878
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2878

El producto 2879 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2879
			)aux

Id de Producto: 2879

Inventario almacenes principales: 0

Ventas totales: 17
Proceso de racion producto: 2879

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/17/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2879
					WHERE p.id_productos=2879
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(6/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2879


/************************SEGUNDA RACIÓN**********************************/ 2879

/***************************TERCERA RACIÓN*******************************/2879

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2879
			)aux
			JOIN ec_productos p ON p.id_productos=2879
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2879

El producto 2880 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2880
			)aux

Id de Producto: 2880

Inventario almacenes principales: -36

Ventas totales: 44
Proceso de racion producto: 2880

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/44/*ventas totales*/)*-36/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2880
					WHERE p.id_productos=2880
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-21.272727272727273)-(2/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=2880

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-14.727272727272728)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2880


/************************SEGUNDA RACIÓN**********************************/ 2880

/***************************TERCERA RACIÓN*******************************/2880

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2880
			)aux
			JOIN ec_productos p ON p.id_productos=2880
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2880

El producto 2881 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2881
			)aux

Id de Producto: 2881

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2881

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2881
					WHERE p.id_productos=2881
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=7 AND id_producto=2881

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2881


/************************SEGUNDA RACIÓN**********************************/ 2881

/***************************TERCERA RACIÓN*******************************/2881

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2881
			)aux
			JOIN ec_productos p ON p.id_productos=2881
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2881

El producto 2888 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2888
			)aux

Id de Producto: 2888

Inventario almacenes principales: 4

Ventas totales: 0
Proceso de racion producto: 2888

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*4/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2888
					WHERE p.id_productos=2888
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(4/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2888

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2888


/************************SEGUNDA RACIÓN**********************************/ 2888

/***************************TERCERA RACIÓN*******************************/2888

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2888
			)aux
			JOIN ec_productos p ON p.id_productos=2888
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2888

El producto 2890 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2890
			)aux

Id de Producto: 2890

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2890

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2890
					WHERE p.id_productos=2890
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2890


/************************SEGUNDA RACIÓN**********************************/ 2890

/***************************TERCERA RACIÓN*******************************/2890

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2890
			)aux
			JOIN ec_productos p ON p.id_productos=2890
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2890

El producto 2893 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2893
			)aux

Id de Producto: 2893

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2893

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2893
					WHERE p.id_productos=2893
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2893


/************************SEGUNDA RACIÓN**********************************/ 2893

/***************************TERCERA RACIÓN*******************************/2893

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2893
			)aux
			JOIN ec_productos p ON p.id_productos=2893
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2893

El producto 2894 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2894
			)aux

Id de Producto: 2894

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2894

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2894
					WHERE p.id_productos=2894
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2894


/************************SEGUNDA RACIÓN**********************************/ 2894

/***************************TERCERA RACIÓN*******************************/2894

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2894
			)aux
			JOIN ec_productos p ON p.id_productos=2894
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2894

El producto 2895 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2895
			)aux

Id de Producto: 2895

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2895

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2895
					WHERE p.id_productos=2895
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2895


/************************SEGUNDA RACIÓN**********************************/ 2895

/***************************TERCERA RACIÓN*******************************/2895

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2895
			)aux
			JOIN ec_productos p ON p.id_productos=2895
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2895

El producto 2897 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2897
			)aux

Id de Producto: 2897

Inventario almacenes principales: 0

Ventas totales: 0
Proceso de racion producto: 2897

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/0/*ventas totales*/)*0/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2897
					WHERE p.id_productos=2897
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((0)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2897


/************************SEGUNDA RACIÓN**********************************/ 2897

/***************************TERCERA RACIÓN*******************************/2897

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2897
			)aux
			JOIN ec_productos p ON p.id_productos=2897
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2897

El producto 2908 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=2908
			)aux

Id de Producto: 2908

Inventario almacenes principales: -38

Ventas totales: 5
Proceso de racion producto: 2908

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/5/*ventas totales*/)*-38/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=2908
					WHERE p.id_productos=2908
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-0)-(0/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=2908

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((-38)-(0/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=2908


/************************SEGUNDA RACIÓN**********************************/ 2908

/***************************TERCERA RACIÓN*******************************/2908

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=2908
			)aux
			JOIN ec_productos p ON p.id_productos=2908
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=2908

El producto 3258 entra en racion

Presentacion: 1

sql bases 1: SELECT
				aux.id_producto,
				(IF(aux.inventarioAlmacenesPrincipales IS NULL,0,aux.inventarioAlmacenesPrincipales))/1 AS inventarioAlmacenesPrincipales,
				IF(aux.ventas_totales IS NULL,0,aux.ventas_totales) AS ventas_totales
			FROM(
				SELECT
					p.id_productos as id_producto,
					SUM(IF(alm.es_almacen=1,(md.cantidad*tm.afecta),0)) AS inventarioAlmacenesPrincipales,
					SUM(IF(alm.es_almacen=1 AND tm.id_tipo_movimiento=2 AND alm.es_externo=0 AND ma.fecha like '%2019%',
						md.cantidad,
						0
						)
					) AS ventas_totales
				FROM ec_productos p
				LEFT JOIN ec_movimiento_detalle md ON p.id_productos=md.id_producto
				LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
				LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
				LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
				LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
				LEFT JOIN sys_sucursales_producto sp on s.id_sucursal=sp.id_sucursal AND p.id_productos=sp.id_producto
				WHERE s.activo=1 
				AND s.id_sucursal>0
				AND sp.estado_suc=1
				AND p.id_productos=3258
			)aux

Id de Producto: 3258

Inventario almacenes principales: 18

Ventas totales: 18
Proceso de racion producto: 3258

sql racion 1: SELECT 
					aux.id_sucursal,
					IF(aux.racion is null,0,aux.racion),
					IF(aux.inventarioAlmacenPrincipalPorSucursal IS NULL,0,aux.inventarioAlmacenPrincipalPorSucursal) as inventarioAlmacenPrincipalPorSucursal
				FROM(
					SELECT
						s.id_sucursal,
						( (SUM(IF(ma.id_movimiento_almacen IS NOT NULL AND /*ma*/alm.id_sucursal=s.id_sucursal AND alm.es_externo=0 
							AND tm.id_tipo_movimiento=2 AND ma.fecha like '%2019%',
								md.cantidad,
								0)
							) 
						)/18/*ventas totales*/)*18/*inventario almacen principal*/ AS racion,/*total de ventas del año actual*/
						SUM(IF(alm.es_almacen=1 AND ma.id_sucursal=s.id_sucursal,(md.cantidad*tm.afecta),0)) as inventarioAlmacenPrincipalPorSucursal
					FROM ec_productos p 
					LEFT JOIN ec_movimiento_detalle md on p.id_productos=md.id_producto
					LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
					LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
					LEFT JOIN ec_almacen alm ON ma.id_almacen=alm.id_almacen
					LEFT JOIN sys_sucursales s ON alm.id_sucursal=s.id_sucursal
					LEFT JOIN sys_sucursales_producto sp_1 ON s.id_sucursal=sp_1.id_sucursal AND sp_1.id_producto=3258
					WHERE p.id_productos=3258
					AND sp_1.estado_suc=1/*habilitado en la sucursal*/
					AND s.id_sucursal>1/*sucursal mayor a matriz*/
					GROUP BY s.id_sucursal/*agrupamos por sucursal*/
				)aux
				GROUP BY aux.id_sucursal

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((4)-(4/1)) * 1  
						WHERE id_sucursal=3 AND id_producto=3258

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((3)-(5/1)) * 1  
						WHERE id_sucursal=4 AND id_producto=3258

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((9)-(10/1)) * 1  
						WHERE id_sucursal=8 AND id_producto=3258

racion 1: UPDATE sys_sucursales_producto SET racion_1=ROUND((2)-(4/1)) * 1  
						WHERE id_sucursal=9 AND id_producto=3258


/************************SEGUNDA RACIÓN**********************************/ 3258

/***************************TERCERA RACIÓN*******************************/3258

Consulta sql tercera racion: SELECT 
				aux.total_raciones,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1,0,(md.cantidad*tm.afecta))) as inventarioMatriz
			FROM(
				SELECT
					SUM(racion_3) AS total_raciones  
				FROM sys_sucursales_producto 
				WHERE id_producto=3258
			)aux
			JOIN ec_productos p ON p.id_productos=3258
			LEFT JOIN ec_movimiento_detalle md ON md.id_producto=p.id_productos
			LEFT JOIN ec_movimiento_almacen ma ON md.id_movimiento=ma.id_movimiento_almacen
			LEFT JOIN ec_tipos_movimiento tm ON ma.id_tipo_movimiento=tm.id_tipo_movimiento
			WHERE p.id_productos=3258
/************************* INICIAMOS *************************/
SELECT
			ax1.id_productos AS ID,
			ax1.nombre,
			ax1.sumaEstacionalidades,
			ax1.inventarioMatriz,
			ax1.inventarioSucursales,
			IF( (ax1.inventarioSucursales+ax1.inventarioMatriz)<ax1.sumaEstacionalidades,1,0) AS raciona 
		FROM(
			SELECT
				ax.id_productos, 
				ax.nombre,
				ax.sumaEstacionalidades,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1 ,0,(tm.afecta*md.cantidad))) AS inventarioMatriz,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR alm.id_sucursal<=1 OR alm.es_almacen=0,0,(tm.afecta*md.cantidad))) AS inventarioSucursales,
				ax.orden_lista
			FROM(
				SELECT
					p.id_productos, 
					p.nombre,
					SUM(ep.maximo) AS sumaEstacionalidades,
					p.orden_lista
				FROM ec_productos p
				LEFT JOIN ec_estacionalidad_producto ep ON ep.id_producto=p.id_productos
				LEFT JOIN ec_estacionalidad e ON ep.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales s ON s.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales_producto sp ON sp.id_sucursal=s.id_sucursal
				AND sp.id_producto=p.id_productos
				WHERE sp.stock_bajo=0
				GROUP BY p.id_productos
				ORDER BY p.orden_lista
			)ax
			LEFT JOIN ec_movimiento_detalle md ON ax.id_productos=md.id_producto
			LEFT JOIN ec_movimiento_almacen ma ON ma.id_movimiento_almacen=md.id_movimiento
			LEFT JOIN ec_tipos_movimiento tm ON tm.id_tipo_movimiento=ma.id_tipo_movimiento
			LEFT JOIN ec_almacen alm ON alm.id_almacen=ma.id_almacen
			GROUP BY ax.id_productos
			ORDER BY ax.orden_lista
		)ax1
		GROUP BY ax1.id_productos
		ORDER BY ax1.orden_lista

Consultamos el año actualSELECT YEAR(CURRENT_DATE)
2019
/************************* INICIAMOS *************************/
SELECT
			ax1.id_productos AS ID,
			ax1.nombre,
			ax1.sumaEstacionalidades,
			ax1.inventarioMatriz,
			ax1.inventarioSucursales,
			IF( (ax1.inventarioSucursales+ax1.inventarioMatriz)<ax1.sumaEstacionalidades,1,0) AS raciona 
		FROM(
			SELECT
				ax.id_productos, 
				ax.nombre,
				ax.sumaEstacionalidades,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1 ,0,(tm.afecta*md.cantidad))) AS inventarioMatriz,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR alm.id_sucursal<=1 OR alm.es_almacen=0,0,(tm.afecta*md.cantidad))) AS inventarioSucursales,
				ax.orden_lista
			FROM(
				SELECT
					p.id_productos, 
					p.nombre,
					SUM(ep.maximo) AS sumaEstacionalidades,
					p.orden_lista
				FROM ec_productos p
				LEFT JOIN ec_estacionalidad_producto ep ON ep.id_producto=p.id_productos
				LEFT JOIN ec_estacionalidad e ON ep.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales s ON s.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales_producto sp ON sp.id_sucursal=s.id_sucursal
				AND sp.id_producto=p.id_productos
				WHERE sp.stock_bajo=0
				GROUP BY p.id_productos
				ORDER BY p.orden_lista
			)ax
			LEFT JOIN ec_movimiento_detalle md ON ax.id_productos=md.id_producto
			LEFT JOIN ec_movimiento_almacen ma ON ma.id_movimiento_almacen=md.id_movimiento
			LEFT JOIN ec_tipos_movimiento tm ON tm.id_tipo_movimiento=ma.id_tipo_movimiento
			LEFT JOIN ec_almacen alm ON alm.id_almacen=ma.id_almacen
			GROUP BY ax.id_productos
			ORDER BY ax.orden_lista
		)ax1
		GROUP BY ax1.id_productos
		ORDER BY ax1.orden_lista

Consultamos el año actualSELECT YEAR(CURRENT_DATE)
2019
/************************* INICIAMOS *************************/
SELECT
			ax1.id_productos AS ID,
			ax1.nombre,
			ax1.sumaEstacionalidades,
			ax1.inventarioMatriz,
			ax1.inventarioSucursales,
			IF( (ax1.inventarioSucursales+ax1.inventarioMatriz)<ax1.sumaEstacionalidades,1,0) AS raciona 
		FROM(
			SELECT
				ax.id_productos, 
				ax.nombre,
				ax.sumaEstacionalidades,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR ma.id_almacen!=1 ,0,(tm.afecta*md.cantidad))) AS inventarioMatriz,
				SUM(IF(ma.id_movimiento_almacen IS NULL OR alm.id_sucursal<=1 OR alm.es_almacen=0,0,(tm.afecta*md.cantidad))) AS inventarioSucursales,
				ax.orden_lista
			FROM(
				SELECT
					p.id_productos, 
					p.nombre,
					SUM(ep.maximo) AS sumaEstacionalidades,
					p.orden_lista
				FROM ec_productos p
				LEFT JOIN ec_estacionalidad_producto ep ON ep.id_producto=p.id_productos
				LEFT JOIN ec_estacionalidad e ON ep.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales s ON s.id_estacionalidad=e.id_estacionalidad
				LEFT JOIN sys_sucursales_producto sp ON sp.id_sucursal=s.id_sucursal
				AND sp.id_producto=p.id_productos
				WHERE sp.stock_bajo=0
				GROUP BY p.id_productos
				ORDER BY p.orden_lista
			)ax
			LEFT JOIN ec_movimiento_detalle md ON ax.id_productos=md.id_producto
			LEFT JOIN ec_movimiento_almacen ma ON ma.id_movimiento_almacen=md.id_movimiento
			LEFT JOIN ec_tipos_movimiento tm ON tm.id_tipo_movimiento=ma.id_tipo_movimiento
			LEFT JOIN ec_almacen alm ON alm.id_almacen=ma.id_almacen
			GROUP BY ax.id_productos
			ORDER BY ax.orden_lista
		)ax1
		GROUP BY ax1.id_productos
		ORDER BY ax1.orden_lista

Consultamos el año actualSELECT YEAR(CURRENT_DATE)
2019
